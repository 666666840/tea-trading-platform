# 性能监控高级功能使用指南

## 📊 功能概述

本指南介绍茶叶批发平台小程序性能监控系统的高级功能，包括：

- 📈 性能仪表盘页面
- 🔍 自定义指标卡片
- 📊 趋势图表可视化
- 🚨 性能告警推送
- 📤 数据导出分享
- 🔧 交互式筛选详情

## 🚀 快速开始

### 1. 访问性能仪表盘

在小程序中导航到：`pages/performance-dashboard/performance-dashboard`

### 2. 查看核心指标

页面顶部显示四个核心性能指标：
- **内存占用率**：当前应用内存使用情况
- **API平均响应**：接口响应时间统计
- **错误率**：应用错误发生频率
- **运行时长**：应用持续运行时间

### 3. 使用操作按钮

顶部操作栏提供四个快捷功能：
- 🔄 **刷新**：手动更新性能数据
- 🔍 **筛选**：显示/隐藏筛选条件
- 📊 **导出**：导出性能数据到剪贴板
- ⚡ **优化**：执行一键性能优化

## 📈 自定义指标卡片

### 活跃用户数
- 显示当前在线活跃用户数量
- 基于用户行为数据统计

### 告警数量
- 显示当前未处理的告警数量
- 按严重程度分类统计

### 慢API数量
- 显示响应时间超过2秒的API数量
- 帮助识别性能瓶颈

### 热门页面
- 显示访问量最高的页面
- 包含页面加载时间信息

## 📊 趋势图表功能

### 内存使用率趋势
- 24小时内存使用率变化曲线
- 帮助识别内存泄漏问题

### API响应时间趋势
- 接口响应时间变化趋势
- 发现性能退化问题

### 错误率趋势
- 应用错误率变化曲线
- 监控系统稳定性

> **注意**：完整图表功能需要集成ECharts组件，当前显示为占位符

## 🚨 性能告警系统

### 告警级别
- 🚨 **严重**：系统崩溃或严重错误
- ❌ **错误**：功能异常或数据错误
- ⚠️ **警告**：性能下降或潜在问题
- ℹ️ **信息**：一般性提示信息

### 告警推送方式
- **弹窗通知**：严重和错误级别告警
- **Toast提示**：警告级别告警
- **静默记录**：信息级别告警

### 告警详情查看
点击任意告警项可查看详细信息：
- 告警类型和级别
- 发生时间和上下文
- 相关错误信息

## 📤 数据导出功能

### 支持格式
- **JSON**：结构化数据，便于程序处理
- **CSV**：表格格式，便于Excel分析
- **TXT**：文本格式，便于阅读

### 导出内容
- 核心性能指标
- 告警历史记录
- 优化建议列表
- 自定义指标数据

### 使用方法
1. 点击"导出"按钮
2. 选择导出格式
3. 数据自动复制到剪贴板
4. 可粘贴到其他应用使用

## 🔍 交互式筛选

### 时间范围筛选
- **24小时**：最近一天的数据
- **7天**：最近一周的数据
- **30天**：最近一个月的数据

### 告警类型筛选
- **全部**：显示所有类型告警
- **错误**：仅显示错误类告警
- **警告**：仅显示警告类告警
- **信息**：仅显示信息类告警

### 严重程度筛选
- **全部**：显示所有级别告警
- **高**：仅显示高级别告警
- **中**：仅显示中级别告警
- **低**：仅显示低级别告警

## 🔧 高级功能

### API调用监控

使用监控版本的API请求：

```javascript
const { monitoredRequest } = require('../../utils/api-monitor')

// 替换原有的wx.request
monitoredRequest({
  url: 'https://api.example.com/data',
  method: 'GET',
  success: (res) => {
    console.log('请求成功', res)
  },
  fail: (err) => {
    console.log('请求失败', err)
  }
})
```

### 告警推送服务

```javascript
const { alertPushService } = require('../../utils/alert-push-service')

// 推送告警
alertPushService.pushAlert({
  level: 'error',
  type: 'api_timeout',
  message: 'API请求超时',
  timestamp: Date.now()
})
```

### 数据导出服务

```javascript
const { dataExportService } = require('../../utils/data-export-service')

// 导出性能数据
const exportData = dataExportService.exportPerformanceData(data, 'json')
dataExportService.copyToClipboard(exportData.content)
```

## 📱 分享功能

### 分享内容
- 性能监控报告摘要
- 核心指标概览
- 告警统计信息
- 优化建议数量

### 分享方式
- 微信好友分享
- 朋友圈分享
- 复制链接分享

## ⚙️ 配置选项

### 性能监控配置

```javascript
// 在app.js中配置
const { performanceMonitor } = require('./utils/performance-monitor')

// 设置告警阈值
performanceMonitor.setThresholds({
  memoryUsage: 80,
  apiResponseTime: 2000,
  errorRate: 5
})

// 启用自动优化
performanceMonitor.setAutoOptimize(true)
```

### 告警推送配置

```javascript
const { alertPushService } = require('./utils/alert-push-service')

// 设置告警级别
alertPushService.setAlertLevel('custom', {
  color: '#9c27b0',
  icon: '🔮',
  priority: 2
})

// 设置历史记录数量
alertPushService.setMaxHistory(200)
```

## 🛠️ 故障排除

### 常见问题

1. **数据不显示**
   - 检查网络连接
   - 确认API服务正常运行
   - 查看控制台错误信息

2. **告警不推送**
   - 检查告警推送服务是否启用
   - 确认告警级别配置正确
   - 查看用户权限设置

3. **导出失败**
   - 检查数据格式是否正确
   - 确认剪贴板权限
   - 查看存储空间是否充足

### 调试方法

1. **查看控制台日志**
   ```javascript
   console.log('性能数据:', performanceMonitor.getPerformanceReport())
   ```

2. **检查本地存储**
   ```javascript
   console.log('告警历史:', wx.getStorageSync('alertHistory'))
   ```

3. **验证API监控**
   ```javascript
   console.log('API统计:', apiMonitor.getAPIStats())
   ```

## 📞 技术支持

如遇到问题，请：

1. 查看控制台错误信息
2. 检查网络连接状态
3. 确认小程序版本兼容性
4. 联系技术支持团队

---

**版本**：1.0  
**更新时间**：2025年7月6日  
**维护团队**：茶叶批发平台开发组 