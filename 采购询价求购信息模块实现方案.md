# 采购询价/求购信息模块实现方案

## 1. 功能概述

采购询价/求购信息模块是茶叶一点通小程序的核心功能之一，为茶叶采购商和供应商搭建信息对接平台。买家可以发布求购信息，商户可以浏览和联系买家，实现供需精准匹配。

## 2. 功能架构

### 2.1 用户角色
- **买家（采购商）**：发布求购信息，管理自己的求购信息
- **商户（供应商）**：浏览求购信息，联系买家

### 2.2 核心功能
1. **求购信息发布**：买家填写详细的求购需求
2. **信息展示浏览**：商户查看求购信息列表
3. **详情查看**：查看求购信息详细内容
4. **联系沟通**：商户联系买家（认证商户可见联系信息）
5. **信息管理**：买家管理自己的求购信息
6. **收藏功能**：商户收藏感兴趣的求购信息

## 3. 页面结构

### 3.1 主要页面
- `pages/inquiry/inquiry` - 求购信息发布页面
- `pages/inquiry-detail/inquiry-detail` - 求购信息详情页面
- `pages/inquiry-manage/inquiry-manage` - 求购信息管理页面

### 3.2 页面功能

#### 3.2.1 求购信息发布页面 (`inquiry`)
**功能特点：**
- 多级分类选择（茶叶分类）
- 数量单位选择
- 详细描述填写（支持500字符）
- 预算范围设置
- 地区三级联动选择
- 附件上传（最多9张图片）
- 表单验证
- 预览和提交功能

**表单字段：**
- 求购品类（必填）：一级分类 + 子分类
- 求购数量（必填）：数量 + 单位
- 要求描述（必填）：详细规格要求
- 预算范围（可选）：最低-最高预算
- 收货地区（推荐）：省-市-区三级联动
- 期望联系时间：工作时间/随时/指定时间
- 有效期限：7天/15天/30天/自定义
- 附件上传：样品图片、规格书等

#### 3.2.2 求购信息详情页面 (`inquiry-detail`)
**功能特点：**
- 完整信息展示
- 发布者信息展示
- 统计数据显示（浏览、报价、收藏）
- 联系信息展示（仅认证商户可见）
- 附件图片预览
- 收藏和分享功能
- 买家操作（编辑、关闭）

**权限控制：**
- 买家：可编辑、关闭自己的求购信息
- 商户：可查看联系信息、联系买家

#### 3.2.3 求购信息管理页面 (`inquiry-manage`)
**功能特点：**
- 标签页切换（我的求购/收藏的求购）
- 状态筛选（求购中/已过期/已关闭）
- 分类筛选
- 信息列表展示
- 操作按钮（编辑、关闭、删除、取消收藏）

## 4. 数据结构设计

### 4.1 求购信息数据结构
```javascript
{
  id: 'string',                    // 求购信息ID
  title: 'string',                 // 求购标题
  category: 'string',              // 一级分类
  subCategory: 'string',           // 子分类
  quantity: number,                // 数量
  unit: 'string',                  // 单位
  description: 'string',           // 详细描述
  budgetMin: number,               // 最低预算
  budgetMax: number,               // 最高预算
  province: 'string',              // 省份
  city: 'string',                  // 城市
  district: 'string',              // 区县
  contactTime: 'string',           // 期望联系时间
  validDays: number,               // 有效天数
  publishTime: 'string',           // 发布时间
  expireTime: 'string',            // 到期时间
  status: 'active|expired|closed', // 状态
  statusText: 'string',            // 状态文本
  attachments: ['string'],         // 附件图片URL数组
  publisher: {                     // 发布者信息
    id: 'string',
    nickname: 'string',
    avatar: 'string',
    verified: boolean,
    contact: {
      phone: 'string',
      wechat: 'string',
      qrcode: 'string'
    }
  },
  stats: {                         // 统计数据
    viewCount: number,
    quoteCount: number,
    favoriteCount: number
  }
}
```

### 4.2 茶叶分类数据
```javascript
{
  '绿茶': ['西湖龙井', '碧螺春', '黄山毛峰', '信阳毛尖', '六安瓜片'],
  '红茶': ['正山小种', '祁门红茶', '滇红', '川红', '宁红'],
  '乌龙茶': ['大红袍', '铁观音', '凤凰单丛', '冻顶乌龙', '水仙'],
  '黑茶': ['普洱茶', '安化黑茶', '六堡茶', '茯砖茶'],
  '白茶': ['白毫银针', '白牡丹', '贡眉', '寿眉'],
  '黄茶': ['君山银针', '蒙顶黄芽', '霍山黄芽'],
  '花茶': ['茉莉花茶', '玫瑰花茶', '桂花茶', '菊花茶']
}
```

## 5. 技术实现

### 5.1 前端技术栈
- **框架**：微信小程序原生开发
- **样式**：WXSS + Flexbox布局
- **数据绑定**：双向数据绑定
- **组件**：微信小程序内置组件

### 5.2 核心功能实现

#### 5.2.1 表单验证
```javascript
// 表单验证逻辑
validateForm() {
  const errors = {}
  
  if (!this.data.formData.category) {
    errors.category = '请选择求购品类'
  }
  if (!this.data.formData.subCategory) {
    errors.subCategory = '请选择具体分类'
  }
  if (!this.data.formData.quantity || this.data.formData.quantity <= 0) {
    errors.quantity = '请输入有效的求购数量'
  }
  if (!this.data.formData.description || this.data.formData.description.length < 10) {
    errors.description = '请详细描述求购要求（至少10个字符）'
  }
  
  return errors
}
```

#### 5.2.2 图片上传
```javascript
// 选择图片
chooseAttachment() {
  wx.chooseImage({
    count: 9 - this.data.formData.attachments.length,
    sizeType: ['compressed'],
    sourceType: ['album', 'camera'],
    success: (res) => {
      const newAttachments = [...this.data.formData.attachments, ...res.tempFilePaths]
      this.setData({
        'formData.attachments': newAttachments
      })
    }
  })
}
```

#### 5.2.3 地区三级联动
```javascript
// 省份选择
onProvinceChange(e) {
  const index = e.detail.value
  const province = this.data.provinces[index]
  
  this.setData({
    'formData.province': province.name,
    'formData.city': '',
    'formData.district': ''
  })
}
```

### 5.3 权限控制
- **联系信息可见性**：仅认证商户可查看买家联系信息
- **编辑权限**：仅求购信息发布者可编辑
- **操作权限**：根据用户角色和求购状态显示不同操作按钮

## 6. 用户体验设计

### 6.1 交互设计
- **表单引导**：清晰的字段说明和必填标识
- **实时验证**：输入时实时显示验证结果
- **预览功能**：提交前预览完整信息
- **状态反馈**：操作结果及时反馈

### 6.2 视觉设计
- **色彩搭配**：主色调绿色（#4CAF50）体现茶叶主题
- **布局清晰**：信息层次分明，重点突出
- **响应式设计**：适配不同屏幕尺寸

### 6.3 性能优化
- **图片压缩**：上传图片自动压缩
- **分页加载**：列表分页加载，提升性能
- **缓存机制**：常用数据本地缓存

## 7. 安全考虑

### 7.1 数据安全
- **敏感信息保护**：联系信息仅对认证商户可见
- **输入验证**：防止XSS攻击和恶意输入
- **权限验证**：操作前验证用户权限

### 7.2 内容审核
- **信息审核**：求购信息发布前进行内容审核
- **举报机制**：用户可举报不当信息
- **黑名单机制**：违规用户加入黑名单

## 8. 后续扩展

### 8.1 功能扩展
- **智能推荐**：基于用户行为推荐相关求购信息
- **消息通知**：求购信息状态变更通知
- **数据分析**：求购信息数据统计和分析
- **移动端适配**：开发H5版本

### 8.2 技术优化
- **后端API**：开发完整的后端API接口
- **数据库设计**：设计完整的数据库结构
- **缓存策略**：实现Redis缓存机制
- **监控告警**：系统监控和异常告警

## 9. 测试计划

### 9.1 功能测试
- 表单填写和验证测试
- 图片上传功能测试
- 权限控制测试
- 页面跳转测试

### 9.2 兼容性测试
- 不同微信版本兼容性
- 不同设备适配测试
- 网络环境测试

### 9.3 性能测试
- 页面加载速度测试
- 图片上传性能测试
- 内存使用情况测试

## 10. 部署方案

### 10.1 开发环境
- 微信开发者工具
- 本地开发服务器
- 测试数据准备

### 10.2 生产环境
- 微信小程序平台
- 云开发环境
- 数据备份策略

## 11. 维护计划

### 11.1 日常维护
- 功能监控和问题修复
- 用户反馈收集和处理
- 数据备份和恢复

### 11.2 版本更新
- 功能迭代和优化
- 安全补丁更新
- 用户体验改进

---

**文档版本**：v1.0  
**创建时间**：2024年1月  
**最后更新**：2024年1月  
**负责人**：开发团队 