<!-- èŒ¶å›­å‘å¸ƒé¡µé¢ -->
<view class="publish-page">
  <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
  <view class="step-indicator">
    <view class="step-item {{currentStep >= 1 ? 'active' : ''}}">
      <view class="step-number">1</view>
      <text class="step-text">åŸºæœ¬ä¿¡æ¯</text>
    </view>
    <view class="step-line {{currentStep >= 2 ? 'active' : ''}}"></view>
    <view class="step-item {{currentStep >= 2 ? 'active' : ''}}">
      <view class="step-number">2</view>
      <text class="step-text">ä»·æ ¼ä¿¡æ¯</text>
    </view>
    <view class="step-line {{currentStep >= 3 ? 'active' : ''}}"></view>
    <view class="step-item {{currentStep >= 3 ? 'active' : ''}}">
      <view class="step-number">3</view>
      <text class="step-text">å›¾ç‰‡ä¸Šä¼ </text>
    </view>
  </view>

  <!-- è¡¨å•å†…å®¹ -->
  <view class="form-content">
    <!-- ç¬¬ä¸€æ­¥ï¼šåŸºæœ¬ä¿¡æ¯ -->
    <view class="form-step" wx:if="{{currentStep === 1}}">
      <view class="step-title">èŒ¶å›­åŸºæœ¬ä¿¡æ¯</view>
      
      <!-- èŒ¶å›­åç§° -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">èŒ¶å›­åç§°</text>
          <text class="required">*</text>
        </view>
        <input 
          class="form-input {{!validation.name.valid ? 'error' : ''}}"
          placeholder="è¯·è¾“å…¥èŒ¶å›­åç§°"
          value="{{formData.name}}"
          data-field="name"
          bindinput="onInputChange"
        />
        <text class="error-message" wx:if="{{!validation.name.valid}}">{{validation.name.message}}</text>
      </view>

      <!-- èŒ¶å›­ä½ç½® -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">èŒ¶å›­ä½ç½®</text>
          <text class="required">*</text>
        </view>
        <view class="location-input" bindtap="chooseLocation">
          <text class="location-text {{formData.location ? '' : 'placeholder'}}">
            {{formData.location || 'ç‚¹å‡»é€‰æ‹©èŒ¶å›­ä½ç½®'}}
          </text>
          <text class="location-icon">ğŸ“</text>
        </view>
        <text class="error-message" wx:if="{{!validation.location.valid}}">{{validation.location.message}}</text>
      </view>

      <!-- ç§æ¤é¢ç§¯ -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">ç§æ¤é¢ç§¯</text>
          <text class="required">*</text>
        </view>
        <view class="area-input">
          <input 
            class="form-input area-value {{!validation.area.valid ? 'error' : ''}}"
            placeholder="è¯·è¾“å…¥é¢ç§¯"
            value="{{formData.area}}"
            data-field="area"
            bindinput="onInputChange"
          />
          <picker 
            class="area-unit"
            range="{{areaUnits}}"
            value="{{areaUnits.indexOf(formData.areaUnit)}}"
            data-field="areaUnit"
            bindchange="onPickerChange"
          >
            <text class="unit-text">{{formData.areaUnit}}</text>
          </picker>
        </view>
        <text class="error-message" wx:if="{{!validation.area.valid}}">{{validation.area.message}}</text>
      </view>

      <!-- èŒ¶å¶ç±»å‹ -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">èŒ¶å¶ç±»å‹</text>
          <text class="required">*</text>
          <text class="label-desc">ï¼ˆå¯å¤šé€‰ï¼‰</text>
        </view>
        <view class="selection-tip">
          <text class="tip-text">ğŸ’¡ ç‚¹å‡»æ ‡ç­¾è¿›è¡Œé€‰æ‹©ï¼Œå¯å¤šé€‰</text>
        </view>
        <view class="tea-type-tags">
          <view 
            wx:for="{{teaTypeOptions}}" 
            wx:key="*this"
            class="tea-type-tag {{formData.teaTypes.indexOf(item) > -1 ? 'selected' : ''}}"
            data-tea-type="{{item}}"
            catchtap="onTeaTypeToggle"
            hover-class="tea-type-tag-hover"
          >
            {{item}}
          </view>
        </view>
        <view class="selection-status" wx:if="{{formData.teaTypes.length > 0}}">
          <text class="status-text">å·²é€‰æ‹©: {{formData.teaTypes.join('ã€')}}</text>
          <text class="clear-btn" bindtap="clearTeaTypes">æ¸…ç©º</text>
        </view>
        <!-- é€‰æ‹©çŠ¶æ€æ˜¾ç¤º -->
        <view class="selection-display" wx:if="{{formData.teaTypes.length > 0}}">
          <view class="selected-items">
            <view class="selected-item" wx:for="{{formData.teaTypes}}" wx:key="*this">
              <text class="item-text">{{item}}</text>
              <text class="remove-btn" data-tea-type="{{item}}" bindtap="onTeaTypeToggle">Ã—</text>
            </view>
          </view>
        </view>
        <!-- è°ƒè¯•ä¿¡æ¯ -->
        <view class="debug-info" style="font-size: 20rpx; color: #999; margin-top: 10rpx;">
          <text>è°ƒè¯•: æ•°ç»„é•¿åº¦={{formData.teaTypes.length}}, å†…å®¹=[{{formData.teaTypes.join(',')}}]</text>
        </view>
        <text class="error-message" wx:if="{{!validation.teaTypes.valid}}">{{validation.teaTypes.message}}</text>
      </view>

      <!-- ç‰¹è‰²æ ‡ç­¾ -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">ç‰¹è‰²æ ‡ç­¾</text>
          <text class="label-desc">ï¼ˆæœ€å¤šé€‰æ‹©6ä¸ªï¼‰</text>
        </view>
        <view class="selection-tip">
          <text class="tip-text">ğŸ’¡ ç‚¹å‡»æ ‡ç­¾è¿›è¡Œé€‰æ‹©ï¼Œæœ€å¤š6ä¸ª</text>
        </view>
        <view class="feature-tags">
          <view 
            wx:for="{{featureOptions}}" 
            wx:key="*this"
            class="feature-tag {{formData.features.indexOf(item) > -1 ? 'selected' : ''}}"
            data-feature="{{item}}"
            catchtap="onFeatureToggle"
            hover-class="feature-tag-hover"
          >
            {{item}}
          </view>
        </view>
        <view class="selection-status" wx:if="{{formData.features.length > 0}}">
          <text class="status-text">å·²é€‰æ‹©: {{formData.features.join('ã€')}}</text>
          <text class="clear-btn" bindtap="clearFeatures">æ¸…ç©º</text>
        </view>
        <!-- é€‰æ‹©çŠ¶æ€æ˜¾ç¤º -->
        <view class="selection-display feature-selection" wx:if="{{formData.features.length > 0}}">
          <view class="selected-items">
            <view class="selected-item feature-item" wx:for="{{formData.features}}" wx:key="*this">
              <text class="item-text">{{item}}</text>
              <text class="remove-btn" data-feature="{{item}}" bindtap="onFeatureToggle">Ã—</text>
            </view>
          </view>
        </view>
        <!-- è°ƒè¯•ä¿¡æ¯ -->
        <view class="debug-info" style="font-size: 20rpx; color: #999; margin-top: 10rpx;">
          <text>è°ƒè¯•: æ•°ç»„é•¿åº¦={{formData.features.length}}, å†…å®¹=[{{formData.features.join(',')}}]</text>
        </view>
      </view>

      <!-- èŒ¶å›­æè¿° -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">èŒ¶å›­æè¿°</text>
        </view>
        <textarea 
          class="form-textarea"
          placeholder="è¯·æè¿°èŒ¶å›­ç‰¹è‰²ã€ç§æ¤å†å²ã€å“è´¨ç‰¹ç‚¹ç­‰"
          value="{{formData.description}}"
          data-field="description"
          bindinput="onInputChange"
          maxlength="500"
        ></textarea>
        <text class="char-count">{{formData.description.length}}/500</text>
      </view>
    </view>

    <!-- ç¬¬äºŒæ­¥ï¼šä»·æ ¼ä¿¡æ¯ -->
    <view class="form-step" wx:if="{{currentStep === 2}}">
      <view class="step-title">ä»·æ ¼ä¸äº¤æ˜“ä¿¡æ¯</view>
      
      <!-- é‡‡æ‘˜æœŸ -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">é‡‡æ‘˜æœŸ</text>
          <text class="required">*</text>
        </view>
        <input 
          class="form-input {{!validation.harvestPeriod.valid ? 'error' : ''}}"
          placeholder="å¦‚ï¼š3.15-4.5"
          value="{{formData.harvestPeriod}}"
          data-field="harvestPeriod"
          bindinput="onInputChange"
        />
        <text class="error-message" wx:if="{{!validation.harvestPeriod.valid}}">{{validation.harvestPeriod.message}}</text>
      </view>

      <!-- ä»·æ ¼ -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">ä»·æ ¼</text>
          <text class="required">*</text>
        </view>
        <view class="price-input">
          <input 
            class="form-input price-value {{!validation.price.valid ? 'error' : ''}}"
            placeholder="è¯·è¾“å…¥ä»·æ ¼"
            value="{{formData.price}}"
            data-field="price"
            bindinput="onInputChange"
          />
          <picker 
            class="price-unit"
            range="{{priceUnits}}"
            value="{{priceUnits.indexOf(formData.priceUnit)}}"
            data-field="priceUnit"
            bindchange="onPickerChange"
          >
            <text class="unit-text">{{formData.priceUnit}}</text>
          </picker>
        </view>
        <text class="error-message" wx:if="{{!validation.price.valid}}">{{validation.price.message}}</text>
      </view>

      <!-- èµ·è®¢é‡ -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">èµ·è®¢é‡</text>
          <text class="required">*</text>
        </view>
        <input 
          class="form-input {{!validation.minOrder.valid ? 'error' : ''}}"
          placeholder="è¯·è¾“å…¥èµ·è®¢é‡"
          value="{{formData.minOrder}}"
          data-field="minOrder"
          bindinput="onInputChange"
        />
        <text class="error-message" wx:if="{{!validation.minOrder.valid}}">{{validation.minOrder.message}}</text>
      </view>

      <!-- å‘è´§æ—¶é—´ -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">å‘è´§æ—¶é—´</text>
        </view>
        <picker 
          class="form-picker"
          range="{{deliveryOptions}}"
          value="{{deliveryOptions.indexOf(formData.delivery)}}"
          data-field="delivery"
          bindchange="onPickerChange"
        >
          <text class="picker-text">{{formData.delivery}}</text>
          <text class="picker-arrow">></text>
        </picker>
      </view>

      <!-- ä¿éšœæœåŠ¡ -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">ä¿éšœæœåŠ¡</text>
        </view>
        <picker 
          class="form-picker"
          range="{{guaranteeOptions}}"
          value="{{guaranteeOptions.indexOf(formData.guarantee)}}"
          data-field="guarantee"
          bindchange="onPickerChange"
        >
          <text class="picker-text">{{formData.guarantee}}</text>
          <text class="picker-arrow">></text>
        </picker>
      </view>

      <!-- æ”¯ä»˜æ–¹å¼ -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">æ”¯ä»˜æ–¹å¼</text>
        </view>
        <view class="payment-tags">
          <view 
            wx:for="{{paymentOptions}}" 
            wx:key="*this"
            class="payment-tag {{formData.payment.indexOf(item) > -1 ? 'selected' : ''}}"
            data-payment="{{item}}"
            bindtap="onPaymentToggle"
          >
            {{item}}
          </view>
        </view>
      </view>
    </view>

    <!-- ç¬¬ä¸‰æ­¥ï¼šå›¾ç‰‡ä¸Šä¼  -->
    <view class="form-step" wx:if="{{currentStep === 3}}">
      <view class="step-title">èŒ¶å›­å›¾ç‰‡</view>
      
      <view class="upload-section">
        <view class="upload-tips">
          <text class="tip-text">è¯·ä¸Šä¼ èŒ¶å›­å®æ™¯ç…§ç‰‡ï¼Œè‡³å°‘1å¼ ï¼Œæœ€å¤š9å¼ </text>
          <text class="tip-text">å»ºè®®ä¸Šä¼ èŒ¶å›­ç¯å¢ƒã€èŒ¶å¶ç‰¹å†™ã€é‡‡æ‘˜åœºæ™¯ç­‰</text>
        </view>
        
        <view class="image-list">
          <view 
            wx:for="{{formData.images}}" 
            wx:key="*this"
            class="image-item"
          >
            <image 
              class="uploaded-image" 
              src="{{item}}" 
              mode="aspectFill"
              data-current="{{item}}"
              bindtap="previewImage"
            ></image>
            <view 
              class="delete-btn"
              data-index="{{index}}"
              bindtap="deleteImage"
            >
              <text class="delete-icon">Ã—</text>
            </view>
          </view>
          
          <view 
            class="upload-btn"
            bindtap="chooseImage"
            wx:if="{{formData.images.length < 9}}"
          >
            <text class="upload-icon">+</text>
            <text class="upload-text">æ·»åŠ å›¾ç‰‡</text>
          </view>
        </view>
        
        <text class="image-count">{{formData.images.length}}/9</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
  <view class="bottom-actions">
    <view class="action-buttons">
      <button 
        class="action-btn secondary-btn"
        bindtap="saveDraft"
        wx:if="{{currentStep === 1}}"
      >
        ä¿å­˜è‰ç¨¿
      </button>
      
      <button 
        class="action-btn secondary-btn"
        bindtap="prevStep"
        wx:if="{{currentStep > 1}}"
      >
        ä¸Šä¸€æ­¥
      </button>
      
      <button 
        class="action-btn primary-btn"
        bindtap="nextStep"
        wx:if="{{currentStep < totalSteps}}"
      >
        ä¸‹ä¸€æ­¥
      </button>
      
      <button 
        class="action-btn submit-btn"
        bindtap="submitForm"
        loading="{{submitting}}"
        wx:if="{{currentStep === totalSteps}}"
      >
        å‘å¸ƒèŒ¶å›­
      </button>
    </view>
    
    <button 
      class="reset-btn"
      bindtap="resetForm"
    >
      é‡ç½®è¡¨å•
    </button>
  </view>
</view> 