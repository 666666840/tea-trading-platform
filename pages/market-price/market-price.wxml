<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-left">
      <text class="header-subtitle">å®æ—¶ä»·æ ¼ï¼Œå¸‚åœºåŠ¨æ€</text>
    </view>
    <view class="header-right">
      <button class="publish-btn" bindtap="publishPrice">
        <text class="btn-icon">ğŸ“</text>
        <text class="btn-text">å‘å¸ƒä»·æ ¼</text>
      </button>
    </view>
  </view>

  <!-- ç­›é€‰å’Œæ’åºæ  -->
  <view class="filter-sort-bar">
    <!-- ç­›é€‰æŒ‰é’® -->
    <view class="filter-section">
      <button class="filter-btn" bindtap="toggleFilterPanel">
        <text class="btn-icon">ğŸ”</text>
        <text class="btn-text">{{filters.city}} Â· {{filters.category}}</text>
        <text class="btn-arrow">{{showFilterPanel ? 'â–²' : 'â–¼'}}</text>
      </button>
    </view>
    
    <!-- æ’åºæŒ‰é’® -->
    <view class="sort-section">
      <button class="sort-btn" bindtap="toggleSortOptions">
        <text class="btn-icon">ğŸ“Š</text>
        <text class="btn-text">
          {{sortType === 'recommend' ? 'æ¨èæ’åº' : 
            sortType === 'price' ? 'æŒ‰ä»·æ ¼' : 
            sortType === 'rating' ? 'æŒ‰å¥½è¯„' : 'æŒ‰è·ç¦»'}}
        </text>
        <text class="btn-arrow">{{showSortOptions ? 'â–²' : 'â–¼'}}</text>
      </button>
    </view>
  </view>

  <!-- ç­›é€‰é¢æ¿ -->
  <view class="filter-panel" wx:if="{{showFilterPanel}}">
    <!-- åŸå¸‚é€‰æ‹© -->
    <view class="filter-group">
      <text class="group-title">é€‰æ‹©åŸå¸‚</text>
      <view class="option-list">
        <text class="option-item {{filters.city === city ? 'active' : ''}}" 
              wx:for="{{cities}}" 
              wx:key="*this"
              wx:for-item="city"
              bindtap="selectCity"
              data-city="{{city}}">
          {{city}}
        </text>
      </view>
    </view>
    
    <!-- èŒ¶ç±»é€‰æ‹© -->
    <view class="filter-group">
      <text class="group-title">é€‰æ‹©èŒ¶ç±»</text>
      <view class="option-list">
        <text class="option-item {{filters.category === category ? 'active' : ''}}" 
              wx:for="{{teaCategories}}" 
              wx:key="*this"
              wx:for-item="subCategories"
              wx:for-index="category"
              bindtap="selectCategory"
              data-category="{{category}}">
          {{category}}
        </text>
      </view>
    </view>
    
    <!-- å…·ä½“å“ç±»é€‰æ‹© -->
    <view class="filter-group" wx:if="{{filters.category !== 'å…¨éƒ¨èŒ¶ç±»'}}">
      <text class="group-title">é€‰æ‹©å“ç±»</text>
      <view class="option-list">
        <text class="option-item {{filters.subCategory === subCategory ? 'active' : ''}}" 
              wx:for="{{teaCategories[filters.category]}}" 
              wx:key="*this"
              wx:for-item="subCategory"
              bindtap="selectSubCategory"
              data-subcategory="{{subCategory}}">
          {{subCategory}}
        </text>
      </view>
    </view>
  </view>

  <!-- æ’åºé€‰é¡¹ -->
  <view class="sort-panel" wx:if="{{showSortOptions}}">
    <view class="sort-option {{sortType === 'recommend' ? 'active' : ''}}" 
          bindtap="selectSort" 
          data-sort="recommend">
      <text class="option-text">æ¨èæ’åº</text>
      <text class="option-desc">ç»¼åˆè¯„åˆ†ã€å’¨è¯¢é‡ã€æ›´æ–°çŠ¶æ€</text>
    </view>
    <view class="sort-option {{sortType === 'price' ? 'active' : ''}}" 
          bindtap="selectSort" 
          data-sort="price"
          data-direction="{{sortType === 'price' && sortDirection === 'asc' ? 'desc' : 'asc'}}">
      <text class="option-text">æŒ‰ä»·æ ¼</text>
      <text class="option-desc">{{sortType === 'price' && sortDirection === 'asc' ? 'é«˜â†’ä½' : 'ä½â†’é«˜'}}</text>
    </view>
    <view class="sort-option {{sortType === 'rating' ? 'active' : ''}}" 
          bindtap="selectSort" 
          data-sort="rating">
      <text class="option-text">æŒ‰å¥½è¯„</text>
      <text class="option-desc">è¯„åˆ†ç”±é«˜åˆ°ä½</text>
    </view>
    <view class="sort-option {{sortType === 'distance' ? 'active' : ''}}" 
          bindtap="selectSort" 
          data-sort="distance">
      <text class="option-text">æŒ‰è·ç¦»</text>
      <text class="option-desc">{{locationAuthorized ? 'è·ç¦»ç”±è¿‘åˆ°è¿œ' : 'åŒåŸä¼˜å…ˆ'}}</text>
    </view>
  </view>

  <!-- ä»·æ ¼åˆ—è¡¨ -->
  <view class="price-list" wx:if="{{filteredData.length > 0}}">
    <view class="price-item" 
          wx:for="{{filteredData}}" 
          wx:key="id"
          wx:for-item="item">
      
      <!-- ä»·æ ¼å¡ç‰‡å¤´éƒ¨ -->
      <view class="price-header">
        <view class="price-title">
          <text class="tea-name">{{item.subCategory}}</text>
          <text class="city-name">{{item.city}}</text>
        </view>
        <view class="status-badge {{item.updateStatus}}">
          <text class="status-dot"></text>
          <text class="status-text">{{item.statusText}}</text>
        </view>
      </view>
      
      <!-- ä»·æ ¼å¡ç‰‡å†…å®¹ -->
      <view class="price-content" bindtap="viewPriceDetail" data-id="{{item.id}}">
        <view class="price-main">
          <view class="price-range">
            <text class="price-text">{{item.priceRange}}</text>
            <text class="price-unit">{{item.unit}}</text>
          </view>
          <view class="price-trend">
            <text class="trend-icon">
              {{item.trend === 'rising' ? 'ğŸ“ˆ' : item.trend === 'falling' ? 'ğŸ“‰' : 'ğŸ“Š'}}
            </text>
            <text class="trend-text">{{item.trendText}}</text>
          </view>
        </view>
        
        <view class="price-info">
          <view class="info-item">
            <text class="info-label">å•†æˆ·æ•°é‡</text>
            <text class="info-value">{{item.merchantCount}}å®¶</text>
          </view>
          <view class="info-item">
            <text class="info-label">æ›´æ–°æ—¶é—´</text>
            <text class="info-value">{{item.updateTime}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">å¥½è¯„åº¦</text>
            <text class="info-value">{{item.rating}}åˆ†</text>
          </view>
          <view class="info-item" wx:if="{{locationAuthorized}}">
            <text class="info-label">è·ç¦»</text>
            <text class="info-value">{{item.distance}}km</text>
          </view>
        </view>
        
        <view class="price-desc">
          <text class="desc-text">{{item.description}}</text>
        </view>
        
        <!-- æ ‡ç­¾ä¿¡æ¯ -->
        <view class="price-tags">
          <view class="tag-item" wx:if="{{item.hasImages}}">
            <text class="tag-icon">ğŸ“·</text>
            <text class="tag-text">å®æ‹å›¾</text>
          </view>
          <view class="tag-item" wx:if="{{item.hasOrigin}}">
            <text class="tag-icon">ğŸ“</text>
            <text class="tag-text">äº§åœ°ä¿¡æ¯</text>
          </view>
          <view class="tag-item" wx:if="{{item.process}}">
            <text class="tag-icon">âš™ï¸</text>
            <text class="tag-text">{{item.process}}</text>
          </view>
        </view>
      </view>
      
      <!-- ä»·æ ¼å¡ç‰‡åº•éƒ¨ -->
      <view class="price-footer">
        <view class="footer-left">
          <button class="detail-btn" bindtap="viewPriceDetail" data-id="{{item.id}}">
            <text class="btn-text">æŸ¥çœ‹è¯¦æƒ…</text>
            <text class="btn-arrow">â†’</text>
          </button>
        </view>
        <view class="footer-right">
          <text class="inquiry-count">{{item.inquiryCount}}æ¬¡å’¨è¯¢</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{filteredData.length === 0}}">
    <view class="empty-icon">ğŸ”</view>
    <text class="empty-title">æš‚æ— ç›¸å…³ä»·æ ¼ä¿¡æ¯</text>
    <text class="empty-desc">è¯·å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶æˆ–ç¨åå†è¯•</text>
    <button class="reset-btn" bindtap="resetFilters">
      <text class="btn-text">é‡ç½®ç­›é€‰</text>
    </button>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- åº•éƒ¨æç¤º -->
  <view class="bottom-tip">
    <text class="tip-text">æœ¬æŠ¥ä»·ç”±å•†æˆ·æä¾›ï¼Œä»…ä¾›å‚è€ƒ</text>
  </view>
</view> 