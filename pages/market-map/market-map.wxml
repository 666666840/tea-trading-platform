<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-left">
      <text class="header-title">è¡Œæƒ…åœ°å›¾</text>
      <text class="header-subtitle">å…¨å›½èŒ¶å¶ä»·æ ¼åˆ†å¸ƒ</text>
    </view>
    <view class="header-right">
      <button class="refresh-btn" bindtap="refreshData">
        <text class="btn-icon">ğŸ”„</text>
      </button>
      <button class="location-btn" bindtap="moveToUserLocation">
        <text class="btn-icon">ğŸ“</text>
      </button>
    </view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="statistics-section">
    <view class="stat-item">
      <text class="stat-value">{{statistics.totalCities}}</text>
      <text class="stat-label">è¦†ç›–åŸå¸‚</text>
    </view>
    <view class="stat-item">
      <text class="stat-value">{{statistics.totalMerchants}}</text>
      <text class="stat-label">å•†æˆ·æ•°é‡</text>
    </view>
    <view class="stat-item">
      <text class="stat-value">{{statistics.avgPrice}}</text>
      <text class="stat-label">å¹³å‡ä»·æ ¼</text>
    </view>
    <view class="stat-item">
      <text class="stat-value">{{statistics.priceRange}}</text>
      <text class="stat-label">ä»·æ ¼åŒºé—´</text>
    </view>
  </view>

  <!-- ç­›é€‰åŒºåŸŸ -->
  <view class="filter-section">
    <view class="filter-row">
      <text class="filter-label">èŒ¶ç±»ç­›é€‰</text>
      <scroll-view class="category-tabs" scroll-x="true">
        <view class="category-tab {{filterCategory === item ? 'active' : ''}}" 
              wx:for="{{categoryList}}" 
              wx:key="*this"
              wx:for-item="item"
              bindtap="selectCategory" 
              data-category="{{item}}">
          {{item}}
        </view>
      </scroll-view>
    </view>
    
    <view class="filter-row" wx:if="{{filterCategory && subCategoryList.length > 0}}">
      <text class="filter-label">å…·ä½“å“ç±»</text>
      <scroll-view class="subcategory-tabs" scroll-x="true">
        <view class="subcategory-tab {{filterSubCategory === item ? 'active' : ''}}" 
              wx:for="{{subCategoryList}}" 
              wx:key="*this"
              wx:for-item="item"
              bindtap="selectSubCategory" 
              data-subcategory="{{item}}">
          {{item}}
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- æ˜¾ç¤ºæ¨¡å¼åˆ‡æ¢ -->
  <view class="mode-switch">
    <view class="mode-item {{displayMode === 'map' ? 'active' : ''}}" 
          bindtap="switchDisplayMode" 
          data-mode="map">
      <text class="mode-icon">ğŸ—ºï¸</text>
      <text class="mode-text">åœ°å›¾</text>
    </view>
    <view class="mode-item {{displayMode === 'list' ? 'active' : ''}}" 
          bindtap="switchDisplayMode" 
          data-mode="list">
      <text class="mode-icon">ğŸ“‹</text>
      <text class="mode-text">åˆ—è¡¨</text>
    </view>
    <view class="mode-item {{displayMode === 'trend' ? 'active' : ''}}" 
          bindtap="switchDisplayMode" 
          data-mode="trend">
      <text class="mode-icon">ğŸ“ˆ</text>
      <text class="mode-text">è¶‹åŠ¿</text>
    </view>
  </view>

  <!-- åœ°å›¾æ¨¡å¼ -->
  <view class="map-container" wx:if="{{displayMode === 'map'}}">
    <map class="market-map"
         latitude="{{mapConfig.latitude}}"
         longitude="{{mapConfig.longitude}}"
         scale="{{mapConfig.scale}}"
         markers="{{mapConfig.markers}}"
         polyline="{{mapConfig.polyline}}"
         bindmarkertap="onMarkerTap"
         bindregionchange="onRegionChange"
         show-location="true">
    </map>
    
    <!-- åœ°å›¾å›¾ä¾‹ -->
    <view class="map-legend">
      <view class="legend-item">
        <view class="legend-icon updated"></view>
        <text class="legend-text">ä»Šæ—¥æ›´æ–°</text>
      </view>
      <view class="legend-item">
        <view class="legend-icon recent"></view>
        <text class="legend-text">æœ€è¿‘æ›´æ–°</text>
      </view>
      <view class="legend-item">
        <view class="legend-icon outdated"></view>
        <text class="legend-text">è¿‡æœŸæ•°æ®</text>
      </view>
    </view>
  </view>

  <!-- åˆ—è¡¨æ¨¡å¼ -->
  <view class="list-container" wx:if="{{displayMode === 'list'}}">
    <view class="list-header">
      <text class="list-title">ä»·æ ¼åˆ—è¡¨</text>
      <text class="list-count">({{mapData.length}}æ¡)</text>
    </view>
    
    <view class="price-list">
      <view class="price-item" 
            wx:for="{{mapData}}" 
            wx:key="id"
            wx:for-item="item"
            bindtap="navigateToDetail" 
            data-id="{{item.id}}">
        <view class="item-header">
          <view class="item-title">
            <text class="city-name">{{item.city}}</text>
            <text class="tea-name">{{item.subCategory}}</text>
          </view>
          <view class="status-badge {{item.status}}">
            <text class="status-dot"></text>
            <text class="status-text">{{item.updateTime}}</text>
          </view>
        </view>
        
        <view class="item-content">
          <view class="price-info">
            <text class="price-range">{{item.priceRange}}</text>
            <text class="price-unit">{{item.unit}}</text>
          </view>
          <view class="merchant-info">
            <text class="merchant-count">{{item.merchantCount}}å®¶å•†æˆ·</text>
            <text class="avg-price">å‡ä»·{{item.avgPrice}}{{item.unit}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- è¶‹åŠ¿æ¨¡å¼ -->
  <view class="trend-container" wx:if="{{displayMode === 'trend'}}">
    <view class="trend-header">
      <text class="trend-title">ä»·æ ¼è¶‹åŠ¿</text>
      <text class="trend-subtitle">è¿‘3ä¸ªæœˆä»·æ ¼å˜åŒ–</text>
    </view>
    
    <view class="trend-charts">
      <view class="trend-chart" 
            wx:for="{{priceTrends}}" 
            wx:key="*this"
            wx:for-item="trend"
            wx:for-index="teaName">
        <view class="chart-header">
          <text class="chart-title">{{teaName}}</text>
        </view>
        <view class="chart-content">
          <view class="trend-line">
            <view class="trend-point" 
                  wx:for="{{trend}}" 
                  wx:key="date"
                  wx:for-item="point"
                  wx:for-index="index"
                  style="left: {{index * 25}}%; bottom: {{(point.price - 600) / 200 * 100}}%">
              <text class="point-price">{{point.price}}</text>
            </view>
          </view>
          <view class="trend-labels">
            <text class="trend-label" 
                  wx:for="{{trend}}" 
                  wx:key="date"
                  wx:for-item="point"
                  wx:for-index="index"
                  style="left: {{index * 25}}%">
              {{point.date}}
            </text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- åº•éƒ¨æç¤º -->
  <view class="bottom-tip">
    <text class="tip-text">æœ¬æŠ¥ä»·ç”±å•†æˆ·æä¾›ï¼Œä»…ä¾›å‚è€ƒ</text>
  </view>
</view> 