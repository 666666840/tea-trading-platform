<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="header">
    <view class="title">å…¨å›½èŒ¶å¶å¸‚åœº</view>
    <view class="subtitle">è¦†ç›–{{totalProvinceCount}}ä¸ªçœä»½ï¼Œ{{totalMarketCount}}ä¸ªå¸‚åœº</view>
  </view>

  <!-- æœç´¢æ¡† -->
  <view class="search-section">
    <view class="search-box">
      <input 
        class="search-input" 
        placeholder="æœç´¢å¸‚åœºåç§°ã€åŸå¸‚æˆ–åŒºåŸŸ" 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearch"
      />
      <view class="search-btn" bindtap="onSearch">æœç´¢</view>
    </view>
    <view class="clear-btn" wx:if="{{searchKeyword}}" bindtap="clearSearch">æ¸…ç©º</view>
  </view>

  <!-- çœä»½åˆ—è¡¨ -->
  <view class="province-section" wx:if="{{!selectedProvince && !showSearchResult}}">
    <view class="section-title">æŒ‰çœä»½æµè§ˆ</view>
    <view class="province-grid">
      <view 
        class="province-item" 
        wx:for="{{provinces}}" 
        wx:key="id"
        bindtap="selectProvince"
        data-id="{{item.id}}"
      >
        <view class="province-name">{{item.name}}</view>
        <view class="market-count">{{item.marketCount}}ä¸ªå¸‚åœº</view>
      </view>
    </view>
  </view>

  <!-- é€‰ä¸­çš„çœä»½ -->
  <view class="selected-province" wx:if="{{selectedProvince}}">
    <view class="province-header">
      <view class="back-btn" bindtap="backToProvinces">â† è¿”å›</view>
      <view class="province-info">
        <view class="province-name">{{selectedProvince.name}}</view>
        <view class="province-stats" wx:if="{{provinceStats}}">
          <text>{{provinceStats.totalCities}}ä¸ªåŸå¸‚</text>
          <text>{{provinceStats.totalDistricts}}ä¸ªåŒºå¿</text>
          <text>{{provinceStats.totalMarkets}}ä¸ªå¸‚åœº</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æœç´¢ç»“æœæ ‡é¢˜ -->
  <view class="search-result-title" wx:if="{{showSearchResult}}">
    <view class="back-btn" bindtap="clearSearch">â† è¿”å›</view>
    <view class="result-info">
      <view class="result-text">æœç´¢ç»“æœ</view>
      <view class="result-count">{{markets.length}}ä¸ªå¸‚åœº</view>
    </view>
  </view>

  <!-- æŒ‰åŒºå¿åˆ†ç»„æ˜¾ç¤ºå¸‚åœº -->
  <view class="grouped-market-list" wx:if="{{groupedMarkets.length > 0}}">
    <view class="city-group" wx:for="{{groupedMarkets}}" wx:key="city">
      <view class="city-header">
        <view class="city-name">{{item.city}}</view>
        <view class="city-market-count">{{item.districts.length}}ä¸ªåŒºå¿</view>
      </view>
      
      <view class="district-group" wx:for="{{item.districts}}" wx:for-item="districtData" wx:key="district">
        <view class="district-header">
          <view class="district-name">{{districtData.district}}</view>
          <view class="district-market-count">{{districtData.markets.length}}ä¸ªå¸‚åœº</view>
        </view>
        
        <view class="market-list">
          <view 
            class="market-item" 
            wx:for="{{districtData.markets}}" 
            wx:for-item="market"
            wx:key="id"
            bindtap="viewMarketDetail"
            data-market="{{market}}"
          >
            <view class="market-info">
              <view class="market-name">{{market.name}}</view>
              <view class="market-address">{{market.address}}</view>
            </view>
            <view class="market-arrow">></view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æœç´¢ç»“æœå¸‚åœºåˆ—è¡¨ -->
  <view class="market-list" wx:if="{{showSearchResult && markets.length > 0}}">
    <view 
      class="market-item" 
      wx:for="{{markets}}" 
      wx:key="id"
      bindtap="viewMarketDetail"
      data-market="{{item}}"
    >
      <view class="market-info">
        <view class="market-name">{{item.name}}</view>
        <view class="market-location">{{item.city}} Â· {{item.district}}</view>
        <view class="market-address">{{item.address}}</view>
      </view>
      <view class="market-arrow">></view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{(selectedProvince || showSearchResult) && markets.length === 0 && groupedMarkets.length === 0}}">
    <view class="empty-icon">ğŸ“­</view>
    <view class="empty-text">æš‚æ— å¸‚åœºä¿¡æ¯</view>
    <view class="empty-desc">è¯·å°è¯•å…¶ä»–æœç´¢æ¡ä»¶æˆ–é€‰æ‹©å…¶ä»–çœä»½</view>
  </view>

  <!-- å¿«é€Ÿå¯¼èˆª -->
  <view class="quick-nav" wx:if="{{!selectedProvince && !showSearchResult}}">
    <view class="nav-title">å¿«é€Ÿå¯¼èˆª</view>
    <view class="nav-grid">
      <view class="nav-item" bindtap="goToFamous">
        <view class="nav-icon">ğŸ†</view>
        <view class="nav-text">çŸ¥åå¸‚åœº</view>
      </view>
      <view class="nav-item" bindtap="goToArea">
        <view class="nav-icon">ğŸ—ºï¸</view>
        <view class="nav-text">åœ°ç†å¤§åŒº</view>
      </view>
      <view class="nav-item" bindtap="goToJoin">
        <view class="nav-icon">â•</view>
        <view class="nav-text">å¸‚åœºå…¥é©»</view>
      </view>
    </view>
  </view>

  <!-- å…¥é©»ç”³è¯·å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showJoinModal}}" bindtap="closeJoinForm">
    <view class="modal-content join-form" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">ç”³è¯·å…¥é©»èŒ¶å¶å¸‚åœº</text>
        <text class="modal-close" bindtap="closeJoinForm">Ã—</text>
      </view>
      
      <view class="modal-body">
        <!-- å…¥é©»æµç¨‹è¯´æ˜ -->
        <view class="join-process">
          <view class="process-step">
            <text class="step-number">1</text>
            <text class="step-text">å¡«å†™åŸºæœ¬ä¿¡æ¯</text>
          </view>
          <view class="process-step">
            <text class="step-number">2</text>
            <text class="step-text">é€‰æ‹©ç›®æ ‡å¸‚åœº</text>
          </view>
          <view class="process-step">
            <text class="step-number">3</text>
            <text class="step-text">ä¸Šä¼ èµ„è´¨è¯æ˜</text>
          </view>
          <view class="process-step">
            <text class="step-number">4</text>
            <text class="step-text">ç­‰å¾…å®¡æ ¸é€šè¿‡</text>
          </view>
        </view>

        <!-- å…¥é©»è¡¨å• -->
        <view class="form-section">
          <text class="form-label">å•†æˆ·ä¿¡æ¯</text>
          <input class="form-input" 
                 placeholder="å•†æˆ·åç§°" 
                 value="{{joinForm.merchantName}}"
                 data-field="merchantName"
                 bindinput="inputJoinForm" />
          <input class="form-input" 
                 placeholder="è”ç³»äººå§“å" 
                 value="{{joinForm.contactName}}"
                 data-field="contactName"
                 bindinput="inputJoinForm" />
          <input class="form-input" 
                 placeholder="è”ç³»ç”µè¯" 
                 value="{{joinForm.phone}}"
                 data-field="phone"
                 bindinput="inputJoinForm" />
          <input class="form-input" 
                 placeholder="å¾®ä¿¡å·" 
                 value="{{joinForm.wechat}}"
                 data-field="wechat"
                 bindinput="inputJoinForm" />
        </view>

        <view class="form-section">
          <text class="form-label">ç»è¥ä¿¡æ¯</text>
          <picker class="form-picker"
                  mode="selector"
                  range="{{businessTypes}}"
                  bindchange="onBusinessTypeChange">
            <view class="picker-text">
              {{joinForm.businessType || 'è¯·é€‰æ‹©ç»è¥ç±»å‹'}}
            </view>
          </picker>
          <picker class="form-picker"
                  mode="selector"
                  range="{{mainCategories}}"
                  bindchange="onCategoryChange">
            <view class="picker-text">
              {{joinForm.mainCategory || 'è¯·é€‰æ‹©ä¸»è¥å“ç±»'}}
            </view>
          </picker>
          <textarea class="form-textarea" 
                    placeholder="ç»è¥æè¿°ï¼ˆé€‰å¡«ï¼‰"
                    value="{{joinForm.description}}"
                    data-field="description"
                    bindinput="inputJoinForm"></textarea>
        </view>

        <view class="form-section">
          <text class="form-label">é€‰æ‹©å¸‚åœº</text>
          <picker class="form-picker"
                  mode="selector"
                  range="{{joinForm.provinceList}}"
                  range-key="name"
                  bindchange="onProvinceChange">
            <view class="picker-text">
              {{joinForm.selectedProvince.name || 'è¯·é€‰æ‹©çœä»½'}}
            </view>
          </picker>
          <picker class="form-picker"
                  mode="selector"
                  range="{{joinForm.cityList}}"
                  range-key="name"
                  bindchange="onCityChange"
                  wx:if="{{joinForm.cityList.length > 0}}">
            <view class="picker-text">
              {{joinForm.selectedCity.name || 'è¯·é€‰æ‹©åŸå¸‚'}}
            </view>
          </picker>
          <picker class="form-picker"
                  mode="selector"
                  range="{{joinForm.districtList}}"
                  range-key="name"
                  bindchange="onDistrictChange"
                  wx:if="{{joinForm.districtList.length > 0}}">
            <view class="picker-text">
              {{joinForm.selectedDistrict.name || 'è¯·é€‰æ‹©åŒºå¿'}}
            </view>
          </picker>
          <picker class="form-picker"
                  mode="selector"
                  range="{{joinForm.marketList}}"
                  range-key="name"
                  bindchange="onMarketChange"
                  wx:if="{{joinForm.marketList.length > 0}}">
            <view class="picker-text">
              {{joinForm.selectedMarket.name || 'è¯·é€‰æ‹©å¸‚åœº'}}
            </view>
          </picker>
        </view>

        <view class="form-section">
          <text class="form-label">èµ„è´¨è¯æ˜</text>
          <view class="upload-section">
            <view class="upload-item" bindtap="uploadLicense">
              <text class="upload-icon">ğŸ“„</text>
              <text class="upload-text">è¥ä¸šæ‰§ç…§</text>
              <text class="upload-status" wx:if="{{joinForm.license}}">âœ“ å·²ä¸Šä¼ </text>
            </view>
          </view>
        </view>

        <view class="form-tips">
          <text class="tip-text">â€¢ è¯·ç¡®ä¿ä¿¡æ¯çœŸå®æœ‰æ•ˆ</text>
          <text class="tip-text">â€¢ å¹³å°å°†åœ¨3ä¸ªå·¥ä½œæ—¥å†…å®¡æ ¸</text>
          <text class="tip-text">â€¢ å®¡æ ¸é€šè¿‡åå¯å‘å¸ƒå•†å“ä¿¡æ¯</text>
          <text class="tip-text">â€¢ å…¥é©»è´¹ç”¨ï¼š300-500å…ƒ/å¹´ï¼ˆæŒ‰å¸‚åœºç­‰çº§ï¼‰</text>
        </view>
        
        <view class="form-actions">
          <button class="cancel-btn" bindtap="closeJoinForm">å–æ¶ˆ</button>
          <button class="submit-btn" bindtap="submitJoinForm">æäº¤ç”³è¯·</button>
        </view>
      </view>
    </view>
  </view>
</view>