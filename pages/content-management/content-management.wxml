<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-left" bindtap="goBack">
      <text class="back-icon">â†</text>
      <text class="back-text">è¿”å›</text>
    </view>
    <view class="header-title">å†…å®¹ç®¡ç†</view>
    <view class="header-right">
      <button class="refresh-btn" bindtap="loadContents">
        <text class="refresh-icon">ğŸ”„</text>
      </button>
    </view>
  </view>

  <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
  <view class="tab-nav">
    <view class="tab-item {{activeTab === 'list' ? 'active' : ''}}" 
          bindtap="switchTab" 
          data-tab="list">
      <text class="tab-text">å†…å®¹åˆ—è¡¨</text>
    </view>
    <view class="tab-item {{activeTab === 'create' ? 'active' : ''}}" 
          bindtap="switchTab" 
          data-tab="create">
      <text class="tab-text">åˆ›å»º/ç¼–è¾‘</text>
    </view>
    <view class="tab-item {{activeTab === 'stats' ? 'active' : ''}}" 
          bindtap="switchTab" 
          data-tab="stats">
      <text class="tab-text">ç»Ÿè®¡</text>
    </view>
    <view class="tab-item {{activeTab === 'settings' ? 'active' : ''}}" 
          bindtap="switchTab" 
          data-tab="settings">
      <text class="tab-text">è®¾ç½®</text>
    </view>
  </view>

  <!-- å†…å®¹åˆ—è¡¨æ ‡ç­¾é¡µ -->
  <view class="tab-content" wx:if="{{activeTab === 'list'}}">
    <!-- ç­›é€‰å’Œæœç´¢ -->
    <view class="filter-section">
      <view class="filter-row">
        <picker bindchange="onFilterChange" data-field="type" value="{{filters.type}}" range="{{contentTypes}}" range-key="label">
          <view class="picker">
            å†…å®¹ç±»å‹
            <text class="picker-text">{{filters.type === 'all' ? 'å…¨éƒ¨' : contentTypes[filters.typeIndex].label}}</text>
          </view>
        </picker>
        
        <picker bindchange="onFilterChange" data-field="status" value="{{filters.status}}" range="{{contentStatuses}}" range-key="label">
          <view class="picker">
            çŠ¶æ€
            <text class="picker-text">{{filters.status === 'all' ? 'å…¨éƒ¨' : contentStatuses[filters.statusIndex].label}}</text>
          </view>
        </picker>
        
        <picker bindchange="onFilterChange" data-field="priority" value="{{filters.priority}}" range="{{contentPriorities}}" range-key="label">
          <view class="picker">
            ä¼˜å…ˆçº§
            <text class="picker-text">{{filters.priority === 'all' ? 'å…¨éƒ¨' : contentPriorities[filters.priorityIndex].label}}</text>
          </view>
        </picker>
      </view>
      
      <view class="search-row">
        <input class="search-input" 
               placeholder="æœç´¢å†…å®¹æ ‡é¢˜..." 
               bindinput="onSearchInput" 
               bindconfirm="onSearchConfirm"
               value="{{filters.keyword}}" />
        <button class="search-btn" bindtap="onSearchConfirm">æœç´¢</button>
      </view>
      
      <!-- è½¬è½½åŠŸèƒ½æŒ‰é’® -->
      <view class="repost-actions">
        <button class="repost-btn add" bindtap="addManualContent">
          <text class="btn-icon">ğŸ“</text>
          <text class="btn-text">æ·»åŠ è½¬è½½</text>
        </button>
        <button class="repost-btn sources" bindtap="showRecommendedSources">
          <text class="btn-icon">ğŸ“‹</text>
          <text class="btn-text">æ¨èæ¥æº</text>
        </button>
        <button class="repost-btn local" bindtap="viewLocalContent">
          <text class="btn-icon">ğŸ“</text>
          <text class="btn-text">æœ¬åœ°å†…å®¹</text>
        </button>
      </view>
    </view>

    <!-- æ‰¹é‡æ“ä½œ -->
    <view class="batch-actions" wx:if="{{selectedContents.length > 0}}">
      <text class="batch-info">å·²é€‰æ‹© {{selectedContents.length}} é¡¹</text>
      <button class="batch-btn publish" bindtap="batchPublish">æ‰¹é‡å‘å¸ƒ</button>
      <button class="batch-btn delete" bindtap="batchDelete">æ‰¹é‡åˆ é™¤</button>
    </view>

    <!-- å†…å®¹åˆ—è¡¨ -->
    <view class="content-list">
      <view class="content-item" wx:for="{{contents}}" wx:key="id">
        <view class="content-header">
          <view class="content-select">
            <checkbox checked="{{selectedContents.includes(item.id)}}" bindtap="onContentSelect" data-id="{{item.id}}" />
          </view>
          <view class="content-title">{{item.title}}</view>
          <view class="content-badges">
            <text class="badge type-{{item.type}}">{{item.type}}</text>
            <text class="badge status-{{item.status}}">{{item.status}}</text>
            <text class="badge priority-{{item.priority}}">{{item.priority}}</text>
            <text class="badge featured" wx:if="{{item.is_featured}}">æ¨è</text>
            <text class="badge top" wx:if="{{item.is_top}}">ç½®é¡¶</text>
          </view>
        </view>
        
        <view class="content-info">
          <text class="content-summary">{{item.summary}}</text>
          <view class="content-meta">
            <text class="meta-item">ä½œè€…: {{item.author}}</text>
            <text class="meta-item">æµè§ˆé‡: {{item.view_count}}</text>
            <text class="meta-item">è´¨é‡åˆ†: {{item.quality_score}}</text>
            <text class="meta-item">åˆ›å»º: {{item.created_at}}</text>
          </view>
        </view>
        
        <view class="content-actions">
          <button class="action-btn view" bindtap="viewContent" data-id="{{item.id}}">æŸ¥çœ‹</button>
          <button class="action-btn edit" bindtap="editContent" data-id="{{item.id}}">ç¼–è¾‘</button>
          <button class="action-btn publish" wx:if="{{item.status !== 'published'}}" bindtap="publishContent" data-id="{{item.id}}">å‘å¸ƒ</button>
          <button class="action-btn approve" wx:if="{{item.status === 'pending'}}" bindtap="approveContent" data-id="{{item.id}}">å®¡æ ¸</button>
          <button class="action-btn reject" wx:if="{{item.status === 'pending'}}" bindtap="rejectContent" data-id="{{item.id}}">æ‹’ç»</button>
          <button class="action-btn {{item.is_featured ? 'unfeature' : 'feature'}}" bindtap="toggleFeatured" data-id="{{item.id}}">
            {{item.is_featured ? 'å–æ¶ˆæ¨è' : 'æ¨è'}}
          </button>
          <button class="action-btn {{item.is_top ? 'untop' : 'top'}}" bindtap="toggleTop" data-id="{{item.id}}">
            {{item.is_top ? 'å–æ¶ˆç½®é¡¶' : 'ç½®é¡¶'}}
          </button>
          <button class="action-btn delete" bindtap="deleteContent" data-id="{{item.id}}">åˆ é™¤</button>
        </view>
      </view>
      
      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{contents.length === 0 && !loading}}">
        <text class="empty-icon">ğŸ“</text>
        <text class="empty-text">æš‚æ— å†…å®¹æ•°æ®</text>
      </view>
      
      <!-- åŠ è½½çŠ¶æ€ -->
      <view class="loading-state" wx:if="{{loading}}">
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>
    </view>

    <!-- åˆ†é¡µ -->
    <view class="pagination" wx:if="{{pagination.pages > 1}}">
      <button class="page-btn" disabled="{{pagination.page <= 1}}" bindtap="onPageChange" data-page="{{pagination.page - 1}}">ä¸Šä¸€é¡µ</button>
      <text class="page-info">{{pagination.page}} / {{pagination.pages}}</text>
      <button class="page-btn" disabled="{{pagination.page >= pagination.pages}}" bindtap="onPageChange" data-page="{{pagination.page + 1}}">ä¸‹ä¸€é¡µ</button>
    </view>
  </view>

  <!-- åˆ›å»º/ç¼–è¾‘æ ‡ç­¾é¡µ -->
  <view class="tab-content" wx:if="{{activeTab === 'create'}}">
    <view class="form-section">
      <text class="section-title">{{editingContent ? 'ç¼–è¾‘å†…å®¹' : 'åˆ›å»ºå†…å®¹'}}</text>
      
      <view class="form-group">
        <text class="form-label">æ ‡é¢˜ *</text>
        <input class="form-input" 
               placeholder="è¯·è¾“å…¥å†…å®¹æ ‡é¢˜" 
               value="{{contentForm.title}}"
               bindinput="onFormInput" 
               data-field="title" />
      </view>
      
      <view class="form-group">
        <text class="form-label">æ‘˜è¦</text>
        <textarea class="form-textarea" 
                  placeholder="è¯·è¾“å…¥å†…å®¹æ‘˜è¦" 
                  value="{{contentForm.summary}}"
                  bindinput="onFormInput" 
                  data-field="summary" />
      </view>
      
      <view class="form-group">
        <text class="form-label">å†…å®¹ *</text>
        <textarea class="form-textarea large" 
                  placeholder="è¯·è¾“å…¥å†…å®¹æ­£æ–‡" 
                  value="{{contentForm.content}}"
                  bindinput="onFormInput" 
                  data-field="content" />
      </view>
      
      <view class="form-row">
        <view class="form-group half">
          <text class="form-label">å†…å®¹ç±»å‹</text>
          <picker bindchange="onFormPicker" data-field="type" value="{{contentForm.typeIndex}}" range="{{contentTypes}}" range-key="label">
            <view class="picker">
              <text class="picker-text">{{contentTypes[contentForm.typeIndex].label}}</text>
            </view>
          </picker>
        </view>
        
        <view class="form-group half">
          <text class="form-label">ä¼˜å…ˆçº§</text>
          <picker bindchange="onFormPicker" data-field="priority" value="{{contentForm.priorityIndex}}" range="{{contentPriorities}}" range-key="label">
            <view class="picker">
              <text class="picker-text">{{contentPriorities[contentForm.priorityIndex].label}}</text>
            </view>
          </picker>
        </view>
      </view>
      
      <view class="form-row">
        <view class="form-group half">
          <text class="form-label">ä½œè€…</text>
          <input class="form-input" 
                 placeholder="è¯·è¾“å…¥ä½œè€…" 
                 value="{{contentForm.author}}"
                 bindinput="onFormInput" 
                 data-field="author" />
        </view>
        
        <view class="form-group half">
          <text class="form-label">åˆ†ç±»</text>
          <input class="form-input" 
                 placeholder="è¯·è¾“å…¥åˆ†ç±»" 
                 value="{{contentForm.category}}"
                 bindinput="onFormInput" 
                 data-field="category" />
        </view>
      </view>
      
      <view class="form-group">
        <text class="form-label">æ ‡ç­¾</text>
        <view class="tags-container">
          <view class="tag-item" wx:for="{{contentForm.tags}}" wx:key="*this">
            <text class="tag-text">{{item}}</text>
            <text class="tag-remove" bindtap="removeTag" data-index="{{index}}">Ã—</text>
          </view>
          <input class="tag-input" 
                 placeholder="æ·»åŠ æ ‡ç­¾" 
                 bindconfirm="addTag"
                 value="{{newTag}}" />
        </view>
      </view>
      
      <view class="form-row">
        <view class="form-group half">
          <text class="form-label">å›¾ç‰‡URL</text>
          <input class="form-input" 
                 placeholder="è¯·è¾“å…¥å›¾ç‰‡URL" 
                 value="{{contentForm.image_url}}"
                 bindinput="onFormInput" 
                 data-field="image_url" />
        </view>
        
        <view class="form-group half">
          <text class="form-label">è§†é¢‘URL</text>
          <input class="form-input" 
                 placeholder="è¯·è¾“å…¥è§†é¢‘URL" 
                 value="{{contentForm.video_url}}"
                 bindinput="onFormInput" 
                 data-field="video_url" />
        </view>
      </view>
      
      <view class="form-group">
        <text class="form-label">SEOæ ‡é¢˜</text>
        <input class="form-input" 
               placeholder="è¯·è¾“å…¥SEOæ ‡é¢˜" 
               value="{{contentForm.seo_title}}"
               bindinput="onFormInput" 
               data-field="seo_title" />
      </view>
      
      <view class="form-group">
        <text class="form-label">SEOæè¿°</text>
        <textarea class="form-textarea" 
                  placeholder="è¯·è¾“å…¥SEOæè¿°" 
                  value="{{contentForm.seo_description}}"
                  bindinput="onFormInput" 
                  data-field="seo_description" />
      </view>
      
      <view class="form-group">
        <text class="form-label">SEOå…³é”®è¯</text>
        <input class="form-input" 
               placeholder="è¯·è¾“å…¥SEOå…³é”®è¯ï¼Œç”¨é€—å·åˆ†éš”" 
               value="{{contentForm.seo_keywords}}"
               bindinput="onFormInput" 
               data-field="seo_keywords" />
      </view>
      
      <view class="form-row">
        <view class="form-group half">
          <text class="form-label">è®¾ä¸ºæ¨è</text>
          <switch checked="{{contentForm.is_featured}}" bindchange="onFormSwitch" data-field="is_featured" />
        </view>
        
        <view class="form-group half">
          <text class="form-label">è®¾ä¸ºç½®é¡¶</text>
          <switch checked="{{contentForm.is_top}}" bindchange="onFormSwitch" data-field="is_top" />
        </view>
      </view>
      
      <view class="form-actions">
        <button class="form-btn reset" bindtap="resetForm">é‡ç½®</button>
        <button class="form-btn submit" bindtap="submitForm">{{editingContent ? 'æ›´æ–°' : 'åˆ›å»º'}}</button>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡æ ‡ç­¾é¡µ -->
  <view class="tab-content" wx:if="{{activeTab === 'stats'}}">
    <view class="stats-section">
      <text class="section-title">å†…å®¹ç»Ÿè®¡</text>
      
      <view class="stats-grid">
        <view class="stat-item">
          <text class="stat-value">{{statistics.total_count}}</text>
          <text class="stat-label">æ€»å†…å®¹æ•°</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{statistics.published_count}}</text>
          <text class="stat-label">å·²å‘å¸ƒ</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{statistics.pending_count}}</text>
          <text class="stat-label">å¾…å®¡æ ¸</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{statistics.rejected_count}}</text>
          <text class="stat-label">å·²æ‹’ç»</text>
        </view>
      </view>
      
      <view class="stats-detail">
        <text class="detail-title">å¹³å‡è´¨é‡åˆ†æ•°</text>
        <text class="detail-value">{{statistics.average_quality_score}}</text>
      </view>
      
      <view class="type-stats">
        <text class="detail-title">å†…å®¹ç±»å‹åˆ†å¸ƒ</text>
        <view class="type-item" wx:for="{{typeStatsList}}" wx:key="type">
          <text class="type-name">{{item.label}}</text>
          <text class="type-count">{{item.count}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è®¾ç½®æ ‡ç­¾é¡µ -->
  <view class="tab-content" wx:if="{{activeTab === 'settings'}}">
    <view class="settings-section">
      <text class="section-title">ç³»ç»Ÿè®¾ç½®</text>
      
      <view class="setting-item">
        <view class="setting-info">
          <text class="setting-label">è‡ªåŠ¨å®¡æ ¸</text>
          <text class="setting-desc">å¯ç”¨è‡ªåŠ¨å†…å®¹å®¡æ ¸åŠŸèƒ½</text>
        </view>
        <switch checked="{{settings.auto_audit}}" bindchange="onSettingChange" data-field="auto_audit" />
      </view>
      
      <view class="setting-item">
        <view class="setting-info">
          <text class="setting-label">è´¨é‡é˜ˆå€¼</text>
          <text class="setting-desc">å†…å®¹è´¨é‡æœ€ä½åˆ†æ•°è¦æ±‚</text>
        </view>
        <input class="setting-input" 
               type="number" 
               value="{{settings.quality_threshold}}"
               bindinput="onSettingChange" 
               data-field="quality_threshold" />
      </view>
      
      <view class="setting-item">
        <view class="setting-info">
          <text class="setting-label">æ¯æ—¥æœ€å¤§å‘å¸ƒæ•°</text>
          <text class="setting-desc">é™åˆ¶æ¯æ—¥å‘å¸ƒçš„å†…å®¹æ•°é‡</text>
        </view>
        <input class="setting-input" 
               type="number" 
               value="{{settings.max_content_per_day}}"
               bindinput="onSettingChange" 
               data-field="max_content_per_day" />
      </view>
      
      <view class="setting-item">
        <view class="setting-info">
          <text class="setting-label">è‡ªåŠ¨å‘å¸ƒ</text>
          <text class="setting-desc">å¯ç”¨è‡ªåŠ¨å‘å¸ƒåŠŸèƒ½</text>
        </view>
        <switch checked="{{settings.enable_auto_publish}}" bindchange="onSettingChange" data-field="enable_auto_publish" />
      </view>
      
      <view class="setting-actions">
        <button class="setting-btn" bindtap="saveSettings">ä¿å­˜è®¾ç½®</button>
      </view>
    </view>
  </view>
</view> 