<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-left" bindtap="goBack">
      <text class="back-icon">â†</text>
      <text class="back-text">è¿”å›</text>
    </view>
    <view class="header-title">ä»·æ ¼è¯¦æƒ…</view>
    <view class="header-right">
      <button class="share-btn" open-type="share">
        <text class="share-icon">ğŸ“¤</text>
      </button>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <view class="content" wx:if="{{!loading && priceDetail}}">
    <!-- ä»·æ ¼æ¦‚è§ˆ -->
    <view class="price-overview">
      <view class="overview-header">
        <view class="tea-info">
          <text class="tea-name">{{priceDetail.subCategory}}</text>
          <text class="tea-category">{{priceDetail.category}}</text>
        </view>
        <view class="status-badge {{priceDetail.updateStatus}}">
          <text class="status-dot"></text>
          <text class="status-text">{{priceDetail.updateTime}}</text>
        </view>
      </view>

      <view class="price-main">
        <view class="price-range">
          <text class="price-text">{{priceDetail.priceRange}}</text>
          <text class="price-unit">{{priceDetail.unit}}</text>
        </view>
        <view class="price-trend">
          <text class="trend-icon">{{priceDetail.trendIcon}}</text>
          <text class="trend-text">{{priceDetail.trendText}}</text>
        </view>
      </view>

      <view class="overview-stats">
        <view class="stat-item">
          <text class="stat-value">{{priceDetail.merchantCount}}</text>
          <text class="stat-label">å•†æˆ·æ•°é‡</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{priceDetail.avgRating}}</text>
          <text class="stat-label">å¹³å‡è¯„åˆ†</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{priceDetail.totalInquiries}}</text>
          <text class="stat-label">å’¨è¯¢æ¬¡æ•°</text>
        </view>
      </view>
    </view>

    <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
    <view class="tab-nav">
      <view class="tab-item {{activeTab === 'detail' ? 'active' : ''}}" 
            bindtap="switchTab" 
            data-tab="detail">
        <text class="tab-text">è¯¦æƒ…</text>
      </view>
      <view class="tab-item {{activeTab === 'merchants' ? 'active' : ''}}" 
            bindtap="switchTab" 
            data-tab="merchants">
        <text class="tab-text">å•†æˆ·({{merchants.length}})</text>
      </view>
      <view class="tab-item {{activeTab === 'trend' ? 'active' : ''}}" 
            bindtap="switchTab" 
            data-tab="trend">
        <text class="tab-text">è¶‹åŠ¿</text>
      </view>
    </view>

    <!-- è¯¦æƒ…æ ‡ç­¾é¡µ -->
    <view class="tab-content" wx:if="{{activeTab === 'detail'}}">
      <!-- äº§å“å›¾ç‰‡ -->
      <view class="image-section" wx:if="{{priceDetail.images.length > 0}}">
        <text class="section-title">äº§å“å›¾ç‰‡</text>
        <scroll-view class="image-list" scroll-x="true">
          <view class="image-item" 
                wx:for="{{priceDetail.images}}" 
                wx:key="*this"
                wx:for-item="image"
                wx:for-index="index"
                bindtap="previewImage" 
                data-index="{{index}}">
            <image class="product-image" src="{{image}}" mode="aspectFill"></image>
          </view>
        </scroll-view>
      </view>

      <!-- äº§å“æè¿° -->
      <view class="description-section">
        <text class="section-title">äº§å“æè¿°</text>
        <text class="description-text">{{priceDetail.description}}</text>
      </view>

      <!-- äº§å“ä¿¡æ¯ -->
      <view class="info-section">
        <text class="section-title">äº§å“ä¿¡æ¯</text>
        <view class="info-list">
          <view class="info-item" wx:if="{{priceDetail.process}}">
            <text class="info-label">å·¥è‰º</text>
            <text class="info-value">{{priceDetail.process}}</text>
          </view>
          <view class="info-item" wx:if="{{priceDetail.origin}}">
            <text class="info-label">äº§åœ°</text>
            <text class="info-value">{{priceDetail.origin}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">åœ°åŒº</text>
            <text class="info-value">{{priceDetail.city}}</text>
          </view>
        </view>
      </view>

      <!-- æ ‡ç­¾ -->
      <view class="tags-section" wx:if="{{priceDetail.tags.length > 0}}">
        <text class="section-title">äº§å“æ ‡ç­¾</text>
        <view class="tags-list">
          <text class="tag-item" 
                wx:for="{{priceDetail.tags}}" 
                wx:key="*this"
                wx:for-item="tag">
            {{tag}}
          </text>
        </view>
      </view>
    </view>

    <!-- å•†æˆ·æ ‡ç­¾é¡µ -->
    <view class="tab-content" wx:if="{{activeTab === 'merchants'}}">
      <!-- æ’åºé€‰é¡¹ -->
      <view class="sort-options">
        <view class="sort-item {{sortType === 'distance' ? 'active' : ''}}" 
              bindtap="changeSort" 
              data-sort="distance">
          <text class="sort-text">æŒ‰è·ç¦»</text>
        </view>
        <view class="sort-item {{sortType === 'rating' ? 'active' : ''}}" 
              bindtap="changeSort" 
              data-sort="rating">
          <text class="sort-text">æŒ‰è¯„åˆ†</text>
        </view>
        <view class="sort-item {{sortType === 'price' ? 'active' : ''}}" 
              bindtap="changeSort" 
              data-sort="price">
          <text class="sort-text">æŒ‰ä»·æ ¼</text>
        </view>
      </view>

      <!-- å•†æˆ·åˆ—è¡¨ -->
      <view class="merchant-list">
        <view class="merchant-item" 
              wx:for="{{merchants}}" 
              wx:key="id"
              wx:for-item="merchant">
          <view class="merchant-header" bindtap="viewMerchantDetail" data-id="{{merchant.id}}">
            <image class="merchant-avatar" src="{{merchant.avatar}}" mode="aspectFill"></image>
            <view class="merchant-info">
              <text class="merchant-name">{{merchant.name}}</text>
              <view class="merchant-rating">
                <text class="rating-text">{{merchant.rating}}åˆ†</text>
                <text class="distance-text">{{merchant.distance}}km</text>
              </view>
            </view>
            <view class="merchant-price">
              <text class="price-text">{{merchant.price}}</text>
              <text class="price-unit">{{merchant.unit}}</text>
            </view>
          </view>

          <view class="merchant-details">
            <view class="detail-tags">
              <view class="tag-item" wx:if="{{merchant.hasImages}}">
                <text class="tag-icon">ğŸ“·</text>
                <text class="tag-text">å®æ‹å›¾</text>
              </view>
              <view class="tag-item" wx:if="{{merchant.hasOrigin}}">
                <text class="tag-icon">ğŸ“</text>
                <text class="tag-text">äº§åœ°ä¿¡æ¯</text>
              </view>
              <view class="tag-item" wx:if="{{merchant.process}}">
                <text class="tag-icon">âš™ï¸</text>
                <text class="tag-text">{{merchant.process}}</text>
              </view>
            </view>
            <view class="merchant-actions">
              <text class="update-time">{{merchant.updateTime}}</text>
              <button class="contact-btn" 
                      bindtap="contactMerchant" 
                      data-id="{{merchant.id}}">
                è”ç³»å•†æˆ·
              </button>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- è¶‹åŠ¿æ ‡ç­¾é¡µ -->
    <view class="tab-content" wx:if="{{activeTab === 'trend'}}">
      <view class="trend-section">
        <text class="section-title">ä»·æ ¼è¶‹åŠ¿</text>
        <view class="trend-chart">
          <!-- è¿™é‡Œåº”è¯¥æ˜¾ç¤ºä»·æ ¼è¶‹åŠ¿å›¾è¡¨ -->
          <view class="chart-placeholder">
            <text class="chart-text">ä»·æ ¼è¶‹åŠ¿å›¾è¡¨</text>
            <text class="chart-desc">æ˜¾ç¤ºè¿‘3ä¸ªæœˆä»·æ ¼å˜åŒ–</text>
          </view>
        </view>
        <view class="trend-data">
          <view class="trend-item" 
                wx:for="{{priceTrend}}" 
                wx:key="date"
                wx:for-item="item">
            <text class="trend-date">{{item.date}}</text>
            <text class="trend-price">{{item.price}}å…ƒ</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æç¤º -->
  <view class="bottom-tip">
    <text class="tip-text">æœ¬æŠ¥ä»·ç”±å•†æˆ·æä¾›ï¼Œä»…ä¾›å‚è€ƒ</text>
  </view>
</view> 