<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view class="favorite-container" wx:else>
    <!-- å¤´éƒ¨ç»Ÿè®¡ -->
    <view class="stats-header">
      <view class="stats-item">
        <text class="stats-number">{{stats.total}}</text>
        <text class="stats-label">æ€»æ”¶è—</text>
      </view>
      <view class="stats-divider"></view>
      <view class="stats-item">
        <text class="stats-number">{{stats.markets}}</text>
        <text class="stats-label">å¸‚åœº</text>
      </view>
      <view class="stats-divider"></view>
      <view class="stats-item">
        <text class="stats-number">{{stats.supplies}}</text>
        <text class="stats-label">ä¾›æ±‚</text>
      </view>
      <view class="stats-divider"></view>
      <view class="stats-item">
        <text class="stats-number">{{stats.newarrivals}}</text>
        <text class="stats-label">æ–°å“</text>
      </view>
    </view>

    <!-- æ“ä½œæ  -->
    <view class="action-bar">
      <view class="action-left">
        <view class="action-btn" bindtap="onSearchToggle">
          <text class="action-icon">ğŸ”</text>
          <text class="action-text">æœç´¢</text>
        </view>
        <view class="action-btn {{isEditMode ? 'active' : ''}}" bindtap="toggleEditMode">
          <text class="action-icon">âœï¸</text>
          <text class="action-text">{{isEditMode ? 'å–æ¶ˆ' : 'ç¼–è¾‘'}}</text>
        </view>
      </view>
      
      <view class="action-right" wx:if="{{isEditMode}}">
        <view class="action-btn" bindtap="onSelectAll">
          <text class="action-text">å…¨é€‰</text>
        </view>
        <view class="action-btn delete-btn" bindtap="onBatchDelete">
          <text class="action-text">åˆ é™¤</text>
        </view>
      </view>
    </view>

    <!-- æœç´¢æ  -->
    <view class="search-bar {{showSearch ? 'show' : ''}}" wx:if="{{showSearch}}">
      <view class="search-input-wrapper">
        <input 
          class="search-input" 
          placeholder="æœç´¢æ”¶è—å†…å®¹..." 
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
        />
        <text class="search-clear" bindtap="onSearchClear" wx:if="{{searchKeyword}}">âœ•</text>
      </view>
    </view>

    <!-- æ ‡ç­¾æ  -->
    <view class="tab-bar">
      <scroll-view class="tab-scroll" scroll-x>
        <view class="tab-list">
          <view 
            class="tab-item {{activeTab === index ? 'active' : ''}}"
            wx:for="{{tabList}}"
            wx:key="id"
            bindtap="onTabChange"
            data-index="{{index}}"
          >
            <text class="tab-icon">{{item.icon}}</text>
            <text class="tab-text">{{item.name}}</text>
            <text class="tab-count" wx:if="{{stats[item.id]}}">{{stats[item.id]}}</text>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- æ”¶è—åˆ—è¡¨ -->
    <view class="favorite-list">
      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{favoriteData[tabList[activeTab].id].length === 0}}">
        <view class="empty-icon">{{tabList[activeTab].icon}}</view>
        <text class="empty-title">æš‚æ— {{tabList[activeTab].name}}æ”¶è—</text>
        <text class="empty-desc">åœ¨{{tabList[activeTab].name}}é¡µé¢ç‚¹å‡»æ”¶è—æŒ‰é’®æ·»åŠ æ”¶è—</text>
      </view>

      <!-- æ”¶è—é¡¹åˆ—è¡¨ -->
      <view class="favorite-items">
        <view 
          class="favorite-item {{selectedItems.indexOf(item.id) !== -1 ? 'selected' : ''}}"
          wx:for="{{favoriteData[tabList[activeTab].id]}}"
          wx:key="id"
          bindtap="onItemTap"
          data-item="{{item}}"
          data-id="{{item.id}}"
        >
          <!-- é€‰æ‹©æ¡† -->
          <view class="item-checkbox" wx:if="{{isEditMode}}">
            <text class="checkbox-icon">{{selectedItems.indexOf(item.id) !== -1 ? 'âœ…' : 'â­•'}}</text>
          </view>

          <!-- å†…å®¹åŒºåŸŸ -->
          <view class="item-content">
            <view class="item-header">
              <text class="item-title">{{item.name}}</text>
              <view class="item-type">
                <text class="type-icon">{{item.categoryType ? (tabList.find(tab => tab.id === item.categoryType) || {}).icon : item.type}}</text>
                <text class="type-text">{{item.categoryType ? (tabList.find(tab => tab.id === item.categoryType) || {}).name : item.type}}</text>
              </view>
            </view>

            <view class="item-info">
              <text class="item-desc">{{item.data.description || item.data.address || 'æš‚æ— æè¿°'}}</text>
              <text class="item-time">{{formatTime(item.createTime)}}</text>
            </view>
          </view>

          <!-- æ“ä½œæŒ‰é’® -->
          <view class="item-actions" wx:if="{{!isEditMode}}">
            <view class="action-btn-small" bindtap="onItemShare" data-item="{{item}}">
              <text class="btn-icon">ğŸ“¤</text>
            </view>
            <view class="action-btn-small delete" bindtap="onItemDelete" data-item="{{item}}">
              <text class="btn-icon">ğŸ—‘ï¸</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨æ“ä½œæ  -->
    <view class="bottom-actions" wx:if="{{stats.total > 0}}">
      <view class="bottom-btn" bindtap="onClearCategory">
        <text class="btn-text">æ¸…ç©º{{tabList[activeTab].name}}</text>
      </view>
      <view class="bottom-btn" bindtap="onExportFavorites">
        <text class="btn-text">å¯¼å‡ºæ•°æ®</text>
      </view>
    </view>
  </view>
</view> 