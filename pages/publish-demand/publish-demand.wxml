<!--pages/publish-demand/publish-demand.wxml-->
<view class="publish-page">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <view class="header-title">å‘å¸ƒæ±‚è´­</view>
    <view class="header-desc">å‘å¸ƒæ‚¨çš„èŒ¶å¶æ±‚è´­éœ€æ±‚ï¼Œè®©æ›´å¤šå–å®¶è”ç³»æ‚¨</view>
  </view>

  <!-- è¡¨å•å†…å®¹ -->
  <view class="form-content">
    <!-- åŸºæœ¬ä¿¡æ¯ -->
    <view class="form-section">
      <view class="section-title">åŸºæœ¬ä¿¡æ¯</view>
      
      <!-- æ±‚è´­æ ‡é¢˜ -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">æ±‚è´­æ ‡é¢˜</text>
          <text class="required">*</text>
        </view>
        <input 
          class="form-input {{!validation.title.valid ? 'error' : ''}}"
          placeholder="è¯·è¾“å…¥æ±‚è´­æ ‡é¢˜ï¼Œå¦‚ï¼šæ±‚è´­ä¼˜è´¨æ˜å‰é¾™äº•èŒ¶"
          value="{{formData.title}}"
          data-field="title"
          bindinput="onInputChange"
          maxlength="50"
        />
        <text class="error-message" wx:if="{{!validation.title.valid}}">{{validation.title.message}}</text>
      </view>

      <!-- èŒ¶å¶ç±»å‹ -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">èŒ¶å¶ç±»å‹</text>
          <text class="required">*</text>
          <text class="label-desc">ï¼ˆå¯å¤šé€‰ï¼‰</text>
        </view>
        <view class="selection-tip">
          <text class="tip-text">ğŸ’¡ ç‚¹å‡»æ ‡ç­¾è¿›è¡Œé€‰æ‹©ï¼Œå¯å¤šé€‰</text>
        </view>
        <view class="tea-type-tags">
          <view 
            wx:for="{{teaTypeOptions}}" 
            wx:key="*this"
            class="tea-type-tag {{formData.teaTypes.indexOf(item) > -1 ? 'selected' : ''}}"
            data-tea-type="{{item}}"
            catchtap="onTeaTypeToggle"
            hover-class="tea-type-tag-hover"
          >
            {{item}}
          </view>
          <!-- å…¶ä»–é€‰é¡¹ -->
          <view 
            class="tea-type-tag other-option {{formData.teaTypes.indexOf('å…¶ä»–') > -1 ? 'selected' : ''}}"
            data-tea-type="å…¶ä»–"
            catchtap="onTeaTypeToggle"
            hover-class="tea-type-tag-hover"
          >
            å…¶ä»–
          </view>
        </view>
        
        <!-- æ‰‹åŠ¨è¾“å…¥å…¶ä»–èŒ¶å¶ç±»å‹ -->
        <view class="custom-tea-input" wx:if="{{formData.teaTypes.indexOf('å…¶ä»–') > -1}}">
          <input 
            class="custom-input"
            placeholder="è¯·è¾“å…¥å…¶ä»–èŒ¶å¶ç±»å‹ï¼Œå¦‚ï¼šå¤§çº¢è¢ã€é“è§‚éŸ³ç­‰"
            value="{{formData.customTeaType}}"
            data-field="customTeaType"
            bindinput="onInputChange"
            maxlength="20"
          />
          <button 
            class="add-custom-btn"
            bindtap="addCustomTeaType"
            disabled="{{!formData.customTeaType.trim()}}"
          >
            æ·»åŠ 
          </button>
        </view>
        <view class="selection-status" wx:if="{{formData.teaTypes.length > 0}}">
          <text class="status-text">å·²é€‰æ‹©: {{formData.teaTypes.join('ã€')}}</text>
          <text class="clear-btn" bindtap="clearTeaTypes">æ¸…ç©º</text>
        </view>
        <!-- é€‰æ‹©çŠ¶æ€æ˜¾ç¤º -->
        <view class="selection-display" wx:if="{{formData.teaTypes.length > 0}}">
          <view class="selected-items">
            <view class="selected-item" wx:for="{{formData.teaTypes}}" wx:key="*this">
              <text class="item-text">{{item}}</text>
              <text class="remove-btn" data-tea-type="{{item}}" bindtap="onTeaTypeToggle">Ã—</text>
            </view>
          </view>
        </view>
        <text class="error-message" wx:if="{{!validation.teaTypes.valid}}">{{validation.teaTypes.message}}</text>
      </view>

      <!-- äº§åœ° -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">äº§åœ°</text>
          <text class="required">*</text>
        </view>
        <input 
          class="form-input {{!validation.origin.valid ? 'error' : ''}}"
          placeholder="è¯·è¾“å…¥èŒ¶å¶äº§åœ°ï¼Œå¦‚ï¼šæµ™æ±Ÿæ­å·è¥¿æ¹–åŒº"
          value="{{formData.origin}}"
          data-field="origin"
          bindinput="onInputChange"
          maxlength="50"
        />
        <text class="error-message" wx:if="{{!validation.origin.valid}}">{{validation.origin.message}}</text>
      </view>

      <!-- ç­‰çº§ -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">ç­‰çº§</text>
          <text class="required">*</text>
        </view>
        <picker 
          mode="selector" 
          range="{{gradeOptions}}"
          data-field="grade"
          bindchange="onPickerChange"
        >
          <view class="picker-input {{!validation.grade.valid ? 'error' : ''}}">
            <text class="picker-text {{formData.grade ? '' : 'placeholder'}}">
              {{formData.grade || 'è¯·é€‰æ‹©èŒ¶å¶ç­‰çº§'}}
            </text>
            <text class="picker-arrow">></text>
          </view>
        </picker>
        <text class="error-message" wx:if="{{!validation.grade.valid}}">{{validation.grade.message}}</text>
      </view>

      <!-- é‡‡æ‘˜æ—¶é—´ -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">é‡‡æ‘˜æ—¶é—´</text>
        </view>
        <picker 
          mode="selector" 
          range="{{harvestTimeOptions}}"
          data-field="harvestTime"
          bindchange="onPickerChange"
        >
          <view class="picker-input">
            <text class="picker-text {{formData.harvestTime ? '' : 'placeholder'}}">
              {{formData.harvestTime || 'è¯·é€‰æ‹©é‡‡æ‘˜æ—¶é—´'}}
            </text>
            <text class="picker-arrow">></text>
          </view>
        </picker>
      </view>

      <!-- ç‰¹è‰²æ ‡ç­¾ -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">ç‰¹è‰²æ ‡ç­¾</text>
          <text class="label-desc">ï¼ˆæœ€å¤šé€‰æ‹©6ä¸ªï¼‰</text>
        </view>
        <view class="selection-tip">
          <text class="tip-text">ğŸ’¡ ç‚¹å‡»æ ‡ç­¾è¿›è¡Œé€‰æ‹©ï¼Œæœ€å¤š6ä¸ª</text>
        </view>
        <view class="feature-tags">
          <view 
            wx:for="{{featureOptions}}" 
            wx:key="*this"
            class="feature-tag {{formData.features.indexOf(item) > -1 ? 'selected' : ''}}"
            data-feature="{{item}}"
            catchtap="onFeatureToggle"
            hover-class="feature-tag-hover"
          >
            {{item}}
          </view>
        </view>
        <view class="selection-status" wx:if="{{formData.features.length > 0}}">
          <text class="status-text">å·²é€‰æ‹©: {{formData.features.join('ã€')}}</text>
          <text class="clear-btn" bindtap="clearFeatures">æ¸…ç©º</text>
        </view>
        <!-- é€‰æ‹©çŠ¶æ€æ˜¾ç¤º -->
        <view class="selection-display feature-selection" wx:if="{{formData.features.length > 0}}">
          <view class="selected-items">
            <view class="selected-item feature-item" wx:for="{{formData.features}}" wx:key="*this">
              <text class="item-text">{{item}}</text>
              <text class="remove-btn" data-feature="{{item}}" bindtap="onFeatureToggle">Ã—</text>
            </view>
          </view>
        </view>
      </view>

      <!-- è¯¦ç»†æè¿° -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">è¯¦ç»†æè¿°</text>
        </view>
        <textarea 
          class="form-textarea"
          placeholder="è¯·è¯¦ç»†æè¿°æ‚¨çš„æ±‚è´­éœ€æ±‚ã€å“è´¨è¦æ±‚ã€åŒ…è£…è¦æ±‚ç­‰ä¿¡æ¯"
          value="{{formData.description}}"
          data-field="description"
          bindinput="onInputChange"
          maxlength="500"
        ></textarea>
        <text class="char-count">{{formData.description.length}}/500</text>
      </view>
    </view>

    <!-- é¢„ç®—ä¿¡æ¯ -->
    <view class="form-section">
      <view class="section-title">é¢„ç®—ä¿¡æ¯</view>
      
      <!-- é¢„ç®— -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">é¢„ç®—</text>
          <text class="required">*</text>
        </view>
        <view class="budget-input">
          <input 
            class="budget-value {{!validation.budget.valid ? 'error' : ''}}"
            placeholder="è¯·è¾“å…¥é¢„ç®—"
            value="{{formData.budget}}"
            data-field="budget"
            bindinput="onInputChange"
            type="digit"
          />
          <picker 
            mode="selector" 
            range="{{budgetUnits}}"
            data-field="budgetUnit"
            bindchange="onPickerChange"
          >
            <view class="budget-unit">
              <text class="unit-text">{{formData.budgetUnit}}</text>
              <text class="unit-arrow">></text>
            </view>
          </picker>
        </view>
        <text class="error-message" wx:if="{{!validation.budget.valid}}">{{validation.budget.message}}</text>
      </view>

      <!-- æ•°é‡ -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">æ±‚è´­æ•°é‡</text>
          <text class="required">*</text>
        </view>
        <view class="quantity-input">
          <input 
            class="quantity-value {{!validation.quantity.valid ? 'error' : ''}}"
            placeholder="è¯·è¾“å…¥æ•°é‡"
            value="{{formData.quantity}}"
            data-field="quantity"
            bindinput="onInputChange"
            type="digit"
          />
          <picker 
            mode="selector" 
            range="{{quantityUnits}}"
            data-field="quantityUnit"
            bindchange="onPickerChange"
          >
            <view class="quantity-unit">
              <text class="unit-text">{{formData.quantityUnit}}</text>
              <text class="unit-arrow">></text>
            </view>
          </picker>
        </view>
        <text class="error-message" wx:if="{{!validation.quantity.valid}}">{{validation.quantity.message}}</text>
      </view>

      <!-- ç´§æ€¥ç¨‹åº¦ -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">ç´§æ€¥ç¨‹åº¦</text>
        </view>
        <picker 
          mode="selector" 
          range="{{urgencyOptions}}"
          data-field="urgency"
          bindchange="onPickerChange"
        >
          <view class="picker-input">
            <text class="picker-text">{{formData.urgency}}</text>
            <text class="picker-arrow">></text>
          </view>
        </picker>
      </view>
    </view>

    <!-- äº¤æ˜“ä¿¡æ¯ -->
    <view class="form-section">
      <view class="section-title">äº¤æ˜“ä¿¡æ¯</view>
      
      <!-- å‘è´§æ—¶é—´ -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">å‘è´§æ—¶é—´</text>
        </view>
        <picker 
          mode="selector" 
          range="{{deliveryOptions}}"
          data-field="delivery"
          bindchange="onPickerChange"
        >
          <view class="picker-input">
            <text class="picker-text">{{formData.delivery}}</text>
            <text class="picker-arrow">></text>
          </view>
        </picker>
      </view>
    </view>

    <!-- å›¾ç‰‡ä¸Šä¼  -->
    <view class="form-section">
      <view class="section-title">å‚è€ƒå›¾ç‰‡</view>
      <view class="form-item">
        <view class="image-upload">
          <view class="image-list">
            <view 
              class="image-item" 
              wx:for="{{formData.images}}" 
              wx:key="*this"
            >
              <image 
                class="uploaded-image" 
                src="{{item}}" 
                mode="aspectFill"
                data-url="{{item}}"
                bindtap="previewImage"
              />
              <view 
                class="delete-btn" 
                data-index="{{index}}"
                bindtap="deleteImage"
              >Ã—</view>
            </view>
            <view 
              class="upload-btn" 
              wx:if="{{formData.images.length < 9}}"
              bindtap="chooseImage"
            >
              <text class="upload-icon">+</text>
              <text class="upload-text">æ·»åŠ å›¾ç‰‡</text>
            </view>
          </view>
          <text class="upload-tip">æœ€å¤šä¸Šä¼ 9å¼ å›¾ç‰‡ï¼Œå¯ä¸Šä¼ å‚è€ƒå›¾ç‰‡æˆ–æ ·å“å›¾ç‰‡</text>
        </view>
      </view>
    </view>

    <!-- è”ç³»ä¿¡æ¯ -->
    <view class="form-section">
      <view class="section-title">è”ç³»ä¿¡æ¯</view>
      
      <!-- è”ç³»äºº -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">è”ç³»äºº</text>
          <text class="required">*</text>
        </view>
        <input 
          class="form-input {{!validation.contact.valid ? 'error' : ''}}"
          placeholder="è¯·è¾“å…¥è”ç³»äººå§“å"
          value="{{formData.contact}}"
          data-field="contact"
          bindinput="onInputChange"
          maxlength="20"
        />
        <text class="error-message" wx:if="{{!validation.contact.valid}}">{{validation.contact.message}}</text>
      </view>

      <!-- è”ç³»ç”µè¯ -->
      <view class="form-item">
        <view class="form-label">
          <text class="label-text">è”ç³»ç”µè¯</text>
          <text class="required">*</text>
        </view>
        <input 
          class="form-input {{!validation.phone.valid ? 'error' : ''}}"
          placeholder="è¯·è¾“å…¥æ‰‹æœºå·ç "
          value="{{formData.phone}}"
          data-field="phone"
          bindinput="onInputChange"
          type="number"
          maxlength="11"
        />
        <text class="error-message" wx:if="{{!validation.phone.valid}}">{{validation.phone.message}}</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <view class="action-buttons">
      <button class="btn btn-secondary" bindtap="saveDraft">ä¿å­˜è‰ç¨¿</button>
      <button class="btn btn-secondary" bindtap="resetForm">é‡ç½®</button>
      <button 
        class="btn btn-primary {{submitting ? 'disabled' : ''}}" 
        bindtap="submitForm"
        disabled="{{submitting}}"
      >
        {{submitting ? 'å‘å¸ƒä¸­...' : 'å‘å¸ƒæ±‚è´­'}}
      </button>
    </view>
  </view>
</view>