<!-- ä¾›æ±‚å¹³å°é¡µé¢ -->
<view class="supply-page">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-actions">
      <button class="publish-btn supply" bindtap="publishSupply">
        <text class="publish-icon">+</text>
        <text class="publish-text">å‘å¸ƒä¾›åº”</text>
      </button>
      <button class="publish-btn demand" bindtap="publishDemand">
        <text class="publish-icon">+</text>
        <text class="publish-text">å‘å¸ƒæ±‚è´­</text>
      </button>
    </view>
  </view>

  <!-- æœç´¢æ  -->
  <view class="search-section">
    <view class="search-box">
      <text class="search-icon">ğŸ”</text>
      <input 
        class="search-input"
        placeholder="æœç´¢èŒ¶ç±»ã€äº§åœ°ã€å…³é”®è¯..."
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
      />
    </view>
  </view>

  <!-- Tabåˆ‡æ¢ -->
  <view class="tab-section">
    <view class="tab-list">
      <view 
        class="tab-item {{currentTab === 'supply' ? 'active' : ''}}"
        data-tab="supply"
        bindtap="onTabChange"
      >
        <text class="tab-text">ä¾›åº”ä¿¡æ¯</text>
        <text class="tab-count">{{supplyList.length}}</text>
      </view>
      <view 
        class="tab-item {{currentTab === 'demand' ? 'active' : ''}}"
        data-tab="demand"
        bindtap="onTabChange"
      >
        <text class="tab-text">æ±‚è´­ä¿¡æ¯</text>
        <text class="tab-count">{{demandList.length}}</text>
      </view>
    </view>
  </view>

  <!-- æ™ºèƒ½æ¨è -->
  <view class="recommend-section" wx:if="{{recommendedList.length > 0}}">
    <view class="section-header">
      <text class="section-title">ä¸ºæ‚¨æ¨è</text>
      <text class="section-desc">æ ¹æ®æ‚¨çš„åå¥½æ™ºèƒ½æ¨è</text>
    </view>
    <view class="recommend-list">
      <view 
        wx:for="{{recommendedList}}" 
        wx:key="id"
        class="recommend-item"
        data-id="{{item.id}}"
        data-type="{{item.type}}"
        bindtap="onItemTap"
      >
        <view class="recommend-type {{item.type}}">{{item.typeText}}</view>
        <view class="recommend-content">
          <text class="recommend-title">{{item.title}}</text>
          <text class="recommend-desc">{{item.description}}</text>
          <view class="recommend-tags">
            <text 
              wx:for="{{item.tags}}" 
              wx:key="*this" 
              wx:for-item="tag"
              class="recommend-tag"
            >
              {{tag}}
            </text>
          </view>
        </view>
        <view class="recommend-badge">æ¨è</view>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰å’Œæ’åº -->
  <view class="filter-section">
    <!-- èŒ¶ç±»ç­›é€‰ -->
    <view class="filter-row">
      <text class="filter-label">èŒ¶ç±»ï¼š</text>
      <view class="filter-options">
        <view 
          wx:for="{{filterOptions.teaType}}" 
          wx:key="value"
          class="filter-item {{currentFilter.teaType === item.value ? 'active' : ''}}"
          data-type="teaType"
          data-value="{{item.value}}"
          bindtap="onFilterChange"
        >
          {{item.label}}
        </view>
      </view>
    </view>
    
    <!-- æ’åºé€‰é¡¹ -->
    <view class="filter-row">
      <text class="filter-label">æ’åºï¼š</text>
      <view class="filter-options">
        <view 
          wx:for="{{filterOptions.sortOptions}}" 
          wx:key="value"
          class="filter-item {{currentFilter.sort === item.value ? 'active' : ''}}"
          data-type="sort"
          data-value="{{item.value}}"
          bindtap="onFilterChange"
        >
          {{item.label}}
        </view>
      </view>
    </view>
  </view>

  <!-- ä¾›åº”ä¿¡æ¯æµ -->
  <view class="info-list" wx:if="{{currentTab === 'supply'}}">
    <view class="list-title">ä¾›åº”ä¿¡æ¯</view>
    
    <view 
      wx:for="{{supplyList}}" 
      wx:key="id"
      class="info-item supply"
      data-id="{{item.id}}"
      data-type="{{item.type}}"
      bindtap="onItemTap"
    >
      <!-- ä¿¡æ¯å¤´éƒ¨ -->
      <view class="item-header">
        <view class="item-type supply">{{item.typeText}}</view>
        <view class="item-badges">
          <view class="badge new" wx:if="{{item.isNew}}">æ–°å“</view>
          <view class="badge clearance" wx:if="{{item.isClearance}}">å°¾è´§</view>
          <view class="badge recommend" wx:if="{{item.isRecommended}}">æ¨è</view>
        </view>
      </view>

      <!-- ä¿¡æ¯å†…å®¹ -->
      <view class="item-content">
        <view class="content-main">
          <text class="item-title">{{item.title}}</text>
          <text class="item-desc">{{item.description}}</text>
          
          <!-- å…³é”®ä¿¡æ¯ -->
          <view class="key-info">
            <view class="info-row">
              <text class="info-label">èŒ¶ç±»ï¼š</text>
              <text class="info-value">{{item.teaType}} - {{item.teaSubType}}</text>
            </view>
            <view class="info-row">
              <text class="info-label">ä»·æ ¼ï¼š</text>
              <text class="info-value price">{{item.price}}</text>
            </view>
            <view class="info-row">
              <text class="info-label">æ•°é‡ï¼š</text>
              <text class="info-value">{{item.quantity}}</text>
            </view>
            <view class="info-row">
              <text class="info-label">äº§åœ°ï¼š</text>
              <text class="info-value">{{item.location}} {{item.market}}</text>
            </view>
          </view>
          
          <!-- æ ‡ç­¾ -->
          <view class="item-tags">
            <text 
              wx:for="{{item.tags}}" 
              wx:key="*this" 
              wx:for-item="tag"
              class="tag-item"
            >
              {{tag}}
            </text>
          </view>
        </view>
        
        <!-- å›¾ç‰‡ -->
        <view class="item-image" wx:if="{{item.images.length > 0}}">
          <image class="info-image" src="{{item.images[0]}}" mode="aspectFill"></image>
        </view>
      </view>

      <!-- å•†æˆ·ä¿¡æ¯ -->
      <view class="merchant-info">
        <view class="merchant-basic">
          <image class="merchant-avatar" src="{{item.merchant.avatar}}" mode="aspectFill"></image>
          <view class="merchant-details">
            <text class="merchant-name">{{item.merchant.name}}</text>
            <view class="merchant-rating">
              <text class="rating-score">{{item.merchant.rating}}</text>
              <text class="rating-star">â­</text>
              <text class="verified-badge" wx:if="{{item.merchant.isVerified}}">å·²è®¤è¯</text>
            </view>
            <text class="merchant-business">{{item.merchant.mainBusiness}}</text>
          </view>
        </view>
        
        <view class="merchant-actions">
          <button 
            class="contact-btn"
            data-wechat="merchant_{{item.id}}"
            bindtap="contactPublisher"
            catchtap="contactPublisher"
          >
            è”ç³»å•†æˆ·
          </button>
        </view>
      </view>

      <!-- åº•éƒ¨ä¿¡æ¯ -->
      <view class="item-footer">
        <view class="footer-left">
          <view class="stats-item">
            <text class="stats-icon">ğŸ‘ï¸</text>
            <text class="stats-text">{{item.viewCount}}</text>
          </view>
          <view class="stats-item">
            <text class="stats-icon">â¤ï¸</text>
            <text class="stats-text">{{item.favoriteCount}}</text>
          </view>
          <view class="stats-item">
            <text class="stats-icon">ğŸ’¬</text>
            <text class="stats-text">{{item.contactCount}}</text>
          </view>
        </view>
        
        <view class="footer-right">
          <text class="validity-period">æœ‰æ•ˆæœŸï¼š{{item.validityPeriod}}</text>
          <text class="update-time">{{item.updateTime}}</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="item-actions">
        <button 
          class="action-btn favorite {{item.isFavorited ? 'active' : ''}}"
          data-id="{{item.id}}"
          data-type="{{item.type}}"
          bindtap="toggleFavorite"
          catchtap="toggleFavorite"
        >
          <text class="action-icon">{{item.isFavorited ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          <text class="action-text">æ”¶è—</text>
        </button>
        
        <button 
          class="action-btn share"
          data-id="{{item.id}}"
          data-type="{{item.type}}"
        >
          <text class="action-icon">ğŸ“¤</text>
          <text class="action-text">åˆ†äº«</text>
        </button>
      </view>
    </view>
  </view>
  
  <!-- æ±‚è´­ä¿¡æ¯æµ -->
  <view class="info-list" wx:if="{{currentTab === 'demand'}}">
    <view class="list-title">æ±‚è´­ä¿¡æ¯</view>
    
    <view 
      wx:for="{{demandList}}" 
      wx:key="id"
      class="info-item demand"
      data-id="{{item.id}}"
      data-type="{{item.type}}"
      bindtap="onItemTap"
    >
      <!-- ä¿¡æ¯å¤´éƒ¨ -->
      <view class="item-header">
        <view class="item-type demand">{{item.typeText}}</view>
        <view class="item-badges">
          <view class="badge urgent" wx:if="{{item.isUrgent}}">ç´§æ€¥</view>
          <view class="badge recommend" wx:if="{{item.isRecommended}}">æ¨è</view>
        </view>
      </view>

      <!-- ä¿¡æ¯å†…å®¹ -->
      <view class="item-content">
        <view class="content-main">
          <text class="item-title">{{item.title}}</text>
          <text class="item-desc">{{item.description}}</text>
          
          <!-- å…³é”®ä¿¡æ¯ -->
          <view class="key-info">
            <view class="info-row">
              <text class="info-label">èŒ¶ç±»ï¼š</text>
              <text class="info-value">{{item.teaType}} - {{item.teaSubType}}</text>
            </view>
            <view class="info-row">
              <text class="info-label">æ•°é‡ï¼š</text>
              <text class="info-value">{{item.quantity}}</text>
            </view>
            <view class="info-row">
              <text class="info-label">é¢„ç®—ï¼š</text>
              <text class="info-value budget">{{item.budget}}</text>
            </view>
            <view class="info-row">
              <text class="info-label">æ”¶è´§åœ°ï¼š</text>
              <text class="info-value">{{item.location}} {{item.market}}</text>
            </view>
          </view>
          
          <!-- è¦æ±‚ -->
          <view class="requirements-section" wx:if="{{item.requirements.length > 0}}">
            <text class="requirements-title">è¦æ±‚ï¼š</text>
            <view class="requirements-list">
              <text 
                wx:for="{{item.requirements}}" 
                wx:key="*this" 
                wx:for-item="req"
                class="requirement-item"
              >
                â€¢ {{req}}
              </text>
            </view>
          </view>
          
          <!-- æ ‡ç­¾ -->
          <view class="item-tags">
            <text 
              wx:for="{{item.tags}}" 
              wx:key="*this" 
              wx:for-item="tag"
              class="tag-item"
            >
              {{tag}}
            </text>
          </view>
        </view>
      </view>

      <!-- ä¹°å®¶ä¿¡æ¯ -->
      <view class="buyer-info">
        <view class="buyer-basic">
          <image class="buyer-avatar" src="{{item.buyer.avatar}}" mode="aspectFill"></image>
          <view class="buyer-details">
            <text class="buyer-name">{{item.buyer.name}}</text>
            <view class="buyer-rating">
              <text class="rating-score">{{item.buyer.rating}}</text>
              <text class="rating-star">â­</text>
              <text class="verified-badge" wx:if="{{item.buyer.isVerified}}">å·²è®¤è¯</text>
            </view>
            <text class="buyer-scale">{{item.buyer.purchaseScale}}</text>
          </view>
        </view>
        
        <view class="buyer-actions">
          <button 
            class="contact-btn"
            data-wechat="buyer_{{item.id}}"
            bindtap="contactPublisher"
            catchtap="contactPublisher"
          >
            è”ç³»ä¹°å®¶
          </button>
        </view>
      </view>

      <!-- åº•éƒ¨ä¿¡æ¯ -->
      <view class="item-footer">
        <view class="footer-left">
          <view class="stats-item">
            <text class="stats-icon">ğŸ‘ï¸</text>
            <text class="stats-text">{{item.viewCount}}</text>
          </view>
          <view class="stats-item">
            <text class="stats-icon">â¤ï¸</text>
            <text class="stats-text">{{item.favoriteCount}}</text>
          </view>
          <view class="stats-item">
            <text class="stats-icon">ğŸ’¬</text>
            <text class="stats-text">{{item.contactCount}}</text>
          </view>
        </view>
        
        <view class="footer-right">
          <text class="validity-period">æœ‰æ•ˆæœŸï¼š{{item.validityPeriod}}</text>
          <text class="update-time">{{item.updateTime}}</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="item-actions">
        <button 
          class="action-btn favorite {{item.isFavorited ? 'active' : ''}}"
          data-id="{{item.id}}"
          data-type="{{item.type}}"
          bindtap="toggleFavorite"
          catchtap="toggleFavorite"
        >
          <text class="action-icon">{{item.isFavorited ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          <text class="action-text">æ”¶è—</text>
        </button>
        
        <button 
          class="action-btn share"
          data-id="{{item.id}}"
          data-type="{{item.type}}"
        >
          <text class="action-icon">ğŸ“¤</text>
          <text class="action-text">åˆ†äº«</text>
        </button>
      </view>
    </view>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{loading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
  
  <view class="no-more" wx:if="{{!hasMore && (supplyList.length > 0 || demandList.length > 0)}}">
    <text class="no-more-text">æ²¡æœ‰æ›´å¤šä¿¡æ¯äº†</text>
  </view>
  
  <view class="empty-state" wx:if="{{(currentTab === 'supply' && supplyList.length === 0) || (currentTab === 'demand' && demandList.length === 0)}}">
    <text class="empty-text">æš‚æ— {{currentTab === 'supply' ? 'ä¾›åº”' : 'æ±‚è´­'}}ä¿¡æ¯</text>
  </view>
</view> 