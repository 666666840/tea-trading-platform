<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-left" bindtap="goBack">
      <text class="back-icon">â†</text>
      <text class="back-text">è¿”å›</text>
    </view>
    <view class="header-title">å†…å®¹ç®¡ç†</view>
    <view class="header-right">
      <button class="refresh-btn" bindtap="refreshContent">
        <text class="refresh-icon">ğŸ”„</text>
      </button>
    </view>
  </view>

  <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
  <view class="tab-nav">
    <view class="tab-item {{activeTab === 'config' ? 'active' : ''}}" 
          bindtap="switchTab" 
          data-tab="config">
      <text class="tab-text">é…ç½®</text>
    </view>
    <view class="tab-item {{activeTab === 'external' ? 'active' : ''}}" 
          bindtap="switchTab" 
          data-tab="external">
      <text class="tab-text">å¤–éƒ¨API</text>
    </view>
    <view class="tab-item {{activeTab === 'rss' ? 'active' : ''}}" 
          bindtap="switchTab" 
          data-tab="rss">
      <text class="tab-text">RSSæº</text>
    </view>
    <view class="tab-item {{activeTab === 'stats' ? 'active' : ''}}" 
          bindtap="switchTab" 
          data-tab="stats">
      <text class="tab-text">ç»Ÿè®¡</text>
    </view>
  </view>

  <!-- é…ç½®æ ‡ç­¾é¡µ -->
  <view class="tab-content" wx:if="{{activeTab === 'config'}}">
    <view class="config-section">
      <text class="section-title">å†…å®¹æºé…ç½®</text>
      
      <!-- å¤–éƒ¨å†…å®¹å¼€å…³ -->
      <view class="config-item">
        <view class="config-info">
          <text class="config-label">å¯ç”¨å¤–éƒ¨å†…å®¹</text>
          <text class="config-desc">ä»å¤–éƒ¨APIè·å–æ–‡ç« å†…å®¹</text>
        </view>
        <switch 
          checked="{{contentSource.useExternal}}" 
          bindchange="toggleContentSource" 
          data-key="useExternal"
        />
      </view>
      
      <!-- RSSæºå¼€å…³ -->
      <view class="config-item">
        <view class="config-info">
          <text class="config-label">å¯ç”¨RSSæº</text>
          <text class="config-desc">ä»RSSè®¢é˜…æºè·å–å†…å®¹</text>
        </view>
        <switch 
          checked="{{contentSource.useRSS}}" 
          bindchange="toggleContentSource" 
          data-key="useRSS"
        />
      </view>
      
      <!-- æœ¬åœ°å†…å®¹å¼€å…³ -->
      <view class="config-item">
        <view class="config-info">
          <text class="config-label">å¯ç”¨æœ¬åœ°å†…å®¹</text>
          <text class="config-desc">æ˜¾ç¤ºæœ¬åœ°ç¼–è¾‘çš„å†…å®¹</text>
        </view>
        <switch 
          checked="{{contentSource.useLocal}}" 
          bindchange="toggleContentSource" 
          data-key="useLocal"
        />
      </view>
    </view>

    <view class="config-section">
      <text class="section-title">å†…å®¹ä¼˜å…ˆçº§</text>
      
      <!-- å¤–éƒ¨å†…å®¹ä¼˜å…ˆçº§ -->
      <view class="config-item">
        <view class="config-info">
          <text class="config-label">å¤–éƒ¨å†…å®¹ä¼˜å…ˆçº§</text>
          <text class="config-desc">{{contentSource.externalPriority * 100}}%</text>
        </view>
        <slider 
          value="{{contentSource.externalPriority * 100}}" 
          bindchange="adjustPriority" 
          data-key="externalPriority"
          min="0" 
          max="100" 
          step="10"
        />
      </view>
      
      <!-- æœ¬åœ°å†…å®¹ä¼˜å…ˆçº§ -->
      <view class="config-item">
        <view class="config-info">
          <text class="config-label">æœ¬åœ°å†…å®¹ä¼˜å…ˆçº§</text>
          <text class="config-desc">{{contentSource.localPriority * 100}}%</text>
        </view>
        <slider 
          value="{{contentSource.localPriority * 100}}" 
          bindchange="adjustPriority" 
          data-key="localPriority"
          min="0" 
          max="100" 
          step="10"
        />
      </view>
    </view>

    <view class="config-section">
      <text class="section-title">ç½‘ç»œçŠ¶æ€</text>
      
      <view class="status-grid">
        <view class="status-item">
          <text class="status-label">å¤–éƒ¨API</text>
          <text class="status-value {{networkStatus.externalAvailable ? 'success' : 'error'}}">
            {{networkStatus.externalAvailable ? 'æ­£å¸¸' : 'å¼‚å¸¸'}}
          </text>
        </view>
        <view class="status-item">
          <text class="status-label">RSSæº</text>
          <text class="status-value {{networkStatus.rssAvailable ? 'success' : 'error'}}">
            {{networkStatus.rssAvailable ? 'æ­£å¸¸' : 'å¼‚å¸¸'}}
          </text>
        </view>
      </view>
      
      <text class="status-time">æœ€åæ£€æŸ¥: {{networkStatus.lastCheck || 'æœªæ£€æŸ¥'}}</text>
    </view>

    <view class="config-section">
      <text class="section-title">é…ç½®æ“ä½œ</text>
      
      <view class="action-buttons">
        <button class="action-btn export-btn" bindtap="exportConfig">
          <text class="btn-icon">ğŸ“¤</text>
          <text class="btn-text">å¯¼å‡ºé…ç½®</text>
        </button>
        <button class="action-btn import-btn" bindtap="importConfig">
          <text class="btn-icon">ğŸ“¥</text>
          <text class="btn-text">å¯¼å…¥é…ç½®</text>
        </button>
        <button class="action-btn reset-btn" bindtap="resetConfig">
          <text class="btn-icon">ğŸ”„</text>
          <text class="btn-text">é‡ç½®é…ç½®</text>
        </button>
      </view>
    </view>
  </view>

  <!-- å¤–éƒ¨APIæ ‡ç­¾é¡µ -->
  <view class="tab-content" wx:if="{{activeTab === 'external'}}">
    <view class="api-list">
      <view class="api-item" 
            wx:for="{{externalAPIs}}" 
            wx:key="baseUrl"
            wx:for-item="api"
            wx:for-index="index">
        <view class="api-header" bindtap="viewContentDetail" data-type="external" data-index="{{index}}">
          <view class="api-info">
            <text class="api-name">{{api.name}}</text>
            <text class="api-url">{{api.baseUrl}}</text>
          </view>
          <view class="api-status {{api.status}}">
            <text class="status-dot"></text>
            <text class="status-text">{{api.status}}</text>
          </view>
        </view>
        
        <view class="api-details">
          <view class="detail-item">
            <text class="detail-label">æ–‡ç« æ•°é‡</text>
            <text class="detail-value">{{api.articleCount}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">æœ€åæ£€æŸ¥</text>
            <text class="detail-value">{{api.lastCheck}}</text>
          </view>
        </view>
        
        <view class="api-actions">
          <button class="test-btn" 
                  bindtap="testAPIConnection" 
                  data-index="{{index}}">
            æµ‹è¯•è¿æ¥
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- RSSæºæ ‡ç­¾é¡µ -->
  <view class="tab-content" wx:if="{{activeTab === 'rss'}}">
    <view class="rss-header">
      <text class="section-title">RSSè®¢é˜…æº</text>
      <button class="add-btn" bindtap="addRSSFeed">
        <text class="add-icon">+</text>
        <text class="add-text">æ·»åŠ æº</text>
      </button>
    </view>
    
    <view class="rss-list">
      <view class="rss-item" 
            wx:for="{{rssFeeds}}" 
            wx:key="url"
            wx:for-item="feed"
            wx:for-index="index">
        <view class="rss-header" bindtap="viewContentDetail" data-type="rss" data-index="{{index}}">
          <view class="rss-info">
            <text class="rss-name">{{feed.name}}</text>
            <text class="rss-url">{{feed.url}}</text>
          </view>
          <view class="rss-status {{feed.status}}">
            <text class="status-dot"></text>
            <text class="status-text">{{feed.status}}</text>
          </view>
        </view>
        
        <view class="rss-details">
          <view class="detail-item">
            <text class="detail-label">åˆ†ç±»</text>
            <text class="detail-value">{{feed.category}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">æ–‡ç« æ•°é‡</text>
            <text class="detail-value">{{feed.articleCount}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">æœ€åæ›´æ–°</text>
            <text class="detail-value">{{feed.lastUpdate}}</text>
          </view>
        </view>
        
        <view class="rss-actions">
          <button class="test-btn" 
                  bindtap="testRSSFeed" 
                  data-index="{{index}}">
            æµ‹è¯•æº
          </button>
          <button class="delete-btn" 
                  bindtap="deleteRSSFeed" 
                  data-index="{{index}}">
            åˆ é™¤
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡æ ‡ç­¾é¡µ -->
  <view class="tab-content" wx:if="{{activeTab === 'stats'}}">
    <view class="stats-section">
      <text class="section-title">å†…å®¹ç»Ÿè®¡</text>
      
      <view class="stats-grid">
        <view class="stat-item">
          <text class="stat-value">{{contentStats.totalArticles}}</text>
          <text class="stat-label">æ€»æ–‡ç« æ•°</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{contentStats.externalArticles}}</text>
          <text class="stat-label">å¤–éƒ¨æ–‡ç« </text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{contentStats.rssArticles}}</text>
          <text class="stat-label">RSSæ–‡ç« </text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{contentStats.localArticles}}</text>
          <text class="stat-label">æœ¬åœ°æ–‡ç« </text>
        </view>
      </view>
      
      <text class="stats-time">æœ€åæ›´æ–°: {{contentStats.lastUpdate || 'æœªæ›´æ–°'}}</text>
    </view>

    <view class="stats-section">
      <text class="section-title">å†…å®¹åˆ†å¸ƒ</text>
      
      <view class="distribution-chart">
        <view class="chart-item">
          <view class="chart-bar external" style="width: {{contentStats.externalArticles / contentStats.totalArticles * 100}}%"></view>
          <text class="chart-label">å¤–éƒ¨å†…å®¹</text>
          <text class="chart-percent">{{Math.round(contentStats.externalArticles / contentStats.totalArticles * 100)}}%</text>
        </view>
        <view class="chart-item">
          <view class="chart-bar rss" style="width: {{contentStats.rssArticles / contentStats.totalArticles * 100}}%"></view>
          <text class="chart-label">RSSå†…å®¹</text>
          <text class="chart-percent">{{Math.round(contentStats.rssArticles / contentStats.totalArticles * 100)}}%</text>
        </view>
        <view class="chart-item">
          <view class="chart-bar local" style="width: {{contentStats.localArticles / contentStats.totalArticles * 100}}%"></view>
          <text class="chart-label">æœ¬åœ°å†…å®¹</text>
          <text class="chart-percent">{{Math.round(contentStats.localArticles / contentStats.totalArticles * 100)}}%</text>
        </view>
      </view>
    </view>
  </view>
</view> 