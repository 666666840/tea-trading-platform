<view class="dashboard">
  <!-- é¡¶éƒ¨æ“ä½œæ  -->
  <view class="action-bar">
    <button class="action-btn" bindtap="onRefresh" disabled="{{loading}}">
      <text class="icon">ğŸ”„</text>
      <text>åˆ·æ–°</text>
    </button>
    <button class="action-btn" bindtap="toggleFilters">
      <text class="icon">ğŸ”</text>
      <text>ç­›é€‰</text>
    </button>
    <button class="action-btn" bindtap="exportData">
      <text class="icon">ğŸ“Š</text>
      <text>å¯¼å‡º</text>
    </button>
    <button class="action-btn" bindtap="onOptimize">
      <text class="icon">âš¡</text>
      <text>ä¼˜åŒ–</text>
    </button>
  </view>

  <!-- ç­›é€‰å™¨ -->
  <view class="filters" wx:if="{{showFilters}}">
    <picker bindchange="onFilterChange" data-type="timeRange" value="{{filters.timeRange}}" range="{{['24å°æ—¶', '7å¤©', '30å¤©']}}">
      <view class="filter-item">
        <text>æ—¶é—´èŒƒå›´: {{filters.timeRange}}</text>
      </view>
    </picker>
    <picker bindchange="onFilterChange" data-type="alertType" value="{{filters.alertType}}" range="{{['å…¨éƒ¨', 'é”™è¯¯', 'è­¦å‘Š', 'ä¿¡æ¯']}}">
      <view class="filter-item">
        <text>å‘Šè­¦ç±»å‹: {{filters.alertType}}</text>
      </view>
    </picker>
    <picker bindchange="onFilterChange" data-type="severity" value="{{filters.severity}}" range="{{['å…¨éƒ¨', 'é«˜', 'ä¸­', 'ä½']}}">
      <view class="filter-item">
        <text>ä¸¥é‡ç¨‹åº¦: {{filters.severity}}</text>
      </view>
    </picker>
  </view>

  <!-- æ ¸å¿ƒæŒ‡æ ‡å¡ç‰‡ -->
  <view class="metrics">
    <view class="metric-card">
      <text class="metric-label">å†…å­˜å ç”¨ç‡</text>
      <text class="metric-value">{{metrics.memoryUsage || 0}}%</text>
      <text class="metric-status {{metrics.memoryUsage > 80 ? 'warning' : 'normal'}}">
        {{metrics.memoryUsage > 80 ? 'âš ï¸' : 'âœ…'}}
      </text>
    </view>
    <view class="metric-card">
      <text class="metric-label">APIå¹³å‡å“åº”</text>
      <text class="metric-value">{{metrics.apiAvgResponseTime || 0}}ms</text>
      <text class="metric-status {{metrics.apiAvgResponseTime > 2000 ? 'warning' : 'normal'}}">
        {{metrics.apiAvgResponseTime > 2000 ? 'âš ï¸' : 'âœ…'}}
      </text>
    </view>
    <view class="metric-card">
      <text class="metric-label">é”™è¯¯ç‡</text>
      <text class="metric-value">{{metrics.errorRate || 0}}%</text>
      <text class="metric-status {{metrics.errorRate > 5 ? 'warning' : 'normal'}}">
        {{metrics.errorRate > 5 ? 'âš ï¸' : 'âœ…'}}
      </text>
    </view>
    <view class="metric-card">
      <text class="metric-label">è¿è¡Œæ—¶é•¿</text>
      <text class="metric-value">{{metrics.uptime || 0}}åˆ†é’Ÿ</text>
      <text class="metric-status normal">âœ…</text>
    </view>
  </view>

  <!-- è‡ªå®šä¹‰æŒ‡æ ‡å¡ç‰‡ -->
  <view class="custom-metrics">
    <view class="section-title">ğŸ“ˆ è‡ªå®šä¹‰æŒ‡æ ‡</view>
    <view class="custom-metrics-grid">
      <view class="custom-metric-card">
        <text class="custom-metric-label">æ´»è·ƒç”¨æˆ·</text>
        <text class="custom-metric-value">{{customMetrics.activeUsers}}</text>
      </view>
      <view class="custom-metric-card">
        <text class="custom-metric-label">å‘Šè­¦æ•°é‡</text>
        <text class="custom-metric-value">{{customMetrics.alertCount}}</text>
      </view>
      <view class="custom-metric-card">
        <text class="custom-metric-label">æ…¢APIæ•°é‡</text>
        <text class="custom-metric-value">{{customMetrics.slowAPIs.length}}</text>
      </view>
      <view class="custom-metric-card">
        <text class="custom-metric-label">çƒ­é—¨é¡µé¢</text>
        <text class="custom-metric-value">{{customMetrics.topPages.length}}</text>
      </view>
    </view>
  </view>

  <!-- è¶‹åŠ¿å›¾è¡¨ -->
  <view class="charts-section">
    <view class="section-title">ğŸ“Š æ€§èƒ½è¶‹åŠ¿</view>
    
    <!-- å†…å­˜ä½¿ç”¨ç‡è¶‹åŠ¿ -->
    <view class="chart-container">
      <view class="chart-title">å†…å­˜ä½¿ç”¨ç‡è¶‹åŠ¿ (24å°æ—¶)</view>
      <view class="chart-wrapper">
        <ec-canvas 
          id="memory-chart" 
          canvas-id="memory-chart" 
          ec="{{ ec }}" 
          data-chart="memory"
          bindinit="onChartInit"
          class="chart-canvas">
        </ec-canvas>
      </view>
    </view>

    <!-- APIå“åº”æ—¶é—´è¶‹åŠ¿ -->
    <view class="chart-container">
      <view class="chart-title">APIå“åº”æ—¶é—´è¶‹åŠ¿ (24å°æ—¶)</view>
      <view class="chart-wrapper">
        <ec-canvas 
          id="api-chart" 
          canvas-id="api-chart" 
          ec="{{ ec }}" 
          data-chart="api"
          bindinit="onChartInit"
          class="chart-canvas">
        </ec-canvas>
      </view>
    </view>

    <!-- é”™è¯¯ç‡è¶‹åŠ¿ -->
    <view class="chart-container">
      <view class="chart-title">é”™è¯¯ç‡è¶‹åŠ¿ (24å°æ—¶)</view>
      <view class="chart-wrapper">
        <ec-canvas 
          id="error-chart" 
          canvas-id="error-chart" 
          ec="{{ ec }}" 
          data-chart="error"
          bindinit="onChartInit"
          class="chart-canvas">
        </ec-canvas>
      </view>
    </view>
  </view>

  <!-- æ…¢APIåˆ—è¡¨ -->
  <view class="slow-apis" wx:if="{{customMetrics.slowAPIs.length > 0}}">
    <view class="section-title">ğŸŒ æ…¢API Top5</view>
    <view class="api-list">
      <view class="api-item" wx:for="{{customMetrics.slowAPIs}}" wx:key="name">
        <view class="api-info">
          <text class="api-name">{{item.name}}</text>
          <text class="api-time">{{item.time}}ms</text>
        </view>
        <text class="api-time">{{item.timestamp}}</text>
      </view>
    </view>
  </view>

  <!-- çƒ­é—¨é¡µé¢ -->
  <view class="top-pages" wx:if="{{customMetrics.topPages.length > 0}}">
    <view class="section-title">ğŸ”¥ çƒ­é—¨é¡µé¢</view>
    <view class="page-list">
      <view class="page-item" wx:for="{{customMetrics.topPages}}" wx:key="name">
        <view class="page-info">
          <text class="page-name">{{item.name}}</text>
          <text class="page-visits">{{item.visits}}æ¬¡è®¿é—®</text>
        </view>
        <text class="page-load-time">{{item.loadTime}}ms</text>
      </view>
    </view>
  </view>

  <!-- å¼‚å¸¸å‘Šè­¦ -->
  <view class="section" wx:if="{{alerts.length > 0}}">
    <view class="section-title">ğŸš¨ å¼‚å¸¸å‘Šè­¦ ({{alerts.length}})</view>
    <view class="alert-list">
      <view class="alert-item {{item.level}}" wx:for="{{alerts}}" wx:key="id" bindtap="showAlertDetail" data-alert="{{item}}">
        <view class="alert-header">
          <text class="alert-level">{{item.level}}</text>
          <text class="alert-time">{{item.timestamp}}</text>
        </view>
        <text class="alert-message">{{item.message}}</text>
        <text class="alert-type">{{item.type}}</text>
      </view>
    </view>
  </view>

  <!-- ä¼˜åŒ–å»ºè®® -->
  <view class="section" wx:if="{{suggestions.length > 0}}">
    <view class="section-title">ğŸ’¡ ä¼˜åŒ–å»ºè®® ({{suggestions.length}})</view>
    <view class="suggestion-list">
      <view class="suggestion-item" wx:for="{{suggestions}}" wx:key="index">
        <text class="suggestion-icon">ğŸ’¡</text>
        <text class="suggestion-text">{{item}}</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <text>æ•°æ®åŠ è½½ä¸­...</text>
  </view>
</view> 