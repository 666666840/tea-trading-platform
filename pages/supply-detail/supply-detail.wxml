<!-- ä¾›åº”è¯¦æƒ…é¡µé¢ -->
<view class="supply-detail-page">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- è¯¦æƒ…å†…å®¹ -->
  <view class="detail-content" wx:if="{{!loading && supplyInfo}}">
    <!-- å›¾ç‰‡è½®æ’­ -->
    <view class="image-section">
      <swiper 
        class="image-swiper" 
        indicator-dots="{{true}}"
        autoplay="{{false}}"
        interval="3000"
        duration="500"
        bindchange="onImageChange"
      >
        <swiper-item wx:for="{{supplyInfo.images}}" wx:key="*this">
          <image 
            class="swiper-image" 
            src="{{item}}" 
            mode="aspectFill"
            data-index="{{index}}"
            bindtap="previewImage"
          ></image>
        </swiper-item>
      </swiper>
      
      <!-- å›¾ç‰‡æŒ‡ç¤ºå™¨ -->
      <view class="image-indicator">
        <text class="indicator-text">{{currentImageIndex + 1}}/{{supplyInfo.images.length}}</text>
      </view>
    </view>

    <!-- åŸºæœ¬ä¿¡æ¯ -->
    <view class="basic-info">
      <view class="info-header">
        <view class="type-badge supply">{{supplyInfo.typeText}}</view>
        <view class="badges">
          <view class="badge new" wx:if="{{supplyInfo.isNew}}">æ–°å“</view>
          <view class="badge clearance" wx:if="{{supplyInfo.isClearance}}">å°¾è´§</view>
          <view class="badge recommend" wx:if="{{supplyInfo.isRecommended}}">æ¨è</view>
          <view class="badge urgent" wx:if="{{supplyInfo.isUrgent}}">ç´§æ€¥</view>
        </view>
      </view>
      
      <text class="title">{{supplyInfo.title}}</text>
      <text class="description">{{supplyInfo.description}}</text>
      
      <!-- å…³é”®ä¿¡æ¯ -->
      <view class="key-info">
        <view class="info-row">
          <text class="info-label">èŒ¶ç±»ï¼š</text>
          <text class="info-value">{{supplyInfo.teaType}} - {{supplyInfo.teaSubType}}</text>
        </view>
        <view class="info-row">
          <text class="info-label">ä»·æ ¼ï¼š</text>
          <text class="info-value price">{{supplyInfo.price}}</text>
        </view>
        <view class="info-row">
          <text class="info-label">æ•°é‡ï¼š</text>
          <text class="info-value">{{supplyInfo.quantity}}</text>
        </view>
        <view class="info-row">
          <text class="info-label">äº§åœ°ï¼š</text>
          <text class="info-value">{{supplyInfo.location}} {{supplyInfo.market}}</text>
        </view>
        <view class="info-row">
          <text class="info-label">æœ‰æ•ˆæœŸï¼š</text>
          <text class="info-value">{{supplyInfo.validityPeriod}}</text>
        </view>
      </view>
      
      <!-- æ ‡ç­¾ -->
      <view class="tags">
        <text 
          wx:for="{{supplyInfo.tags}}" 
          wx:key="*this" 
          wx:for-item="tag"
          class="tag-item"
        >
          {{tag}}
        </text>
      </view>
    </view>

    <!-- å•†æˆ·ä¿¡æ¯ -->
    <view class="merchant-section">
      <view class="section-header">
        <text class="section-title">å•†æˆ·ä¿¡æ¯</text>
        <button class="view-detail-btn" bindtap="viewMerchantDetail">æŸ¥çœ‹è¯¦æƒ…</button>
      </view>
      
      <view class="merchant-card">
        <view class="merchant-basic">
          <image class="merchant-avatar" src="{{supplyInfo.merchant.avatar}}" mode="aspectFill"></image>
          <view class="merchant-info">
            <view class="merchant-name-row">
              <text class="merchant-name">{{supplyInfo.merchant.name}}</text>
              <text class="verified-badge" wx:if="{{supplyInfo.merchant.isVerified}}">å·²è®¤è¯</text>
            </view>
            <view class="merchant-rating">
              <text class="rating-score">{{supplyInfo.merchant.rating}}</text>
              <text class="rating-star">â­</text>
              <text class="business-type">{{supplyInfo.merchant.mainBusiness}}</text>
            </view>
            <view class="merchant-stats">
              <text class="stat-item">ç»è¥{{supplyInfo.merchant.businessYears}}å¹´</text>
              <text class="stat-item">ä¾›åº”{{supplyInfo.merchant.totalSupply}}æ¬¡</text>
              <text class="stat-item">å›å¤ç‡{{supplyInfo.merchant.responseRate}}%</text>
            </view>
          </view>
        </view>
        
        <!-- è”ç³»æŒ‰é’® -->
        <view class="contact-buttons">
          <button 
            class="contact-btn phone {{contactUnlocked ? 'unlocked' : 'locked'}}"
            bindtap="onPhoneTap"
          >
            <text class="btn-icon">ğŸ“</text>
            <text class="btn-text">{{contactUnlocked ? 'æ‹¨æ‰“ç”µè¯' : 'è§£é”ç”µè¯'}}</text>
          </button>
          
          <button 
            class="contact-btn wechat {{contactUnlocked ? 'unlocked' : 'locked'}}"
            bindtap="onWechatTap"
          >
            <text class="btn-icon">ğŸ’¬</text>
            <text class="btn-text">{{contactUnlocked ? 'å¤åˆ¶å¾®ä¿¡' : 'è§£é”å¾®ä¿¡'}}</text>
          </button>
        </view>
      </view>
    </view>

    <!-- è§„æ ¼å‚æ•° -->
    <view class="specifications-section">
      <view class="section-header">
        <text class="section-title">è§„æ ¼å‚æ•°</text>
      </view>
      
      <view class="specs-grid">
        <view class="spec-item">
          <text class="spec-label">å¹´ä»½</text>
          <text class="spec-value">{{supplyInfo.specifications.year}}</text>
        </view>
        <view class="spec-item">
          <text class="spec-label">ç­‰çº§</text>
          <text class="spec-value">{{supplyInfo.specifications.grade}}</text>
        </view>
        <view class="spec-item">
          <text class="spec-label">äº§åœ°</text>
          <text class="spec-value">{{supplyInfo.specifications.origin}}</text>
        </view>
        <view class="spec-item">
          <text class="spec-label">å·¥è‰º</text>
          <text class="spec-value">{{supplyInfo.specifications.process}}</text>
        </view>
        <view class="spec-item">
          <text class="spec-label">å­˜å‚¨</text>
          <text class="spec-value">{{supplyInfo.specifications.storage}}</text>
        </view>
        <view class="spec-item">
          <text class="spec-label">æ°´åˆ†</text>
          <text class="spec-value">{{supplyInfo.specifications.moisture}}</text>
        </view>
        <view class="spec-item">
          <text class="spec-label">åŒ…è£…</text>
          <text class="spec-value">{{supplyInfo.specifications.packaging}}</text>
        </view>
      </view>
    </view>

    <!-- å“è´¨ç‰¹å¾ -->
    <view class="quality-section">
      <view class="section-header">
        <text class="section-title">å“è´¨ç‰¹å¾</text>
      </view>
      
      <view class="quality-list">
        <view class="quality-item">
          <text class="quality-label">å¤–è§‚</text>
          <text class="quality-value">{{supplyInfo.quality.appearance}}</text>
        </view>
        <view class="quality-item">
          <text class="quality-label">é¦™æ°”</text>
          <text class="quality-value">{{supplyInfo.quality.aroma}}</text>
        </view>
        <view class="quality-item">
          <text class="quality-label">å£æ„Ÿ</text>
          <text class="quality-value">{{supplyInfo.quality.taste}}</text>
        </view>
        <view class="quality-item">
          <text class="quality-label">æ±¤è‰²</text>
          <text class="quality-value">{{supplyInfo.quality.soup}}</text>
        </view>
      </view>
    </view>

    <!-- é…é€ä¿¡æ¯ -->
    <view class="delivery-section">
      <view class="section-header">
        <text class="section-title">é…é€ä¿¡æ¯</text>
      </view>
      
      <view class="delivery-info">
        <view class="delivery-item">
          <text class="delivery-label">é…é€æ–¹å¼</text>
          <text class="delivery-value">{{supplyInfo.delivery.method}}</text>
        </view>
        <view class="delivery-item">
          <text class="delivery-label">é…é€æ—¶é—´</text>
          <text class="delivery-value">{{supplyInfo.delivery.time}}</text>
        </view>
        <view class="delivery-item">
          <text class="delivery-label">é…é€åŒºåŸŸ</text>
          <text class="delivery-value">{{supplyInfo.delivery.area}}</text>
        </view>
        <view class="delivery-item">
          <text class="delivery-label">è¿è´¹</text>
          <text class="delivery-value">{{supplyInfo.delivery.cost}}</text>
        </view>
        <view class="delivery-item">
          <text class="delivery-label">ä¿é™©</text>
          <text class="delivery-value">{{supplyInfo.delivery.insurance}}</text>
        </view>
      </view>
    </view>

    <!-- æ”¯ä»˜æ–¹å¼ -->
    <view class="payment-section">
      <view class="section-header">
        <text class="section-title">æ”¯ä»˜æ–¹å¼</text>
      </view>
      
      <view class="payment-info">
        <view class="payment-methods">
          <text 
            wx:for="{{supplyInfo.payment.methods}}" 
            wx:key="*this" 
            wx:for-item="method"
            class="payment-method"
          >
            {{method}}
          </text>
        </view>
        <view class="payment-terms">
          <text class="terms-label">ä»˜æ¬¾æ¡ä»¶ï¼š</text>
          <text class="terms-value">{{supplyInfo.payment.terms}}</text>
        </view>
        <view class="payment-guarantee">
          <text class="guarantee-label">å“è´¨ä¿è¯ï¼š</text>
          <text class="guarantee-value">{{supplyInfo.payment.guarantee}}</text>
        </view>
      </view>
    </view>

    <!-- è®¤è¯è¯ä¹¦ -->
    <view class="certificates-section" wx:if="{{supplyInfo.certificates.length > 0}}">
      <view class="section-header">
        <text class="section-title">è®¤è¯è¯ä¹¦</text>
      </view>
      
      <view class="certificates-list">
        <view 
          wx:for="{{supplyInfo.certificates}}" 
          wx:key="name"
          class="certificate-item"
        >
          <view class="certificate-info">
            <text class="certificate-name">{{item.name}}</text>
            <text class="certificate-issuer">{{item.issuer}}</text>
            <text class="certificate-valid">æœ‰æ•ˆæœŸè‡³ï¼š{{item.validUntil}}</text>
          </view>
          <view class="certificate-status">
            <text class="status-text">æœ‰æ•ˆ</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç›¸å…³æ¨è -->
    <view class="related-section" wx:if="{{relatedList.length > 0}}">
      <view class="section-header">
        <text class="section-title">ç›¸å…³æ¨è</text>
      </view>
      
      <view class="related-list">
        <view 
          wx:for="{{relatedList}}" 
          wx:key="id"
          class="related-item"
          data-id="{{item.id}}"
          bindtap="onRelatedTap"
        >
          <image class="related-image" src="{{item.image}}" mode="aspectFill"></image>
          <view class="related-info">
            <text class="related-title">{{item.title}}</text>
            <text class="related-price">{{item.price}}</text>
            <text class="related-location">{{item.location}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <view class="stats-section">
      <view class="stats-item">
        <text class="stats-icon">ğŸ‘ï¸</text>
        <text class="stats-text">{{supplyInfo.viewCount}} æµè§ˆ</text>
      </view>
      <view class="stats-item">
        <text class="stats-icon">â¤ï¸</text>
        <text class="stats-text">{{supplyInfo.favoriteCount}} æ”¶è—</text>
      </view>
      <view class="stats-item">
        <text class="stats-icon">ğŸ’¬</text>
        <text class="stats-text">{{supplyInfo.contactCount}} è”ç³»</text>
      </view>
      <view class="stats-item">
        <text class="stats-icon">ğŸ“…</text>
        <text class="stats-text">{{supplyInfo.updateTime}}</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions" wx:if="{{!loading && supplyInfo}}">
    <view class="action-left">
      <button class="action-btn favorite {{isFavorited ? 'active' : ''}}" bindtap="toggleFavorite">
        <text class="action-icon">{{isFavorited ? 'â¤ï¸' : 'ğŸ¤'}}</text>
        <text class="action-text">æ”¶è—</text>
      </button>
      
      <button class="action-btn share" open-type="share">
        <text class="action-icon">ğŸ“¤</text>
        <text class="action-text">åˆ†äº«</text>
      </button>
      
      <button class="action-btn report" bindtap="reportSupply">
        <text class="action-icon">ğŸš¨</text>
        <text class="action-text">ä¸¾æŠ¥</text>
      </button>
    </view>
    
    <view class="action-right">
      <button class="contact-btn primary" bindtap="contactMerchant">
        <text class="btn-text">{{contactUnlocked ? 'è”ç³»å•†æˆ·' : 'è§£é”è”ç³»'}}</text>
      </button>
    </view>
  </view>
</view> 