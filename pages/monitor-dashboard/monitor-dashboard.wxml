<!-- ç›‘æ§æ•°æ®å¯è§†åŒ–é¡µé¢ -->
<view class="monitor-dashboard">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header">
    <view class="title">ç›‘æ§ä»ªè¡¨ç›˜</view>
    <view class="actions">
      <button class="btn btn-primary" bindtap="refreshData" loading="{{refreshing}}">
        <text class="icon">ğŸ”„</text>
        åˆ·æ–°
      </button>
      <button class="btn btn-secondary" bindtap="exportData">
        <text class="icon">ğŸ“Š</text>
        å¯¼å‡º
      </button>
      <button class="btn btn-warning" bindtap="resetData">
        <text class="icon">ğŸ—‘ï¸</text>
        é‡ç½®
      </button>
    </view>
  </view>

  <!-- ç­›é€‰å™¨ -->
  <view class="filters">
    <picker mode="selector" range="{{['1å°æ—¶', '24å°æ—¶', '7å¤©', '30å¤©']}}" bindchange="onFilterChange" data-type="timeRange">
      <view class="filter-item">
        <text class="label">æ—¶é—´èŒƒå›´:</text>
        <text class="value">{{filters.timeRange}}</text>
        <text class="icon">â–¼</text>
      </view>
    </picker>
    
    <picker mode="selector" range="{{['å…¨éƒ¨', 'æ…¢API', 'é”™è¯¯API']}}" bindchange="onFilterChange" data-type="apiType">
      <view class="filter-item">
        <text class="label">APIç±»å‹:</text>
        <text class="value">{{filters.apiType}}</text>
        <text class="icon">â–¼</text>
      </view>
    </picker>
    
    <picker mode="selector" range="{{['å…¨éƒ¨', 'çƒ­é—¨é¡µé¢', 'é”™è¯¯é¡µé¢']}}" bindchange="onFilterChange" data-type="pageType">
      <view class="filter-item">
        <text class="label">é¡µé¢ç±»å‹:</text>
        <text class="value">{{filters.pageType}}</text>
        <text class="icon">â–¼</text>
      </view>
    </picker>
  </view>

  <!-- å®æ—¶æ›´æ–°å¼€å…³ -->
  <view class="realtime-toggle">
    <text>å®æ—¶æ›´æ–°</text>
    <switch checked="{{realtimeUpdate}}" bindchange="toggleRealtimeUpdate" color="#007AFF" />
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading">åŠ è½½ä¸­...</view>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view class="content" wx:else>
    <!-- APIç›‘æ§æ¦‚è§ˆ -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">ğŸ“Š APIç›‘æ§æ¦‚è§ˆ</text>
        <text class="section-subtitle">å®æ—¶APIè°ƒç”¨ç»Ÿè®¡</text>
      </view>
      
      <view class="stats-grid">
        <view class="stat-card">
          <view class="stat-value">{{apiMonitorData.summary.totalCalls || 0}}</view>
          <view class="stat-label">æ€»è°ƒç”¨æ¬¡æ•°</view>
        </view>
        <view class="stat-card">
          <view class="stat-value">{{apiMonitorData.summary.avgResponseTime || 0}}ms</view>
          <view class="stat-label">å¹³å‡å“åº”æ—¶é—´</view>
        </view>
        <view class="stat-card">
          <view class="stat-value">{{apiMonitorData.summary.errorRate || '0%'}}</view>
          <view class="stat-label">é”™è¯¯ç‡</view>
        </view>
        <view class="stat-card">
          <view class="stat-value">{{apiMonitorData.realtime.lastMinuteCalls || 0}}</view>
          <view class="stat-label">æœ€è¿‘1åˆ†é’Ÿ</view>
        </view>
      </view>
    </view>

    <!-- åŸ‹ç‚¹æ•°æ®æ¦‚è§ˆ -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">ğŸ“ˆ åŸ‹ç‚¹æ•°æ®æ¦‚è§ˆ</text>
        <text class="section-subtitle">ç”¨æˆ·è¡Œä¸ºå’Œé¡µé¢è®¿é—®ç»Ÿè®¡</text>
      </view>
      
      <view class="stats-grid">
        <view class="stat-card">
          <view class="stat-value">{{analyticsData.summary.dailyEvents || 0}}</view>
          <view class="stat-label">ä»Šæ—¥äº‹ä»¶</view>
        </view>
        <view class="stat-card">
          <view class="stat-value">{{analyticsData.summary.activeSessions || 0}}</view>
          <view class="stat-label">æ´»è·ƒä¼šè¯</view>
        </view>
        <view class="stat-card">
          <view class="stat-value">{{analyticsData.summary.totalPages || 0}}</view>
          <view class="stat-label">è®¿é—®é¡µé¢</view>
        </view>
        <view class="stat-card">
          <view class="stat-value">{{analyticsData.summary.totalErrors || 0}}</view>
          <view class="stat-label">é”™è¯¯æ•°é‡</view>
        </view>
      </view>
    </view>

    <!-- APIæ€§èƒ½å›¾è¡¨ -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">ğŸ“Š APIæ€§èƒ½è¶‹åŠ¿</text>
        <text class="section-subtitle">å“åº”æ—¶é—´å’Œé”™è¯¯ç‡åˆ†æ</text>
      </view>
      
      <view class="chart-container">
        <view class="chart-placeholder">
          <text class="chart-title">APIå“åº”æ—¶é—´åˆ†å¸ƒ</text>
          <view class="chart-data">
            <view class="chart-item" wx:for="{{charts.apiPerformance.categories}}" wx:key="index">
              <text class="api-name">{{item}}</text>
              <text class="response-time">{{charts.apiPerformance.responseTimes[index]}}ms</text>
              <text class="error-rate">{{charts.apiPerformance.errorRates[index]}}%</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- é¡µé¢è®¿é—®ç»Ÿè®¡ -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">ğŸ“± é¡µé¢è®¿é—®ç»Ÿè®¡</text>
        <text class="section-subtitle">çƒ­é—¨é¡µé¢æ’è¡Œ</text>
      </view>
      
      <view class="list-container">
        <view class="list-item" wx:for="{{analyticsData.popularPages}}" wx:key="page" bindtap="viewPageDetail" data-page="{{item.page}}">
          <view class="item-main">
            <text class="item-title">{{item.page}}</text>
            <text class="item-subtitle">è®¿é—®é‡: {{item.views}} | ç”¨æˆ·æ•°: {{item.uniqueUsers}}</text>
          </view>
          <text class="item-arrow">></text>
        </view>
      </view>
    </view>

    <!-- æ…¢APIåˆ—è¡¨ -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">ğŸŒ æ…¢APIåˆ—è¡¨</text>
        <text class="section-subtitle">å“åº”æ—¶é—´è¶…è¿‡2ç§’çš„API</text>
      </view>
      
      <view class="list-container">
        <view class="list-item" wx:for="{{apiMonitorData.slowAPIs}}" wx:key="url" bindtap="viewAPIDetail" data-api="{{item.url}}">
          <view class="item-main">
            <text class="item-title">{{item.url}}</text>
            <text class="item-subtitle">å“åº”æ—¶é—´: {{item.responseTime}}ms | è°ƒç”¨æ¬¡æ•°: {{item.count}}</text>
          </view>
          <text class="item-arrow">></text>
        </view>
      </view>
    </view>

    <!-- é”™è¯¯APIåˆ—è¡¨ -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">âŒ é”™è¯¯APIåˆ—è¡¨</text>
        <text class="section-subtitle">é¢‘ç¹å‡ºé”™çš„API</text>
      </view>
      
      <view class="list-container">
        <view class="list-item" wx:for="{{apiMonitorData.errorAPIs}}" wx:key="url" bindtap="viewAPIDetail" data-api="{{item.url}}">
          <view class="item-main">
            <text class="item-title">{{item.url}}</text>
            <text class="item-subtitle">é”™è¯¯æ¬¡æ•°: {{item.count}} | çŠ¶æ€ç : {{item.statusCode}}</text>
          </view>
          <text class="item-arrow">></text>
        </view>
      </view>
    </view>

    <!-- æœ€è¿‘APIè°ƒç”¨ -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">ğŸ•’ æœ€è¿‘APIè°ƒç”¨</text>
        <text class="section-subtitle">å®æ—¶è°ƒç”¨è®°å½•</text>
      </view>
      
      <view class="list-container">
        <view class="list-item" wx:for="{{apiMonitorData.recentCalls}}" wx:key="id">
          <view class="item-main">
            <text class="item-title">{{item.method}} {{item.url}}</text>
            <text class="item-subtitle">{{item.timestamp}} | {{item.responseTime}}ms | {{item.statusCode}}</text>
          </view>
          <text class="status-badge {{item.success ? 'success' : 'error'}}">
            {{item.success ? 'æˆåŠŸ' : 'å¤±è´¥'}}
          </text>
        </view>
      </view>
    </view>

    <!-- ç”¨æˆ·è¡Œä¸ºç»Ÿè®¡ -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">ğŸ‘¤ ç”¨æˆ·è¡Œä¸ºç»Ÿè®¡</text>
        <text class="section-subtitle">åŠŸèƒ½ä½¿ç”¨é¢‘ç‡</text>
      </view>
      
      <view class="list-container">
        <view class="list-item" wx:for="{{analyticsData.popularFeatures}}" wx:key="feature">
          <view class="item-main">
            <text class="item-title">{{item.feature}}</text>
            <text class="item-subtitle">ä½¿ç”¨æ¬¡æ•°: {{item.uses}} | ç”¨æˆ·æ•°: {{item.uniqueUsers}}</text>
          </view>
          <text class="usage-count">{{item.uses}}</text>
        </view>
      </view>
    </view>
  </view>
</view> 