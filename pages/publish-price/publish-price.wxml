<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <text class="page-title">{{pageMode === 'update' ? 'æ›´æ–°æŠ¥ä»·' : 'å‘å¸ƒæŠ¥ä»·'}}</text>
    <text class="page-subtitle">ä¸ºä¹°å®¶æä¾›æœ€æ–°ä»·æ ¼ä¿¡æ¯</text>
  </view>

  <!-- å¿«é€Ÿæ›´æ–°æ¨¡å¼ -->
  <view class="quick-update-section" wx:if="{{quickUpdateMode}}">
    <view class="quick-update-header">
      <text class="quick-update-title">âš¡ å¿«é€Ÿæ›´æ–°</text>
      <text class="quick-update-desc">ä»·æ ¼æœªå˜ï¼Œä»…æ›´æ–°æ—¶é—´</text>
    </view>
    <button class="quick-update-btn" bindtap="quickUpdate">
      <text class="btn-text">ä»·æ ¼æœªå˜ï¼Œç¡®è®¤æ›´æ–°</text>
    </button>
  </view>

  <!-- æ›´æ–°æé†’ -->
  <view class="update-reminders" wx:if="{{updateReminders.length > 0}}">
    <view class="reminder-header">
      <text class="reminder-title">ğŸ“¢ æ›´æ–°æé†’</text>
    </view>
    <view class="reminder-list">
      <view class="reminder-item" 
            wx:for="{{updateReminders}}" 
            wx:key="id"
            wx:for-item="reminder">
        <view class="reminder-content">
          <text class="reminder-message">{{reminder.message}}</text>
          <text class="reminder-days">{{reminder.daysNotUpdated}}å¤©æœªæ›´æ–°</text>
        </view>
        <button class="reminder-action-btn" 
                bindtap="navigateToUpdate" 
                data-id="{{reminder.id}}">
          ç«‹å³æ›´æ–°
        </button>
      </view>
    </view>
  </view>

  <!-- æ¿€åŠ±æç¤º -->
  <view class="incentive-section">
    <view class="incentive-header">
      <text class="incentive-title">ğŸ’¡ å®Œå–„ä¿¡æ¯è·å¾—æ›´å¤šæ›å…‰</text>
    </view>
    <view class="incentive-list">
      <view class="incentive-item {{incentives.images.completed ? 'completed' : ''}}">
        <view class="incentive-icon">{{incentives.images.icon}}</view>
        <view class="incentive-content">
          <text class="incentive-name">{{incentives.images.title}}</text>
          <text class="incentive-desc">{{incentives.images.desc}}</text>
          <text class="incentive-reward">{{incentives.images.reward}}</text>
        </view>
        <view class="incentive-status">
          <text class="status-icon">{{incentives.images.completed ? 'âœ“' : 'â—‹'}}</text>
        </view>
      </view>
      <view class="incentive-item {{incentives.origin.completed ? 'completed' : ''}}">
        <view class="incentive-icon">{{incentives.origin.icon}}</view>
        <view class="incentive-content">
          <text class="incentive-name">{{incentives.origin.title}}</text>
          <text class="incentive-desc">{{incentives.origin.desc}}</text>
          <text class="incentive-reward">{{incentives.origin.reward}}</text>
        </view>
        <view class="incentive-status">
          <text class="status-icon">{{incentives.origin.completed ? 'âœ“' : 'â—‹'}}</text>
        </view>
      </view>
      <view class="incentive-item {{incentives.process.completed ? 'completed' : ''}}">
        <view class="incentive-icon">{{incentives.process.icon}}</view>
        <view class="incentive-content">
          <text class="incentive-name">{{incentives.process.title}}</text>
          <text class="incentive-desc">{{incentives.process.desc}}</text>
          <text class="incentive-reward">{{incentives.process.reward}}</text>
        </view>
        <view class="incentive-status">
          <text class="status-icon">{{incentives.process.completed ? 'âœ“' : 'â—‹'}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è¡¨å•å†…å®¹ -->
  <view class="form-container">
    <!-- å¿…å¡«é¡¹ -->
    <view class="form-section">
      <view class="section-header">
        <text class="section-title">å¿…å¡«ä¿¡æ¯</text>
        <text class="required-mark">*</text>
      </view>

      <!-- åœ°çº§å¸‚ -->
      <view class="form-item">
        <text class="form-label">åœ°çº§å¸‚</text>
        <view class="city-selector">
          <view class="current-city">
            <text class="city-text">{{formData.city || 'è¯·é€‰æ‹©åŸå¸‚'}}</text>
            <text class="city-arrow">â–¼</text>
          </view>
          <scroll-view class="hot-cities" scroll-x="true">
            <view class="city-item {{formData.city === item ? 'active' : ''}}" 
                  wx:for="{{hotCities}}" 
                  wx:key="*this"
                  wx:for-item="item"
                  bindtap="selectCity" 
                  data-city="{{item}}">
              {{item}}
            </view>
          </scroll-view>
        </view>
        <text class="error-text" wx:if="{{formErrors.city}}">{{formErrors.city}}</text>
      </view>

      <!-- èŒ¶ç±»é€‰æ‹© -->
      <view class="form-item">
        <text class="form-label">èŒ¶ç±»</text>
        <view class="category-grid">
          <view class="category-item {{selectedCategory === item ? 'active' : ''}}" 
                wx:for="{{categoryList}}" 
                wx:key="*this"
                wx:for-item="item"
                bindtap="selectCategory" 
                data-category="{{item}}">
            <text class="category-name">{{item}}</text>
          </view>
        </view>
        <text class="error-text" wx:if="{{formErrors.category}}">{{formErrors.category}}</text>
      </view>

      <!-- å…·ä½“å“ç±» -->
      <view class="form-item" wx:if="{{selectedCategory}}">
        <text class="form-label">å…·ä½“å“ç±»</text>
        <view class="subcategory-grid">
          <view class="subcategory-item {{selectedSubCategory === item ? 'active' : ''}}" 
                wx:for="{{teaCategories[selectedCategory]}}" 
                wx:key="*this"
                wx:for-item="item"
                bindtap="selectSubCategory" 
                data-subcategory="{{item}}">
            <text class="subcategory-name">{{item}}</text>
          </view>
        </view>
        <text class="error-text" wx:if="{{formErrors.subCategory}}">{{formErrors.subCategory}}</text>
      </view>

      <!-- ä»·æ ¼åŒºé—´ -->
      <view class="form-item">
        <text class="form-label">ä»·æ ¼åŒºé—´</text>
        <view class="price-input-group">
          <view class="price-input">
            <input class="input-field" 
                   type="digit" 
                   placeholder="æœ€ä½ä»·" 
                   value="{{formData.priceMin}}"
                   bindinput="onPriceMinInput" />
            <text class="input-unit">{{formData.unit}}</text>
          </view>
          <text class="price-separator">è‡³</text>
          <view class="price-input">
            <input class="input-field" 
                   type="digit" 
                   placeholder="æœ€é«˜ä»·" 
                   value="{{formData.priceMax}}"
                   bindinput="onPriceMaxInput" />
            <text class="input-unit">{{formData.unit}}</text>
          </view>
        </view>
        <text class="error-text" wx:if="{{formErrors.priceMin}}">{{formErrors.priceMin}}</text>
        <text class="error-text" wx:if="{{formErrors.priceMax}}">{{formErrors.priceMax}}</text>
      </view>

      <!-- å•ä½é€‰æ‹© -->
      <view class="form-item">
        <text class="form-label">è®¡é‡å•ä½</text>
        <picker class="unit-picker" 
                range="{{units}}" 
                value="{{units.indexOf(formData.unit)}}"
                bindchange="onUnitChange">
          <view class="picker-display">
            <text class="picker-text">{{formData.unit}}</text>
            <text class="picker-arrow">â–¼</text>
          </view>
        </picker>
      </view>
    </view>

    <!-- é€‰å¡«é¡¹ -->
    <view class="form-section">
      <view class="section-header">
        <text class="section-title">é€‰å¡«ä¿¡æ¯</text>
        <text class="optional-mark">ï¼ˆæå‡æ›å…‰ç‡ï¼‰</text>
      </view>

      <!-- èŒ¶å¶å®æ‹å›¾ -->
      <view class="form-item">
        <text class="form-label">èŒ¶å¶å®æ‹å›¾</text>
        <text class="form-tip">æœ€å¤š3å¼ ï¼Œå»ºè®®ä¸Šä¼ æ¸…æ™°çš„äº§å“å›¾ç‰‡</text>
        <view class="image-upload">
          <view class="image-list">
            <view class="image-item" 
                  wx:for="{{formData.images}}" 
                  wx:key="*this"
                  wx:for-item="image"
                  wx:for-index="index">
              <image class="uploaded-image" 
                     src="{{image}}" 
                     mode="aspectFill"
                     bindtap="previewImage" 
                     data-index="{{index}}"></image>
              <view class="delete-btn" 
                    bindtap="deleteImage" 
                    data-index="{{index}}">
                <text class="delete-icon">Ã—</text>
              </view>
            </view>
            <view class="upload-btn" 
                  wx:if="{{formData.images.length < 3}}"
                  bindtap="chooseImage">
              <text class="upload-icon">+</text>
              <text class="upload-text">ä¸Šä¼ å›¾ç‰‡</text>
            </view>
          </view>
        </view>
      </view>

      <!-- å·¥è‰ºè¯´æ˜ -->
      <view class="form-item">
        <text class="form-label">å·¥è‰ºè¯´æ˜</text>
        <textarea class="textarea-field" 
                  placeholder="è¯·æè¿°èŒ¶å¶çš„åˆ¶ä½œå·¥è‰ºã€ç‰¹ç‚¹ç­‰ï¼ˆé€‰å¡«ï¼‰"
                  value="{{formData.process}}"
                  bindinput="onProcessInput"
                  maxlength="200"></textarea>
        <text class="char-count">{{formData.process.length}}/200</text>
      </view>

      <!-- äº§åœ° -->
      <view class="form-item">
        <text class="form-label">äº§åœ°</text>
        <input class="input-field" 
               placeholder="è¯·è¾“å…¥èŒ¶å¶äº§åœ°ï¼ˆé€‰å¡«ï¼‰"
               value="{{formData.origin}}"
               bindinput="onOriginInput" />
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <button class="reset-btn" bindtap="resetForm">é‡ç½®</button>
    <button class="submit-btn {{submitting ? 'submitting' : ''}}" 
            bindtap="submitPrice"
            disabled="{{submitting}}">
      <text wx:if="{{!submitting}}">{{pageMode === 'update' ? 'æ›´æ–°æŠ¥ä»·' : 'å‘å¸ƒæŠ¥ä»·'}}</text>
      <text wx:else>{{pageMode === 'update' ? 'æ›´æ–°ä¸­...' : 'å‘å¸ƒä¸­...'}}</text>
    </button>
  </view>

  <!-- æäº¤çŠ¶æ€é®ç½© -->
  <view class="loading-mask" wx:if="{{submitting}}">
    <view class="loading-content">
      <view class="loading-icon">â³</view>
      <text class="loading-text">æ­£åœ¨{{pageMode === 'update' ? 'æ›´æ–°' : 'å‘å¸ƒ'}}æŠ¥ä»·...</text>
    </view>
  </view>
</view> 