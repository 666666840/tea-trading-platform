<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-icon">â³</view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- æ±‚è´­ä¿¡æ¯è¯¦æƒ… -->
  <view class="inquiry-detail" wx:if="{{!loading && inquiryInfo}}">
    <!-- æ±‚è´­ä¿¡æ¯å¤´éƒ¨ -->
    <view class="inquiry-header">
      <view class="inquiry-title">
        <text>{{inquiryInfo.title}}</text>
        <view class="inquiry-status {{inquiryInfo.status}}">{{inquiryInfo.statusText}}</view>
      </view>
      <view class="publisher-info">
        <image class="publisher-avatar" src="{{inquiryInfo.publisher.avatar}}" mode="aspectFill"></image>
        <view class="publisher-details">
          <text class="publisher-name">{{inquiryInfo.publisher.nickname}}</text>
          <view class="publisher-verified" wx:if="{{inquiryInfo.publisher.verified}}">âœ“ è®¤è¯ç”¨æˆ·</view>
        </view>
        <view class="publish-time">{{inquiryInfo.publishTime}}</view>
      </view>
    </view>

    <!-- æ±‚è´­ä¿¡æ¯ç»Ÿè®¡ -->
    <view class="inquiry-stats">
      <view class="stat-item">
        <text class="stat-value">{{inquiryInfo.stats.viewCount}}</text>
        <text class="stat-label">æµè§ˆ</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{inquiryInfo.stats.quoteCount}}</text>
        <text class="stat-label">æŠ¥ä»·</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{inquiryInfo.stats.favoriteCount}}</text>
        <text class="stat-label">æ”¶è—</text>
      </view>
    </view>

    <!-- æ±‚è´­ä¿¡æ¯å†…å®¹ -->
    <view class="inquiry-content">
      <view class="content-section">
        <view class="section-title">æ±‚è´­å“ç±»</view>
        <text class="section-value">{{inquiryInfo.category}} - {{inquiryInfo.subCategory}}</text>
      </view>

      <view class="content-section">
        <view class="section-title">æ±‚è´­æ•°é‡</view>
        <text class="section-value">{{inquiryInfo.quantity}} {{inquiryInfo.unit}}</text>
      </view>

      <view class="content-section">
        <view class="section-title">è¦æ±‚æè¿°</view>
        <text class="section-value description">{{inquiryInfo.description}}</text>
      </view>

      <view class="content-section" wx:if="{{inquiryInfo.budgetMin || inquiryInfo.budgetMax}}">
        <view class="section-title">é¢„ç®—èŒƒå›´</view>
        <text class="section-value">{{inquiryInfo.budgetMin || 'ä¸é™'}} - {{inquiryInfo.budgetMax || 'ä¸é™'}} å…ƒ</text>
      </view>

      <view class="content-section" wx:if="{{inquiryInfo.province}}">
        <view class="section-title">æ”¶è´§åœ°åŒº</view>
        <text class="section-value">{{inquiryInfo.province}} {{inquiryInfo.city}} {{inquiryInfo.district}}</text>
      </view>

      <view class="content-section">
        <view class="section-title">æœŸæœ›è”ç³»æ—¶é—´</view>
        <text class="section-value">{{inquiryInfo.contactTime}}</text>
      </view>

      <view class="content-section">
        <view class="section-title">æœ‰æ•ˆæœŸé™</view>
        <text class="section-value">{{inquiryInfo.validDays}}å¤©ï¼ˆ{{inquiryInfo.expireTime}}åˆ°æœŸï¼‰</text>
      </view>

      <!-- é™„ä»¶å±•ç¤º -->
      <view class="content-section" wx:if="{{inquiryInfo.attachments.length > 0}}">
        <view class="section-title">é™„ä»¶å›¾ç‰‡</view>
        <view class="attachment-list">
          <image class="attachment-image" 
                 wx:for="{{inquiryInfo.attachments}}" 
                 wx:key="*this"
                 src="{{item}}" 
                 mode="aspectFill"
                 bindtap="previewAttachment"
                 data-index="{{index}}"></image>
        </view>
      </view>
    </view>

    <!-- è”ç³»ä¿¡æ¯ï¼ˆå•†æˆ·å¯è§ï¼‰ -->
    <view class="contact-section" wx:if="{{userRole === 'merchant'}}">
      <view class="contact-header">
        <text class="contact-title">ä¹°å®¶è”ç³»ä¿¡æ¯</text>
        <text class="contact-tip">è®¤è¯å•†æˆ·å¯è§</text>
      </view>
      
      <view class="contact-info" wx:if="{{showContact}}">
        <view class="contact-item">
          <text class="contact-label">è”ç³»ç”µè¯ï¼š</text>
          <text class="contact-value" bindtap="makePhoneCall">{{inquiryInfo.publisher.contact.phone}}</text>
        </view>
        <view class="contact-item">
          <text class="contact-label">å¾®ä¿¡å·ï¼š</text>
          <text class="contact-value" bindtap="copyWechat">{{inquiryInfo.publisher.contact.wechat}}</text>
        </view>
        <view class="contact-item">
          <text class="contact-label">å¾®ä¿¡äºŒç»´ç ï¼š</text>
          <image class="contact-qrcode" 
                 src="{{inquiryInfo.publisher.contact.qrcode}}" 
                 mode="aspectFit"
                 bindtap="viewQRCode"></image>
        </view>
      </view>
      
      <view class="contact-actions">
        <button class="contact-btn" 
                bindtap="{{showContact ? 'hideContactInfo' : 'showContactInfo'}}">
          {{showContact ? 'éšè—è”ç³»ä¿¡æ¯' : 'æŸ¥çœ‹è”ç³»ä¿¡æ¯'}}
        </button>
        <button class="contact-btn primary" bindtap="contactBuyer">
          è”ç³»ä¹°å®¶
        </button>
      </view>
    </view>

    <!-- ä¹°å®¶æ“ä½œï¼ˆä»…ä¹°å®¶å¯è§ï¼‰ -->
    <view class="buyer-actions" wx:if="{{userRole === 'buyer'}}">
      <button class="action-btn edit-btn" bindtap="editInquiry">ç¼–è¾‘ä¿¡æ¯</button>
      <button class="action-btn close-btn" bindtap="closeInquiry">å…³é—­æ±‚è´­</button>
    </view>

    <!-- åº•éƒ¨æ“ä½œæ  -->
    <view class="bottom-actions">
      <view class="action-item" bindtap="toggleFavorite">
        <text class="action-icon">â¤ï¸</text>
        <text class="action-text">æ”¶è—</text>
      </view>
      <view class="action-item" bindtap="onShareAppMessage">
        <text class="action-icon">ğŸ“¤</text>
        <text class="action-text">åˆ†äº«</text>
      </view>
    </view>
  </view>
</view> 