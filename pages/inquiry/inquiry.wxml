<view class="container">
  <!-- å‘å¸ƒæ±‚è´­æŒ‰é’® -->
  <view class="publish-header">
    <button class="publish-btn" bindtap="publishInquiry">
      <text class="publish-icon">ğŸ“</text>
      <text class="publish-text">å‘å¸ƒæ±‚è´­ä¿¡æ¯</text>
    </button>
  </view>

  <!-- æ±‚è´­ä¿¡æ¯å‘å¸ƒè¡¨å• -->
  <view class="inquiry-form" wx:if="{{!previewMode}}">
    <view class="form-section">
      <view class="section-title">æ±‚è´­å“ç±» <text class="required">*</text></view>
      
      <!-- ä¸€çº§åˆ†ç±»é€‰æ‹© -->
      <view class="category-grid">
        <view class="category-item {{selectedCategory === item ? 'active' : ''}}" 
              wx:for="{{categoryList}}" 
              wx:key="*this"
              wx:for-item="item"
              bindtap="selectCategory" 
              data-category="{{item}}">
          <text class="category-name">{{item}}</text>
        </view>
      </view>

      <!-- å­åˆ†ç±»é€‰æ‹© -->
      <view class="subcategory-grid" wx:if="{{selectedCategory}}">
        <view class="subcategory-item {{selectedSubCategory === item ? 'active' : ''}}" 
              wx:for="{{teaCategories[selectedCategory]}}" 
              wx:key="*this"
              wx:for-item="item"
              bindtap="selectSubCategory" 
              data-subcategory="{{item}}">
          <text class="subcategory-name">{{item}}</text>
        </view>
      </view>

      <view class="error-text" wx:if="{{formErrors.category}}">{{formErrors.category}}</view>
      <view class="error-text" wx:if="{{formErrors.subCategory}}">{{formErrors.subCategory}}</view>
    </view>

    <view class="form-section">
      <view class="section-title">æ±‚è´­æ•°é‡ <text class="required">*</text></view>
      <view class="quantity-row">
        <input class="quantity-input" 
               type="number" 
               placeholder="è¯·è¾“å…¥æ•°é‡" 
               value="{{formData.quantity}}"
               bindinput="onQuantityInput" />
        <picker class="unit-picker" 
                range="{{units}}" 
                bindchange="onUnitChange">
          <view class="unit-text">{{formData.unit}}</view>
        </picker>
      </view>
      <view class="error-text" wx:if="{{formErrors.quantity}}">{{formErrors.quantity}}</view>
    </view>

    <view class="form-section">
      <view class="section-title">è¦æ±‚/è§„æ ¼æè¿° <text class="required">*</text></view>
      <textarea class="description-input" 
                placeholder="è¯·è¯¦ç»†æè¿°å¯¹èŒ¶å¶çš„è¦æ±‚ï¼Œå¦‚ç­‰çº§æ ‡å‡†ã€å¹´ä»½ã€äº§åœ°è¦æ±‚ã€åŒ…è£…è§„æ ¼ã€å·¥è‰ºè¦æ±‚ã€è®¤è¯è¦æ±‚ç­‰ï¼ˆè‡³å°‘10ä¸ªå­—ç¬¦ï¼‰"
                value="{{formData.description}}"
                bindinput="onDescriptionInput"
                maxlength="500"></textarea>
      <view class="char-count">{{formData.description.length}}/500</view>
      <view class="error-text" wx:if="{{formErrors.description}}">{{formErrors.description}}</view>
    </view>

    <view class="form-section">
      <view class="section-title">é¢„ç®—èŒƒå›´ <text class="optional">ï¼ˆä¾›å‚è€ƒï¼‰</text></view>
      <view class="budget-row">
        <input class="budget-input" 
               type="digit" 
               placeholder="æœ€ä½é¢„ç®—" 
               value="{{formData.budgetMin}}"
               bindinput="onBudgetMinInput" />
        <text class="budget-separator">-</text>
        <input class="budget-input" 
               type="digit" 
               placeholder="æœ€é«˜é¢„ç®—" 
               value="{{formData.budgetMax}}"
               bindinput="onBudgetMaxInput" />
        <text class="budget-unit">å…ƒ</text>
      </view>
      <view class="error-text" wx:if="{{formErrors.budget}}">{{formErrors.budget}}</view>
    </view>

    <view class="form-section">
      <view class="section-title">æ”¶è´§åœ°åŒº <text class="optional">ï¼ˆæ¨èå¡«å†™ï¼‰</text></view>
      <view class="location-row">
        <picker class="location-picker" 
                range="{{provinces}}" 
                range-key="name"
                bindchange="onProvinceChange">
          <view class="location-text">{{formData.province || 'é€‰æ‹©çœä»½'}}</view>
        </picker>
        <picker class="location-picker" 
                range="{{currentCities}}" 
                wx:if="{{formData.province}}"
                bindchange="onCityChange">
          <view class="location-text">{{formData.city || 'é€‰æ‹©åŸå¸‚'}}</view>
        </picker>
        <picker class="location-picker" 
                range="{{currentDistricts}}" 
                wx:if="{{formData.city}}"
                bindchange="onDistrictChange">
          <view class="location-text">{{formData.district || 'é€‰æ‹©åŒºå¿'}}</view>
        </picker>
      </view>
    </view>

    <view class="form-section">
      <view class="section-title">æœŸæœ›è”ç³»æ—¶é—´</view>
      <picker class="time-picker" 
              range="{{contactTimes}}" 
              bindchange="onContactTimeChange">
        <view class="time-text">{{formData.contactTime}}</view>
      </picker>
    </view>

    <view class="form-section">
      <view class="section-title">æœ‰æ•ˆæœŸé™</view>
      <picker class="valid-picker" 
              range="{{validDaysOptions}}" 
              bindchange="onValidDaysChange">
        <view class="valid-text">{{formData.validDays}}å¤©</view>
      </picker>
    </view>

    <view class="form-section">
      <view class="section-title">é™„ä»¶ä¸Šä¼  <text class="optional">ï¼ˆå¯é€‰ï¼‰</text></view>
      <view class="attachment-area">
        <view class="attachment-list">
          <view class="attachment-item" 
                wx:for="{{formData.attachments}}" 
                wx:key="*this">
            <image class="attachment-image" 
                   src="{{item}}" 
                   mode="aspectFill"
                   bindtap="previewAttachment"
                   data-index="{{index}}"></image>
            <view class="attachment-delete" 
                  bindtap="deleteAttachment" 
                  data-index="{{index}}">Ã—</view>
          </view>
          <view class="attachment-add" 
                bindtap="chooseAttachment" 
                wx:if="{{formData.attachments.length < 9}}">
            <text class="add-icon">+</text>
            <text class="add-text">æ·»åŠ å›¾ç‰‡</text>
          </view>
        </view>
        <text class="attachment-tip">æœ€å¤šä¸Šä¼ 9å¼ å›¾ç‰‡ï¼Œæ”¯æŒæ ·å“å›¾ç‰‡ã€è§„æ ¼ä¹¦ç­‰</text>
      </view>
    </view>

    <!-- è¡¨å•æ“ä½œæŒ‰é’® -->
    <view class="form-actions">
      <button class="action-btn reset-btn" bindtap="resetForm">é‡ç½®</button>
      <button class="action-btn preview-btn" bindtap="previewInquiry">é¢„è§ˆ</button>
    </view>
  </view>

  <!-- é¢„è§ˆæ¨¡å¼ -->
  <view class="inquiry-preview" wx:if="{{previewMode}}">
    <view class="preview-header">
      <text class="preview-title">æ±‚è´­ä¿¡æ¯é¢„è§ˆ</text>
      <text class="preview-tip">è¯·ç¡®è®¤ä¿¡æ¯æ— è¯¯åæäº¤</text>
    </view>

    <view class="preview-content">
      <view class="preview-item">
        <text class="preview-label">æ±‚è´­å“ç±»ï¼š</text>
        <text class="preview-value">{{formData.category}} - {{formData.subCategory}}</text>
      </view>
      <view class="preview-item">
        <text class="preview-label">æ±‚è´­æ•°é‡ï¼š</text>
        <text class="preview-value">{{formData.quantity}} {{formData.unit}}</text>
      </view>
      <view class="preview-item">
        <text class="preview-label">è¦æ±‚æè¿°ï¼š</text>
        <text class="preview-value">{{formData.description}}</text>
      </view>
      <view class="preview-item" wx:if="{{formData.budgetMin || formData.budgetMax}}">
        <text class="preview-label">é¢„ç®—èŒƒå›´ï¼š</text>
        <text class="preview-value">{{formData.budgetMin || 'ä¸é™'}} - {{formData.budgetMax || 'ä¸é™'}} å…ƒ</text>
      </view>
      <view class="preview-item" wx:if="{{formData.province}}">
        <text class="preview-label">æ”¶è´§åœ°åŒºï¼š</text>
        <text class="preview-value">{{formData.province}} {{formData.city}} {{formData.district}}</text>
      </view>
      <view class="preview-item">
        <text class="preview-label">è”ç³»æ—¶é—´ï¼š</text>
        <text class="preview-value">{{formData.contactTime}}</text>
      </view>
      <view class="preview-item">
        <text class="preview-label">æœ‰æ•ˆæœŸé™ï¼š</text>
        <text class="preview-value">{{formData.validDays}}å¤©</text>
      </view>
      <view class="preview-item" wx:if="{{formData.attachments.length > 0}}">
        <text class="preview-label">é™„ä»¶æ•°é‡ï¼š</text>
        <text class="preview-value">{{formData.attachments.length}}å¼ å›¾ç‰‡</text>
      </view>
    </view>

    <!-- é¢„è§ˆæ“ä½œæŒ‰é’® -->
    <view class="preview-actions">
      <button class="action-btn back-btn" bindtap="backToEdit">è¿”å›ç¼–è¾‘</button>
      <button class="action-btn submit-btn" 
              bindtap="submitInquiry" 
              loading="{{submitting}}"
              disabled="{{submitting}}">
        {{submitting ? 'æäº¤ä¸­...' : 'ç¡®è®¤å‘å¸ƒ'}}
      </button>
    </view>
  </view>

  <!-- æ±‚è´­ä¿¡æ¯åˆ—è¡¨ -->
  <view class="inquiry-list" wx:if="{{!previewMode}}">
    <view class="list-header">
      <text class="list-title">æœ€æ–°æ±‚è´­ä¿¡æ¯</text>
    </view>
    
    <view class="inquiry-item" 
          wx:for="{{inquiryList}}" 
          wx:key="id"
          bindtap="viewInquiryDetail" 
          data-id="{{item.id}}">
      <view class="inquiry-header">
        <text class="inquiry-title">{{item.title}}</text>
        <view class="inquiry-status {{item.status}}">{{item.statusText}}</view>
      </view>
      <text class="inquiry-desc">{{item.description}}</text>
      <text class="inquiry-req">{{item.requirements}}</text>
      <view class="inquiry-footer">
        <view class="user-info">
          <image class="user-avatar" src="{{item.userAvatar}}" mode="aspectFill"></image>
          <text class="user-name">{{item.userName}}</text>
        </view>
        <view class="inquiry-meta">
          <text class="meta-item">{{item.time}}</text>
          <text class="meta-item">æŠ¥ä»· {{item.quoteCount}}</text>
          <text class="meta-item">æµè§ˆ {{item.viewCount}}</text>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{hasMore}}">
      <text bindtap="loadMore">åŠ è½½æ›´å¤š</text>
    </view>
  </view>
</view> 