<!-- 个人中心页面 -->
<view class="profile-page">
  <!-- 顶部登录/注册按钮，仅未登录时显示 -->
  <view class="login-bar" wx:if="{{!isLoggedIn}}">
    <button class="login-btn" open-type="getUserInfo" bindgetuserinfo="onWxLogin">微信一键登录</button>
  </view>

  <!-- 顶部资料区 -->
  <view class="profile-header">
    <view class="header-bg"></view>
    
    <!-- 用户基本信息 -->
    <view class="user-info-section">
      <!-- 头像管理 -->
      <view class="avatar-section" bindtap="onAvatarTap">
        <image 
          class="user-avatar" 
          src="{{userInfo.avatar}}" 
          mode="aspectFill"
        ></image>
        <view class="avatar-edit-icon">📷</view>
      </view>
      
      <!-- 用户详情 -->
      <view class="user-details">
        <!-- 名称显示 -->
        <view class="name-section" bindtap="onNameTap">
          <text class="user-name">{{userInfo.name}}</text>
          <view class="edit-icon">✏️</view>
        </view>
        
        <!-- 用户ID -->
        <view class="user-id-section" bindtap="onUserIdTap">
          <text class="user-id">ID: {{userInfo.userId}}</text>
          <view class="copy-icon">📋</view>
        </view>
      </view>
    </view>
    
    <!-- 认证状态 -->
    <view class="auth-status">
      <!-- 微信绑定 -->
      <view class="auth-item" bindtap="onWechatBindTap">
        <view class="auth-icon {{userInfo.wechatBound ? 'bound' : 'unbound'}}">
          {{userInfo.wechatBound ? '✅' : '❌'}}
        </view>
        <text class="auth-text">微信绑定</text>
        <text class="auth-status-text {{userInfo.wechatBound ? 'bound' : 'unbound'}}">
          {{userInfo.wechatBound ? '已绑定' : '未绑定'}}
        </text>
      </view>
      
      <!-- 实名认证 -->
      <view class="auth-item" bindtap="onRealNameVerifyTap">
        <view class="auth-icon {{userInfo.realNameVerified ? 'bound' : 'unbound'}}">
          {{userInfo.realNameVerified ? '✅' : '❌'}}
        </view>
        <text class="auth-text">实名认证</text>
        <text class="auth-status-text {{userInfo.realNameVerified ? 'bound' : 'unbound'}}">
          {{userInfo.realNameVerified ? '已认证' : '去认证'}}
        </text>
      </view>
    </view>
  </view>

  <!-- 核心功能区域 -->
  <view class="core-functions">
    <!-- 店铺管理 -->
    <view class="function-section">
      <view class="section-title">
        <text class="title-text">店铺管理</text>
      </view>
      
      <view class="function-grid">
        <!-- 创建店铺 -->
        <view class="function-item" bindtap="onCreateShopTap">
          <view class="function-icon">🏪</view>
          <text class="function-text">{{shopInfo.hasShop ? '店铺设置' : '创建店铺'}}</text>
        </view>
        
        <!-- 我的店铺 -->
        <view class="function-item" bindtap="onMyShopTap" wx:if="{{shopInfo.hasShop}}">
          <view class="function-icon">📊</view>
          <text class="function-text">我的店铺</text>
        </view>
      </view>
      
      <!-- 店铺数据看板 -->
      <view class="shop-stats" wx:if="{{shopInfo.hasShop}}">
        <view class="stats-title">数据看板</view>
        <view class="stats-grid">
          <view class="stat-item">
            <text class="stat-number">{{shopStats.views}}</text>
            <text class="stat-label">浏览量</text>
          </view>
          <view class="stat-item">
            <text class="stat-number">{{shopStats.contactUnlocks}}</text>
            <text class="stat-label">联系方式解锁量</text>
          </view>
          <view class="stat-item">
            <text class="stat-number">{{shopStats.conversionRate}}%</text>
            <text class="stat-label">线索转化率</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 内容管理 -->
    <view class="function-section">
      <view class="section-title">
        <text class="title-text">内容管理</text>
      </view>
      
      <view class="function-grid">
        <!-- 我的收藏 -->
        <view class="function-item" bindtap="onFavoritesTap">
          <view class="function-icon">❤️</view>
          <text class="function-text">我的收藏</text>
        </view>
        
        <!-- 浏览记录 -->
        <view class="function-item" bindtap="onViewHistoryTap">
          <view class="function-icon">📖</view>
          <text class="function-text">浏览记录</text>
        </view>
      </view>
    </view>



    <!-- 协议入口 -->
    <view class="function-section">
      <view class="section-title">
        <text class="title-text">协议与帮助</text>
      </view>
      
      <view class="agreement-list">
        <view 
          class="agreement-item" 
          bindtap="onAgreementTap" 
          data-type="user"
        >
          <text class="agreement-text">用户协议</text>
          <view class="arrow-icon">></view>
        </view>
        
        <view 
          class="agreement-item" 
          bindtap="onAgreementTap" 
          data-type="privacy"
        >
          <text class="agreement-text">隐私政策</text>
          <view class="arrow-icon">></view>
        </view>
        
        <view 
          class="agreement-item" 
          bindtap="onAgreementTap" 
          data-type="disclaimer"
        >
          <text class="agreement-text">免责声明</text>
          <view class="arrow-icon">></view>
        </view>
        
        <!-- 版本信息 -->
        <view 
          class="agreement-item" 
          bindtap="onVersionTap"
        >
          <text class="agreement-text">版本信息 v{{version}}</text>
          <view class="arrow-icon">></view>
        </view>
      </view>
    </view>
  </view>

  <!-- 管理功能区域 -->
  <view class="admin-section" wx:if="{{isAdmin}}">
    <view class="section-title">管理功能</view>
    <view class="admin-options">
      <view class="admin-option" bindtap="goToAdmin">
        <text class="option-icon">📊</text>
        <text class="option-text">数据管理后台</text>
        <text class="option-arrow">></text>
      </view>
    </view>
  </view>

  <!-- 退出登录 -->
  <view class="logout-section" wx:if="{{userInfo.name !== '未登录'}}">
    <button class="logout-btn" bindtap="logout">退出登录</button>
  </view>
</view> 