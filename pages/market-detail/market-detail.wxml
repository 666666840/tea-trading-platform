<view class="container">
  <!-- å…¥é©»æŒ‰é’® - å§‹ç»ˆæ˜¾ç¤º -->
  <view class="join-market-section">
    <button class="join-market-btn" bindtap="showJoinForm">
      <text class="join-icon">ğŸª</text>
      <text class="join-text">ç”³è¯·å…¥é©»æ­¤å¸‚åœº</text>
    </button>
    <view class="join-actions">
      <text class="join-tip">å·²æœ‰{{marketInfo.merchantCount || 0}}å®¶å•†æˆ·å…¥é©»</text>
      <text class="guide-link" bindtap="viewJoinGuide">æŸ¥çœ‹å…¥é©»æŒ‡å—</text>
    </view>
  </view>

  <!-- å¸‚åœºä¿¡æ¯å¤´éƒ¨ -->
  <view class="market-header" wx:if="{{marketInfo}}">
    <!-- è°ƒè¯•ä¿¡æ¯ -->
    <view class="debug-info" style="background: #f0f0f0; padding: 10rpx; margin-bottom: 10rpx; font-size: 24rpx; color: #666;">
      è°ƒè¯•ä¿¡æ¯: marketId={{marketId}}, marketInfoå­˜åœ¨={{marketInfo ? 'æ˜¯' : 'å¦'}}
    </view>
    
    <view class="market-basic">
      <view class="market-title">
        <text class="market-name">{{marketInfo.name}}</text>
        <view class="market-level">{{marketInfo.level}}</view>
      </view>
      <text class="market-location">{{marketInfo.location}}</text>
      <text class="market-description">{{marketInfo.description}}</text>
    </view>
    
    <view class="market-stats">
      <view class="stat-item">
        <text class="stat-value">{{marketInfo.merchantCount}}</text>
        <text class="stat-label">å…¥é©»å•†æˆ·</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{marketInfo.specialties.length}}</text>
        <text class="stat-label">ä¸»è¥å“ç±»</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{marketInfo.established}}</text>
        <text class="stat-label">æˆç«‹æ—¶é—´</text>
      </view>
    </view>
    
    <view class="market-specialties">
      <text class="specialty-tag" wx:for="{{marketInfo.specialties}}" wx:key="*this">{{item}}</text>
    </view>
  </view>

  <!-- å¦‚æœmarketInfoä¸å­˜åœ¨ï¼Œæ˜¾ç¤ºåŠ è½½çŠ¶æ€å’Œå…¥é©»æŒ‰é’® -->
  <view class="market-header" wx:if="{{!marketInfo}}">
    <view class="loading-market">
      <text class="loading-text">æ­£åœ¨åŠ è½½å¸‚åœºä¿¡æ¯...</text>
    </view>
  </view>

  <!-- å¸‚åœºè¯¦ç»†ä¿¡æ¯ -->
  <view class="market-details" wx:if="{{marketInfo}}">
    <view class="detail-section">
      <view class="section-title">åŸºæœ¬ä¿¡æ¯</view>
      <view class="detail-item">
        <text class="detail-label">è¯¦ç»†åœ°å€ï¼š</text>
        <text class="detail-value">{{marketInfo.address}}</text>
      </view>
      <view class="detail-item">
        <text class="detail-label">è”ç³»ç”µè¯ï¼š</text>
        <text class="detail-value">{{marketInfo.contact}}</text>
      </view>
      <view class="detail-item">
        <text class="detail-label">è¥ä¸šæ—¶é—´ï¼š</text>
        <text class="detail-value">{{marketInfo.businessHours}}</text>
      </view>
    </view>
    
    <view class="detail-section">
      <view class="section-title">é…å¥—è®¾æ–½</view>
      <view class="facilities">
        <text class="facility-tag" wx:for="{{marketInfo.facilities}}" wx:key="*this">{{item}}</text>
      </view>
    </view>
  </view>

  <!-- å•†æˆ·æœç´¢å’Œç­›é€‰ -->
  <view class="merchant-controls">
    <view class="search-bar">
      <view class="search-input">
        <text class="search-icon">ğŸ”</text>
        <input placeholder="æœç´¢å•†æˆ·åç§°æˆ–äº§å“" bindinput="onSearchInput" />
      </view>
    </view>
    
    <view class="filter-bar">
      <view class="filter-item {{filterType === 'all' ? 'active' : ''}}" 
            bindtap="setFilter" data-type="all">
        å…¨éƒ¨
      </view>
      <view class="filter-item {{filterType === 'active' ? 'active' : ''}}" 
            bindtap="setFilter" data-type="active">
        æ´»è·ƒå•†æˆ·
      </view>
      <view class="filter-item {{filterType === 'verified' ? 'active' : ''}}" 
            bindtap="setFilter" data-type="verified">
        è®¤è¯å•†æˆ·
      </view>
    </view>
    
    <view class="sort-bar">
      <view class="sort-item {{sortType === 'comprehensive' ? 'active' : ''}}" 
            bindtap="setSortType" data-type="comprehensive">
        ç»¼åˆæ¨è
      </view>
      <view class="sort-item {{sortType === 'newest' ? 'active' : ''}}" 
            bindtap="setSortType" data-type="newest">
        æœ€æ–°å…¥é©»
      </view>
      <view class="sort-item {{sortType === 'activity' ? 'active' : ''}}" 
            bindtap="setSortType" data-type="activity">
        æ´»è·ƒåº¦
      </view>
    </view>
  </view>

  <!-- å•†æˆ·åˆ—è¡¨ -->
  <view class="merchant-list" wx:if="{{filteredMerchants.length > 0}}">
    <view class="merchant-item" 
          wx:for="{{filteredMerchants}}" 
          wx:key="id"
          bindtap="viewMerchantDetail" 
          data-id="{{item.id}}">
      
      <view class="merchant-header">
        <image class="merchant-logo" src="{{item.logo}}" mode="aspectFill"></image>
        <view class="merchant-info">
          <view class="merchant-name">
            <text>{{item.name}}</text>
            <view class="verification-badge" wx:if="{{item.verified}}">âœ“</view>
          </view>
          <view class="merchant-products">
            <text class="product-tag" wx:for="{{item.mainProducts}}" wx:key="*this">{{item}}</text>
          </view>
        </view>
        <view class="merchant-status">
          <view class="activity-status {{item.activityLevel}}">
            {{item.activityText}}
          </view>
          <view class="rating">
            â­ {{item.rating}}
          </view>
        </view>
      </view>
      
      <view class="merchant-content">
        <text class="merchant-description">{{item.description}}</text>
        <view class="merchant-meta">
          <text class="meta-item">å“åº”æ—¶é—´ï¼š{{item.responseTime}}</text>
          <text class="meta-item">æœ€åæ´»è·ƒï¼š{{item.lastActive}}</text>
        </view>
      </view>
      
      <view class="merchant-actions">
        <button class="action-btn contact-btn" 
                bindtap="contactMerchant" 
                data-merchant="{{item}}"
                catchtap="true">
          è”ç³»å•†æˆ·
        </button>
        <button class="action-btn detail-btn" 
                bindtap="viewMerchantDetail" 
                data-id="{{item.id}}"
                catchtap="true">
          æŸ¥çœ‹è¯¦æƒ…
        </button>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{filteredMerchants.length === 0 && !loading}}">
    <view class="empty-icon">ğŸª</view>
    <text class="empty-text">æš‚æ— å•†æˆ·ä¿¡æ¯</text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-icon">â³</view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{hasMore && !loading && filteredMerchants.length > 0}}">
    <text bindtap="loadMore">åŠ è½½æ›´å¤šå•†æˆ·</text>
  </view>

  <!-- å…¥é©»ç”³è¯·å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showJoinModal}}" bindtap="closeJoinForm">
    <view class="modal-content join-form" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">ç”³è¯·å…¥é©»{{marketInfo.name}}</text>
        <text class="modal-close" bindtap="closeJoinForm">Ã—</text>
      </view>
      
      <view class="modal-body">
        <!-- å…¥é©»æµç¨‹è¯´æ˜ -->
        <view class="join-process">
          <view class="process-step">
            <text class="step-number">1</text>
            <text class="step-text">å¡«å†™åŸºæœ¬ä¿¡æ¯</text>
          </view>
          <view class="process-step">
            <text class="step-number">2</text>
            <text class="step-text">ä¸Šä¼ èµ„è´¨è¯æ˜</text>
          </view>
          <view class="process-step">
            <text class="step-number">3</text>
            <text class="step-text">ç­‰å¾…å®¡æ ¸é€šè¿‡</text>
          </view>
        </view>

        <!-- å…¥é©»è¡¨å• -->
        <view class="form-section">
          <text class="form-label">å•†æˆ·ä¿¡æ¯</text>
          <input class="form-input" 
                 placeholder="å•†æˆ·åç§°" 
                 value="{{joinForm.merchantName}}"
                 data-field="merchantName"
                 bindinput="inputJoinForm" />
          <input class="form-input" 
                 placeholder="è”ç³»äººå§“å" 
                 value="{{joinForm.contactName}}"
                 data-field="contactName"
                 bindinput="inputJoinForm" />
          <input class="form-input" 
                 placeholder="è”ç³»ç”µè¯" 
                 value="{{joinForm.phone}}"
                 data-field="phone"
                 bindinput="inputJoinForm" />
          <input class="form-input" 
                 placeholder="å¾®ä¿¡å·" 
                 value="{{joinForm.wechat}}"
                 data-field="wechat"
                 bindinput="inputJoinForm" />
        </view>

        <view class="form-section">
          <text class="form-label">ç»è¥ä¿¡æ¯</text>
          <picker class="form-picker"
                  mode="selector"
                  range="{{businessTypes}}"
                  bindchange="onBusinessTypeChange">
            <view class="picker-text">
              {{joinForm.businessType || 'è¯·é€‰æ‹©ç»è¥ç±»å‹'}}
            </view>
          </picker>
          <picker class="form-picker"
                  mode="selector"
                  range="{{mainCategories}}"
                  bindchange="onCategoryChange">
            <view class="picker-text">
              {{joinForm.mainCategory || 'è¯·é€‰æ‹©ä¸»è¥å“ç±»'}}
            </view>
          </picker>
          <textarea class="form-textarea" 
                    placeholder="ç»è¥æè¿°ï¼ˆé€‰å¡«ï¼‰"
                    value="{{joinForm.description}}"
                    data-field="description"
                    bindinput="inputJoinForm"></textarea>
        </view>

        <view class="form-section">
          <text class="form-label">èµ„è´¨è¯æ˜</text>
          <view class="upload-section">
            <view class="upload-item" bindtap="uploadLicense">
              <text class="upload-icon">ğŸ“„</text>
              <text class="upload-text">è¥ä¸šæ‰§ç…§</text>
              <text class="upload-status" wx:if="{{joinForm.license}}">âœ“ å·²ä¸Šä¼ </text>
            </view>
            <view class="upload-item" bindtap="uploadIDCard">
              <text class="upload-icon">ğŸ†”</text>
              <text class="upload-text">èº«ä»½è¯</text>
              <text class="upload-status" wx:if="{{joinForm.idCard}}">âœ“ å·²ä¸Šä¼ </text>
            </view>
          </view>
        </view>

        <view class="form-tips">
          <text class="tip-text">â€¢ è¯·ç¡®ä¿ä¿¡æ¯çœŸå®æœ‰æ•ˆ</text>
          <text class="tip-text">â€¢ å¹³å°å°†åœ¨3ä¸ªå·¥ä½œæ—¥å†…å®¡æ ¸</text>
          <text class="tip-text">â€¢ å®¡æ ¸é€šè¿‡åå¯å‘å¸ƒå•†å“ä¿¡æ¯</text>
          <text class="tip-text">â€¢ å…¥é©»è´¹ç”¨ï¼š{{marketInfo.level === 'å›½å®¶çº§' ? '500å…ƒ/å¹´' : '300å…ƒ/å¹´'}}</text>
        </view>
        
        <view class="form-actions">
          <button class="cancel-btn" bindtap="closeJoinForm">å–æ¶ˆ</button>
          <button class="submit-btn" bindtap="submitJoinForm">æäº¤ç”³è¯·</button>
        </view>
      </view>
    </view>
  </view>
</view> 