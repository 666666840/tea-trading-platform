# å†…å­˜ä¸è¶³åº”æ€¥å¤„ç†æŒ‡å—

## ğŸš¨ ç´§æ€¥æƒ…å†µè¯†åˆ«

### å†…å­˜ä¸è¶³çš„å…¸å‹ç—‡çŠ¶ï¼š
- æœåŠ¡å™¨å“åº”ææ…¢æˆ–æ— å“åº”
- çˆ¬è™«ä»»åŠ¡é¢‘ç¹å¤±è´¥
- å°ç¨‹åºåŠ è½½è¶…æ—¶
- ç³»ç»Ÿè‡ªåŠ¨é‡å¯
- å‡ºç° "Out of Memory" é”™è¯¯

### å¿«é€Ÿæ£€æŸ¥å‘½ä»¤ï¼š
```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ
free -h

# æŸ¥çœ‹è¿›ç¨‹å†…å­˜å ç”¨
ps aux --sort=-%mem | head -10

# æŸ¥çœ‹ç³»ç»Ÿè´Ÿè½½
top

# æŸ¥çœ‹Node.jsè¿›ç¨‹
ps aux | grep node
```

## ğŸ†˜ ç«‹å³åº”æ€¥æªæ–½

### 1. é‡Šæ”¾å†…å­˜ï¼ˆç«‹å³å¯æ‰§è¡Œï¼‰
```bash
# æ¸…ç†ç¼“å­˜
sudo sync && echo 3 | sudo tee /proc/sys/vm/drop_caches

# æ¸…ç†swap
sudo swapoff -a && sudo swapon -a

# é‡å¯Node.jsæœåŠ¡
pkill -f "smart-tea-crawler"
sleep 5
node smart-tea-crawler-optimized.js &
```

### 2. ä¸´æ—¶é™ä½æœåŠ¡è´Ÿè½½
```bash
# åœæ­¢éå¿…è¦æœåŠ¡
sudo systemctl stop nginx  # å¦‚æœä¸éœ€è¦webæœåŠ¡
sudo systemctl stop mysql  # å¦‚æœä¸éœ€è¦æ•°æ®åº“

# é™ä½Node.jså†…å­˜é™åˆ¶
export NODE_OPTIONS="--max-old-space-size=512"
```

### 3. æ¸…ç†æ—¥å¿—æ–‡ä»¶
```bash
# æ¸…ç†å¤§æ—¥å¿—æ–‡ä»¶
find . -name "*.log" -size +10M -delete
find . -name "crawler.log" -exec truncate -s 1M {} \;

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶
rm -rf /tmp/*
```

## ğŸ”§ ä¸­æœŸä¼˜åŒ–æ–¹æ¡ˆ

### 1. ä½¿ç”¨ä¼˜åŒ–ç‰ˆçˆ¬è™«
```bash
# åœæ­¢åŸç‰ˆçˆ¬è™«
pkill -f "smart-tea-crawler.js"

# å¯åŠ¨ä¼˜åŒ–ç‰ˆ
node smart-tea-crawler-optimized.js &
```

### 2. å¯ç”¨å†…å­˜ç›‘æ§
```bash
# å¯åŠ¨å†…å­˜ç›‘æ§
node memory-monitor.js &

# è®¾ç½®ç›‘æ§é—´éš”ï¼ˆæ¯30ç§’æ£€æŸ¥ä¸€æ¬¡ï¼‰
node -e "
const monitor = require('./memory-monitor');
monitor.startMonitoring(30000);
"
```

### 3. é…ç½®ç³»ç»Ÿä¼˜åŒ–
```bash
# ç¼–è¾‘ç³»ç»Ÿé…ç½®
sudo nano /etc/sysctl.conf

# æ·»åŠ ä»¥ä¸‹é…ç½®
vm.swappiness=10
vm.vfs_cache_pressure=50
vm.dirty_ratio=15
vm.dirty_background_ratio=5

# åº”ç”¨é…ç½®
sudo sysctl -p
```

## ğŸ“ˆ é•¿æœŸè§£å†³æ–¹æ¡ˆ

### 1. å‡çº§æœåŠ¡å™¨é…ç½®
**æ¨èé…ç½®å‡çº§è·¯å¾„ï¼š**
- å½“å‰ï¼š2æ ¸2G
- çŸ­æœŸï¼š2æ ¸4Gï¼ˆå¢åŠ å†…å­˜ï¼‰
- ä¸­æœŸï¼š4æ ¸4Gï¼ˆå¢åŠ CPUå’Œå†…å­˜ï¼‰
- é•¿æœŸï¼š4æ ¸8Gï¼ˆå®Œæ•´å‡çº§ï¼‰

### 2. æ¶æ„ä¼˜åŒ–
```javascript
// ä½¿ç”¨æµå¼å¤„ç†æ›¿ä»£å†…å­˜åŠ è½½
const fs = require('fs');
const readline = require('readline');

// åˆ†æ‰¹å¤„ç†æ•°æ®
const batchSize = 100;
let batch = [];

// ä½¿ç”¨ç¼“å­˜å‡å°‘é‡å¤è®¡ç®—
const cache = new Map();
```

### 3. æ•°æ®åº“ä¼˜åŒ–
```sql
-- æ·»åŠ ç´¢å¼•
CREATE INDEX idx_articles_date ON articles(pub_date);
CREATE INDEX idx_articles_category ON articles(category);

-- å®šæœŸæ¸…ç†æ—§æ•°æ®
DELETE FROM articles WHERE pub_date < DATE_SUB(NOW(), INTERVAL 30 DAY);
```

## ğŸ› ï¸ é¢„é˜²æªæ–½

### 1. è®¾ç½®ç›‘æ§å‘Šè­¦
```bash
# åˆ›å»ºç›‘æ§è„šæœ¬
cat > /usr/local/bin/memory-alert.sh << 'EOF'
#!/bin/bash
MEM_USAGE=$(free | awk 'NR==2{printf "%.0f", $3*100/$2}')
if [ $MEM_USAGE -gt 80 ]; then
    echo "å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: ${MEM_USAGE}%" | mail -s "æœåŠ¡å™¨å‘Šè­¦" admin@example.com
fi
EOF

chmod +x /usr/local/bin/memory-alert.sh

# æ·»åŠ åˆ°crontab
echo "*/5 * * * * /usr/local/bin/memory-alert.sh" | crontab -
```

### 2. å®šæœŸç»´æŠ¤
```bash
# åˆ›å»ºç»´æŠ¤è„šæœ¬
cat > /usr/local/bin/weekly-maintenance.sh << 'EOF'
#!/bin/bash
# æ¸…ç†æ—¥å¿—
find /var/log -name "*.log" -size +10M -delete
# æ¸…ç†ä¸´æ—¶æ–‡ä»¶
rm -rf /tmp/*
# é‡å¯æœåŠ¡
systemctl restart nginx
systemctl restart nodejs
EOF

chmod +x /usr/local/bin/weekly-maintenance.sh

# æ¯å‘¨æ—¥å‡Œæ™¨2ç‚¹æ‰§è¡Œ
echo "0 2 * * 0 /usr/local/bin/weekly-maintenance.sh" | crontab -
```

### 3. å¤‡ä»½ç­–ç•¥
```bash
# åˆ›å»ºè‡ªåŠ¨å¤‡ä»½è„šæœ¬
cat > /usr/local/bin/backup.sh << 'EOF'
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
tar -czf /backup/tea-platform_$DATE.tar.gz /opt/tea-platform
# ä¿ç•™æœ€è¿‘7å¤©çš„å¤‡ä»½
find /backup -name "tea-platform_*.tar.gz" -mtime +7 -delete
EOF

chmod +x /usr/local/bin/backup.sh

# æ¯å¤©å‡Œæ™¨3ç‚¹å¤‡ä»½
echo "0 3 * * * /usr/local/bin/backup.sh" | crontab -
```

## ğŸ“ è”ç³»æ”¯æŒ

### ç´§æ€¥è”ç³»æ–¹å¼ï¼š
- **æŠ€æœ¯æ”¯æŒ**ï¼šadmin@tea-platform.com
- **æœåŠ¡å™¨æä¾›å•†**ï¼šè…¾è®¯äº‘å®¢æœ
- **æ–‡æ¡£åœ°å€**ï¼šhttps://github.com/tea-platform/docs

### éœ€è¦æä¾›çš„ä¿¡æ¯ï¼š
1. æœåŠ¡å™¨IPåœ°å€
2. é”™è¯¯æ—¥å¿—å†…å®¹
3. å†…å­˜ä½¿ç”¨æˆªå›¾
4. ç³»ç»Ÿè´Ÿè½½æƒ…å†µ
5. æœ€è¿‘çš„æ“ä½œè®°å½•

## âœ… æ£€æŸ¥æ¸…å•

### åº”æ€¥å¤„ç†å®Œæˆæ£€æŸ¥ï¼š
- [ ] å†…å­˜ä½¿ç”¨ç‡é™è‡³80%ä»¥ä¸‹
- [ ] æœåŠ¡æ­£å¸¸å“åº”
- [ ] çˆ¬è™«ä»»åŠ¡æ­£å¸¸è¿è¡Œ
- [ ] æ—¥å¿—æ–‡ä»¶å·²æ¸…ç†
- [ ] ç›‘æ§ç³»ç»Ÿå·²å¯åŠ¨
- [ ] å¤‡ä»½å·²å®Œæˆ

### é•¿æœŸä¼˜åŒ–æ£€æŸ¥ï¼š
- [ ] ä¼˜åŒ–ç‰ˆçˆ¬è™«å·²éƒ¨ç½²
- [ ] ç³»ç»Ÿé…ç½®å·²ä¼˜åŒ–
- [ ] ç›‘æ§å‘Šè­¦å·²è®¾ç½®
- [ ] ç»´æŠ¤è®¡åˆ’å·²åˆ¶å®š
- [ ] å‡çº§æ–¹æ¡ˆå·²è¯„ä¼°

---

**è®°ä½ï¼šé¢„é˜²èƒœäºæ²»ç–—ï¼Œå®šæœŸç›‘æ§å’Œä¼˜åŒ–æ˜¯é¿å…å†…å­˜ä¸è¶³çš„æœ€ä½³æ–¹æ³•ï¼** 