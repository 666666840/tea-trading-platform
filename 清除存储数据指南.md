# 清除存储数据指南

## 问题说明

您遇到的 `paymentSettings` 数据仍然显示在 Storage 中的问题，是因为：

1. **本地存储的持久性**：微信小程序的本地存储数据会一直保留，直到被主动清除
2. **代码删除 ≠ 数据删除**：删除代码文件不会自动清除已经存储的数据
3. **初始化机制**：`payment-manager.js` 在初始化时会检查并创建默认的 `paymentSettings` 数据

## 解决方案

### 方法1：使用开发者工具界面（推荐）

1. **打开简单测试页面**：
   - 在小程序中导航到 `pages/simple-test` 页面
   - 或者直接访问：`/pages/simple-test/simple-test`

2. **查看当前存储数据**：
   - 页面会显示当前所有存储的键
   - 确认 `paymentSettings` 是否存在

3. **选择清除方式**：
   - **清除 paymentSettings**：只清除支付设置数据
   - **清除支付相关数据**：清除所有支付相关的存储数据
   - **清除所有数据**：清除所有本地存储数据（谨慎使用）

### 方法2：使用控制台命令（快速）

1. **打开开发者工具控制台**：
   - 在微信开发者工具中，点击 "调试器" 标签
   - 选择 "Console" 子标签

2. **复制粘贴以下代码**：
```javascript
// 清除 paymentSettings
wx.removeStorageSync('paymentSettings')
console.log('paymentSettings 已清除')
```

3. **或者使用完整脚本**：
```javascript
// 清除所有支付相关数据
const keys = ['paymentSettings', 'paymentOrders', 'paymentRecords', 'userWallet', 'refunds']
keys.forEach(key => {
  try {
    wx.removeStorageSync(key)
    console.log(`${key} 已清除`)
  } catch (error) {
    console.log(`${key} 清除失败:`, error)
  }
})
```

### 方法3：使用快速清除脚本

1. **加载脚本**：
   - 在控制台中执行：`require('./utils/quick-clear.js')`

2. **使用命令**：
   - `clearPaymentSettings()` - 清除 paymentSettings
   - `clearAllPaymentData()` - 清除所有支付相关数据
   - `listStorageKeys()` - 查看所有存储的键
   - `clearAllStorage()` - 清除所有存储数据

## 验证清除结果

清除后，您可以通过以下方式验证：

1. **在开发者工具中**：
   - 刷新 Storage 标签页
   - 确认 `paymentSettings` 已消失

2. **在控制台中**：
   - 执行 `wx.getStorageSync('paymentSettings')`
   - 应该返回 `undefined`

3. **在简单测试页面**：
   - 点击 "刷新" 按钮
   - 查看存储键列表是否更新

## 预防措施

为了避免将来再次出现类似问题：

1. **在删除功能时同时清除数据**：
   ```javascript
   // 删除功能时同时清除相关数据
   wx.removeStorageSync('paymentSettings')
   ```

2. **使用版本控制**：
   ```javascript
   // 在应用启动时检查版本，清除旧版本数据
   const currentVersion = '1.0.0'
   const storedVersion = wx.getStorageSync('appVersion')
   
   if (storedVersion !== currentVersion) {
     // 清除旧版本数据
     wx.clearStorageSync()
     wx.setStorageSync('appVersion', currentVersion)
   }
   ```

3. **定期清理**：
   ```javascript
   // 定期清理过期数据
   function cleanupExpiredData() {
     const now = Date.now()
     const keys = wx.getStorageInfoSync().keys
     
     keys.forEach(key => {
       const data = wx.getStorageSync(key)
       if (data && data.expireTime && now > data.expireTime) {
         wx.removeStorageSync(key)
       }
     })
   }
   ```

## 注意事项

⚠️ **重要提醒**：
- 清除数据是不可逆操作，请确保您真的需要清除这些数据
- 建议先备份重要数据
- 清除所有数据会影响用户体验，请谨慎操作
- 在生产环境中，建议提供数据导出功能

## 相关文件

- `utils/clear-storage.js` - 存储数据管理工具
- `utils/quick-clear.js` - 快速清除脚本
- `pages/simple-test/` - 存储数据管理页面
- `utils/payment-manager.js` - 支付管理器（创建 paymentSettings 的源头）
