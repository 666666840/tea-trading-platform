# ğŸ—ï¸ ç‹¬ç«‹ç®¡ç†åå°éƒ¨ç½²æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—ç”¨äºéƒ¨ç½²å®Œå…¨ç‹¬ç«‹çš„èŒ¶å¶å¹³å°ç®¡ç†åå°ç³»ç»Ÿã€‚ç®¡ç†åå°ä¸å°ç¨‹åºå®Œå…¨åˆ†ç¦»ï¼Œæ— ä»»ä½•è·³è½¬é€”å¾„ï¼Œç¡®ä¿æœ€å¤§å®‰å…¨æ€§ã€‚

## ğŸ¯ ç³»ç»Ÿæ¶æ„

### åˆ†ç¦»è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   èŒ¶å¶å°ç¨‹åº     â”‚    â”‚   ç®¡ç†åå°ç³»ç»Ÿ   â”‚
â”‚                 â”‚    â”‚                 â”‚
â”‚ - ç”¨æˆ·ç«¯åŠŸèƒ½     â”‚    â”‚ - ç®¡ç†å‘˜åŠŸèƒ½    â”‚
â”‚ - å•†æˆ·ç«¯åŠŸèƒ½     â”‚    â”‚ - æ•°æ®ç®¡ç†      â”‚
â”‚ - å†…å®¹å±•ç¤º       â”‚    â”‚ - ç³»ç»Ÿé…ç½®      â”‚
â”‚ - æ— ç®¡ç†å…¥å£     â”‚    â”‚ - ç‹¬ç«‹è®¿é—®      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                       â”‚
        â”‚                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€ å®Œå…¨åˆ†ç¦» â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å®‰å…¨ç‰¹æ€§
- âœ… **å®Œå…¨åˆ†ç¦»**ï¼šå°ç¨‹åºå’Œç®¡ç†åå°æ— ä»»ä½•è¿æ¥
- âœ… **ç‹¬ç«‹éƒ¨ç½²**ï¼šç®¡ç†åå°éƒ¨ç½²åœ¨ç‹¬ç«‹æœåŠ¡å™¨
- âœ… **ç‹¬ç«‹åŸŸå**ï¼šä½¿ç”¨ç‹¬ç«‹çš„åŸŸåå’ŒSSLè¯ä¹¦
- âœ… **ç‹¬ç«‹æ•°æ®åº“**ï¼šç®¡ç†åå°ä½¿ç”¨ç‹¬ç«‹æ•°æ®åº“
- âœ… **ç‹¬ç«‹è®¤è¯**ï¼šç®¡ç†åå°æœ‰è‡ªå·±çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿ

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡æœåŠ¡å™¨

#### 1.1 æœåŠ¡å™¨è¦æ±‚
- **æ“ä½œç³»ç»Ÿ**ï¼šUbuntu 20.04 LTS æˆ– CentOS 8
- **CPU**ï¼š2æ ¸å¿ƒä»¥ä¸Š
- **å†…å­˜**ï¼š4GBä»¥ä¸Š
- **å­˜å‚¨**ï¼š50GBä»¥ä¸Š
- **ç½‘ç»œ**ï¼šç‹¬ç«‹å…¬ç½‘IP

#### 1.2 åŸŸåå‡†å¤‡
- **ä¸»åŸŸå**ï¼šadmin.tea-platform.com
- **å¤‡ç”¨åŸŸå**ï¼štea-admin.com
- **SSLè¯ä¹¦**ï¼šLet's Encrypt æˆ–å•†ä¸šè¯ä¹¦

### ç¬¬äºŒæ­¥ï¼šç¯å¢ƒé…ç½®

#### 2.1 å®‰è£…åŸºç¡€è½¯ä»¶
```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…å¿…è¦è½¯ä»¶
sudo apt install -y nginx python3 python3-pip nodejs npm git curl wget

# å®‰è£…æ•°æ®åº“
sudo apt install -y mysql-server redis-server

# å®‰è£…é˜²ç«å¢™
sudo apt install -y ufw
```

#### 2.2 é…ç½®é˜²ç«å¢™
```bash
# å¼€å¯é˜²ç«å¢™
sudo ufw enable

# å…è®¸SSH
sudo ufw allow ssh

# å…è®¸HTTPå’ŒHTTPS
sudo ufw allow 80
sudo ufw allow 443

# å…è®¸ç®¡ç†åå°ç«¯å£
sudo ufw allow 8080

# æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€
sudo ufw status
```

### ç¬¬ä¸‰æ­¥ï¼šéƒ¨ç½²ç®¡ç†åå°

#### 3.1 åˆ›å»ºé¡¹ç›®ç›®å½•
```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
sudo mkdir -p /var/www/tea-admin
sudo chown -R $USER:$USER /var/www/tea-admin
cd /var/www/tea-admin
```

#### 3.2 ä¸‹è½½ç®¡ç†åå°ä»£ç 
```bash
# å…‹éš†ç®¡ç†åå°ä»£ç 
git clone https://github.com/your-org/tea-admin.git .

# æˆ–è€…ä¸Šä¼ æœ¬åœ°ä»£ç 
# scp -r ./admin-files/* user@server:/var/www/tea-admin/
```

#### 3.3 å®‰è£…ä¾èµ–
```bash
# å®‰è£…Pythonä¾èµ–
pip3 install -r requirements.txt

# å®‰è£…Node.jsä¾èµ–
npm install

# æ„å»ºå‰ç«¯
npm run build
```

#### 3.4 é…ç½®æ•°æ®åº“
```bash
# ç™»å½•MySQL
sudo mysql -u root -p

# åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
CREATE DATABASE tea_admin CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'tea_admin'@'localhost' IDENTIFIED BY 'your_secure_password';
GRANT ALL PRIVILEGES ON tea_admin.* TO 'tea_admin'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

#### 3.5 é…ç½®ç¯å¢ƒå˜é‡
```bash
# åˆ›å»ºç¯å¢ƒé…ç½®æ–‡ä»¶
cat > .env << EOF
# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_NAME=tea_admin
DB_USER=tea_admin
DB_PASSWORD=your_secure_password

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# åº”ç”¨é…ç½®
APP_SECRET=your_app_secret_key
APP_ENV=production
APP_DEBUG=false

# ç®¡ç†åå°é…ç½®
ADMIN_PORT=8080
ADMIN_HOST=0.0.0.0

# å®‰å…¨é…ç½®
JWT_SECRET=your_jwt_secret_key
SESSION_SECRET=your_session_secret

# é‚®ä»¶é…ç½®
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your_email@gmail.com
SMTP_PASSWORD=your_email_password

# æ–‡ä»¶ä¸Šä¼ é…ç½®
UPLOAD_PATH=/var/www/tea-admin/uploads
MAX_FILE_SIZE=10485760
EOF
```

### ç¬¬å››æ­¥ï¼šé…ç½®WebæœåŠ¡å™¨

#### 4.1 é…ç½®Nginx
```bash
# åˆ›å»ºNginxé…ç½®æ–‡ä»¶
sudo nano /etc/nginx/sites-available/tea-admin

# æ·»åŠ ä»¥ä¸‹é…ç½®
server {
    listen 80;
    server_name admin.tea-platform.com;
    
    # é‡å®šå‘åˆ°HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name admin.tea-platform.com;
    
    # SSLè¯ä¹¦é…ç½®
    ssl_certificate /etc/letsencrypt/live/admin.tea-platform.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/admin.tea-platform.com/privkey.pem;
    
    # SSLå®‰å…¨é…ç½®
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    
    # å®‰å…¨å¤´
    add_header X-Frame-Options DENY;
    add_header X-Content-Type-Options nosniff;
    add_header X-XSS-Protection "1; mode=block";
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    
    # é™æ€æ–‡ä»¶
    location /static/ {
        alias /var/www/tea-admin/static/;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # APIæ¥å£
    location /api/ {
        proxy_pass http://127.0.0.1:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # ç®¡ç†åå°é¡µé¢
    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

#### 4.2 å¯ç”¨ç«™ç‚¹
```bash
# å¯ç”¨ç«™ç‚¹
sudo ln -s /etc/nginx/sites-available/tea-admin /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯Nginx
sudo systemctl restart nginx
```

### ç¬¬äº”æ­¥ï¼šé…ç½®SSLè¯ä¹¦

#### 5.1 å®‰è£…Certbot
```bash
# å®‰è£…Certbot
sudo apt install -y certbot python3-certbot-nginx

# è·å–SSLè¯ä¹¦
sudo certbot --nginx -d admin.tea-platform.com

# è®¾ç½®è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ ä»¥ä¸‹è¡Œ
0 12 * * * /usr/bin/certbot renew --quiet
```

### ç¬¬å…­æ­¥ï¼šå¯åŠ¨ç®¡ç†åå°

#### 6.1 åˆ›å»ºç³»ç»ŸæœåŠ¡
```bash
# åˆ›å»ºæœåŠ¡æ–‡ä»¶
sudo nano /etc/systemd/system/tea-admin.service

# æ·»åŠ ä»¥ä¸‹å†…å®¹
[Unit]
Description=Tea Admin Backend
After=network.target mysql.service redis.service

[Service]
Type=simple
User=www-data
Group=www-data
WorkingDirectory=/var/www/tea-admin
Environment=PATH=/var/www/tea-admin/venv/bin
ExecStart=/var/www/tea-admin/venv/bin/python app.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

#### 6.2 å¯åŠ¨æœåŠ¡
```bash
# é‡æ–°åŠ è½½æœåŠ¡é…ç½®
sudo systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
sudo systemctl start tea-admin

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable tea-admin

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status tea-admin
```

### ç¬¬ä¸ƒæ­¥ï¼šå®‰å…¨é…ç½®

#### 7.1 é…ç½®é˜²ç«å¢™è§„åˆ™
```bash
# åªå…è®¸ç‰¹å®šIPè®¿é—®ç®¡ç†åå°
sudo ufw allow from 192.168.1.0/24 to any port 8080
sudo ufw allow from 10.0.0.0/8 to any port 8080

# æˆ–è€…ä½¿ç”¨VPNè®¿é—®
sudo ufw deny 8080
```

#### 7.2 é…ç½®Fail2ban
```bash
# å®‰è£…Fail2ban
sudo apt install -y fail2ban

# é…ç½®Fail2ban
sudo nano /etc/fail2ban/jail.local

# æ·»åŠ ä»¥ä¸‹é…ç½®
[nginx-http-auth]
enabled = true
port = http,https
filter = nginx-http-auth
logpath = /var/log/nginx/error.log
maxretry = 3
bantime = 3600

[nginx-botsearch]
enabled = true
port = http,https
filter = nginx-botsearch
logpath = /var/log/nginx/access.log
maxretry = 2
bantime = 3600
```

#### 7.3 å®šæœŸå¤‡ä»½
```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
sudo nano /var/www/tea-admin/backup.sh

# æ·»åŠ å¤‡ä»½å†…å®¹
#!/bin/bash
BACKUP_DIR="/var/backups/tea-admin"
DATE=$(date +%Y%m%d_%H%M%S)

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å¤‡ä»½æ•°æ®åº“
mysqldump -u tea_admin -p tea_admin > $BACKUP_DIR/db_backup_$DATE.sql

# å¤‡ä»½æ–‡ä»¶
tar -czf $BACKUP_DIR/files_backup_$DATE.tar.gz /var/www/tea-admin

# åˆ é™¤7å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "*.sql" -mtime +7 -delete
find $BACKUP_DIR -name "*.tar.gz" -mtime +7 -delete
```

## ğŸ” è®¿é—®ç®¡ç†åå°

### è®¿é—®åœ°å€
- **ä¸»åœ°å€**ï¼šhttps://admin.tea-platform.com
- **å¤‡ç”¨åœ°å€**ï¼šhttps://tea-admin.com

### åˆå§‹ç®¡ç†å‘˜è´¦å·
- **ç”¨æˆ·å**ï¼šadmin
- **å¯†ç **ï¼šadmin123456
- **é‚®ç®±**ï¼šadmin@tea-platform.com

### é¦–æ¬¡ç™»å½•åå¿…é¡»ä¿®æ”¹
1. ä¿®æ”¹é»˜è®¤å¯†ç 
2. é…ç½®é‚®ç®±è®¾ç½®
3. è®¾ç½®å®‰å…¨ç­–ç•¥
4. åˆ›å»ºå…¶ä»–ç®¡ç†å‘˜è´¦å·

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### ç³»ç»Ÿç›‘æ§
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status tea-admin nginx mysql redis

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u tea-admin -f
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log

# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop
df -h
free -h
```

### å®šæœŸç»´æŠ¤
```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# æ›´æ–°ç®¡ç†åå°
cd /var/www/tea-admin
git pull origin main
pip3 install -r requirements.txt
sudo systemctl restart tea-admin

# æ¸…ç†æ—¥å¿—
sudo journalctl --vacuum-time=30d
```

## ğŸš¨ å®‰å…¨å»ºè®®

### 1. ç½‘ç»œå®‰å…¨
- ä½¿ç”¨VPNè®¿é—®ç®¡ç†åå°
- é…ç½®IPç™½åå•
- å¯ç”¨åŒå› ç´ è®¤è¯
- å®šæœŸæ›´æ–°SSLè¯ä¹¦

### 2. ç³»ç»Ÿå®‰å…¨
- å®šæœŸæ›´æ–°ç³»ç»Ÿå’Œè½¯ä»¶
- ä½¿ç”¨å¼ºå¯†ç ç­–ç•¥
- å¯ç”¨ç™»å½•å¤±è´¥é™åˆ¶
- ç›‘æ§å¼‚å¸¸è®¿é—®

### 3. æ•°æ®å®‰å…¨
- å®šæœŸå¤‡ä»½æ•°æ®
- åŠ å¯†æ•æ„Ÿæ•°æ®
- é™åˆ¶æ•°æ®åº“è®¿é—®
- ç›‘æ§æ•°æ®å˜æ›´

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è”ç³»æ–¹å¼
- **æŠ€æœ¯æ”¯æŒ**ï¼šadmin@tea-platform.com
- **ç´§æ€¥è”ç³»**ï¼š+86-xxx-xxxx-xxxx
- **æ–‡æ¡£åœ°å€**ï¼šhttps://docs.tea-platform.com

### å¸¸è§é—®é¢˜
1. **æœåŠ¡æ— æ³•å¯åŠ¨**ï¼šæ£€æŸ¥ç«¯å£å ç”¨å’Œé…ç½®æ–‡ä»¶
2. **æ•°æ®åº“è¿æ¥å¤±è´¥**ï¼šæ£€æŸ¥æ•°æ®åº“æœåŠ¡å’Œè¿æ¥å‚æ•°
3. **SSLè¯ä¹¦è¿‡æœŸ**ï¼šè¿è¡Œcertbot renewæ›´æ–°è¯ä¹¦
4. **è®¿é—®æƒé™è¢«æ‹’ç»**ï¼šæ£€æŸ¥é˜²ç«å¢™å’ŒIPç™½åå•è®¾ç½®

---

**æ³¨æ„**ï¼šæœ¬æŒ‡å—ä»…ç”¨äºéƒ¨ç½²ç‹¬ç«‹çš„ç®¡ç†åå°ç³»ç»Ÿï¼Œä¸å°ç¨‹åºå®Œå…¨åˆ†ç¦»ï¼Œç¡®ä¿æœ€å¤§å®‰å…¨æ€§ã€‚ 