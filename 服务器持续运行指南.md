# 🔄 茶叶平台服务器持续运行指南

## ✅ 当前运行状态检查

### 快速状态检查命令：
```powershell
# 检查服务器进程
Get-Process | Where-Object {$_.ProcessName -eq "python"}

# 检查服务器响应
Invoke-WebRequest -Uri "http://localhost:3000/health" -UseBasicParsing
```

### 查看实时日志：
```powershell
# 如果服务器在前台运行，直接查看控制台输出
# 如果在后台运行，检查日志文件
Get-Content "auto_scheduler.log" -Tail 10
```

## 🔧 持续运行最佳实践

### 1. **推荐运行方式**

#### 方式1：PowerShell 前台运行（推荐调试时使用）
```powershell
& "C:\Program Files\Python311\python.exe" server.py
```
- ✅ 可以实时查看日志
- ✅ 便于调试
- ❌ 关闭窗口会停止服务

#### 方式2：后台运行（推荐生产环境）
```powershell
# 启动后台服务
Start-Process -FilePath "C:\Program Files\Python311\python.exe" -ArgumentList "server.py" -WindowStyle Hidden

# 或使用 nohup 类似功能
& "C:\Program Files\Python311\python.exe" server.py > server.log 2>&1 &
```

#### 方式3：使用一键启动脚本
```powershell
# 双击运行
.\一键启动内容自动更新.bat
```

### 2. **系统监控**

#### 自动重启脚本 (server-watchdog.ps1)：
```powershell
# 创建监控脚本
while ($true) {
    $process = Get-Process | Where-Object {$_.ProcessName -eq "python" -and $_.CommandLine -like "*server.py*"}
    
    if (-not $process) {
        Write-Host "$(Get-Date): 服务器已停止，正在重启..."
        Start-Process -FilePath "C:\Program Files\Python311\python.exe" -ArgumentList "server.py"
    }
    
    Start-Sleep -Seconds 60  # 每分钟检查一次
}
```

#### 健康检查脚本：
```powershell
# 检查API响应
try {
    $response = Invoke-WebRequest -Uri "http://localhost:3000/health" -TimeoutSec 10
    if ($response.StatusCode -eq 200) {
        Write-Host "✅ 服务器运行正常"
    }
} catch {
    Write-Host "❌ 服务器无响应，需要检查"
}
```

## ⏰ 自动更新时间表

| 时间间隔 | 自动执行的操作 | 状态监控 |
|---------|---------------|----------|
| 每30秒 | 检查更新文件 | 正常运行 ✅ |
| 每10分钟 | 添加新内容 | 等待触发 ⏰ |
| 每小时 | 健康状态检查 | 建议添加 📊 |
| 每天 | 清理旧日志 | 建议添加 🗑️ |

## 📊 预期效果时间线

### 启动后第1-10分钟：
- ✅ 服务器正常响应
- ✅ 健康检查每30秒执行
- ⏰ 等待第一次内容更新

### 启动后第10-20分钟：
- 🎯 **第一次自动内容更新**
- 📝 新增推荐内容（如：清香龙井新茶）
- 🔥 新增热点内容（如：夏季饮茶养生）

### 启动后第20-30分钟：
- 🎯 **第二次自动内容更新**  
- 📝 再增加推荐内容（如：消暑白茶特级）
- 🔥 再增加热点内容（如：电商直播带货）

### 长期运行效果：
- 🔄 内容持续自动更新
- 📈 内容数量维持在合理范围
- 🎯 用户看到的内容保持新鲜

## 🛠️ 故障排除

### 常见问题及解决方案：

#### 1. 服务器意外停止
```powershell
# 检查进程
Get-Process | Where-Object {$_.ProcessName -eq "python"}

# 重新启动
& "C:\Program Files\Python311\python.exe" server.py
```

#### 2. 端口被占用
```powershell
# 查找占用端口的进程
netstat -ano | findstr :3000

# 结束占用进程
taskkill /PID <进程ID> /F
```

#### 3. 内容未更新
```powershell
# 手动触发内容生成
& "C:\Program Files\Python311\python.exe" simple-content-generator.py

# 检查更新文件
Get-ChildItem "*update*.json" | Sort-Object LastWriteTime -Descending
```

#### 4. 内存使用过高
```powershell
# 重启服务器（会自动清理内存）
Get-Process | Where-Object {$_.ProcessName -eq "python"} | Stop-Process -Force
& "C:\Program Files\Python311\python.exe" server.py
```

## 💡 优化建议

### 1. **性能优化**
- 定期重启服务器（建议每周一次）
- 清理旧的更新文件
- 监控内存使用情况

### 2. **可靠性提升**
- 设置系统开机自启动
- 配置自动重启脚本
- 定期备份配置文件

### 3. **监控告警**
- 添加邮件告警功能
- 设置性能监控
- 记录运行日志

## 📈 成功指标

### 系统健康指标：
- ✅ API响应时间 < 1秒
- ✅ 内存使用 < 512MB  
- ✅ CPU使用率 < 10%
- ✅ 运行时间 > 24小时连续

### 内容更新指标：
- ✅ 每10分钟自动添加新内容
- ✅ 推荐内容保持8条以内
- ✅ 热点内容保持5条以内
- ✅ 内容时间戳保持最新

---

## 🎯 当前状态总结

**您的服务器现在已经在持续运行中！**

- ✅ 服务运行正常
- ✅ 自动更新已启用
- ✅ 健康检查正常
- ✅ 预计10分钟后开始看到新内容

**建议操作：**
1. 保持当前窗口运行
2. 10分钟后检查API，查看新内容
3. 如需后台运行，可使用监控脚本

**验证命令：**
```powershell
# 检查推荐内容（10分钟后执行）
Invoke-WebRequest -Uri "http://localhost:3000/api/content?type=recommend" -UseBasicParsing | ConvertFrom-Json | Select-Object -ExpandProperty data | Select-Object title
``` 