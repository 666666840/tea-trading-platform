# 开发环境与用户环境区分指南

## 📋 概述

为了让开发者和普通用户看到不同的功能界面，我们实现了完善的权限控制和环境区分系统。

## 🔧 环境模式配置

### 1. 环境类型说明

| 环境类型 | 说明 | 用途 | 数据管理 | 调试功能 |
|---------|------|------|---------|---------|
| **development** | 开发环境 | 开发调试 | ✅ 开启 | ✅ 开启 |
| **staging** | 预发布环境 | 测试验证 | ✅ 开启 | ✅ 开启 |
| **production** | 生产环境 | 正式用户使用 | ❌ 关闭 | ❌ 关闭 |

### 2. 当前配置状态

您的小程序当前配置为：
- **环境模式**: `production` (生产环境)
- **数据管理**: `关闭` (普通用户看不到管理功能)
- **调试模式**: `关闭`

## 👥 用户权限分级

### 1. 权限等级

```javascript
// 超级管理员 - 拥有所有权限
superAdmins: ['tea-platform-admin', 'system-admin']

// 数据管理员 - 只能管理数据
dataAdmins: ['data-manager', '数据管理员']

// 商户审核员 - 只能审核商户
merchantReviewers: ['merchant-reviewer', '商户审核员']

// 开发人员 - 开发调试权限
developers: ['developer', '开发人员', 'tea-dev']
```

### 2. 功能对应关系

| 用户类型 | 能看到的功能 |
|---------|-------------|
| **普通用户** | 基础浏览、收藏、发布信息 |
| **数据管理员** | + 数据管理后台、商户管理 |
| **商户审核员** | + 商户审核功能 |
| **开发人员** | + 开发调试工具（仅开发环境） |
| **超级管理员** | + 所有管理功能 |

## 🚀 如何切换环境

### 方法1: 代码中切换

在小程序启动时，可以调用：

```javascript
const app = getApp()

// 切换到开发环境（您看到管理功能）
app.setEnvironmentMode('development')

// 切换到生产环境（普通用户看到的）
app.setEnvironmentMode('production')
```

### 方法2: 修改配置文件

在 `app.js` 中修改环境配置：

```javascript
// 开发者版本配置
environment: {
  isDevelopment: true,   // 开发模式
  isProduction: false,   // 生产模式
  debugMode: true,       // 调试模式
  showTestData: true,    // 显示测试数据
  allowDataManagement: true  // 允许数据管理
}

// 用户版本配置
environment: {
  isDevelopment: false,
  isProduction: true,
  debugMode: false,
  showTestData: false,
  allowDataManagement: false
}
```

## 🔐 权限控制机制

### 1. 用户身份识别

系统通过用户昵称来识别权限：

- 如果您的微信昵称在管理员列表中，将获得对应权限
- 超级管理员可以访问所有功能
- 普通用户只能看到基础功能

### 2. 页面权限检查

每个管理页面都会检查权限：

```javascript
// 数据管理页面权限检查
if (!app.canAccessDataManagement(userInfo)) {
  // 跳转回上一页，提示权限不足
}
```

## 📱 用户看到的界面差异

### 普通用户界面
- ✅ 首页浏览
- ✅ 市场信息
- ✅ 供求信息
- ✅ 个人收藏
- ✅ 基础设置
- ❌ 数据管理
- ❌ 商户审核
- ❌ 系统管理

### 开发者界面
- ✅ 所有普通用户功能
- ✅ 数据管理后台
- ✅ 商户审核功能
- ✅ 数据导入/导出
- ✅ 统计分析
- ✅ 系统管理
- ✅ 开发调试工具

## ⚙️ 实际操作建议

### 1. 发布给用户前

```javascript
// 在发布前，确保设置为生产环境
const app = getApp()
app.setEnvironmentMode('production')
```

### 2. 开发调试时

```javascript
// 开发时，设置为开发环境
const app = getApp()
app.setEnvironmentMode('development')
```

### 3. 权限测试

1. 用普通微信号登录 → 应该看不到管理功能
2. 用管理员账号登录 → 可以看到对应管理功能
3. 切换环境模式 → 验证功能显示/隐藏

## 🚨 注意事项

### 1. 安全性

- 生产环境必须关闭数据管理功能
- 管理员账号信息不要硬编码在代码中
- 建议使用服务端验证权限

### 2. 用户体验

- 普通用户不应该看到任何管理相关的按钮或页面
- 权限不足时，应该给出友好的提示
- 避免在生产环境暴露调试信息

### 3. 维护建议

- 定期检查权限配置
- 记录管理操作日志
- 区分开发和生产数据

## 📞 获取支持

如果您需要：
- 添加新的管理员账号
- 修改权限配置
- 环境切换问题

请联系技术支持进行配置。 