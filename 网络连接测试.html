<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŒ¶å¶å¹³å°ç½‘ç»œè¿æ¥æµ‹è¯•</title>
    <style>
        body { font-family: 'Microsoft YaHei'; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { text-align: center; color: #2c5530; margin-bottom: 30px; }
        .test-item { margin: 15px 0; padding: 15px; border-radius: 5px; border-left: 4px solid #ccc; }
        .success { background: #d4edda; border-color: #28a745; }
        .error { background: #f8d7da; border-color: #dc3545; }
        .warning { background: #fff3cd; border-color: #ffc107; }
        .info { background: #cce7ff; border-color: #007bff; }
        button { background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #218838; }
        .status { font-weight: bold; margin-left: 10px; }
        .loading { color: #007bff; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow: auto; max-height: 200px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸƒ èŒ¶å¶å¹³å°ç½‘ç»œè¿æ¥æµ‹è¯•</h1>
            <p>æ£€æµ‹æ‚¨çš„ç½‘ç»œè¿æ¥çŠ¶æ€å’ŒAPIæœåŠ¡å™¨çŠ¶æ€</p>
        </div>

        <div id="tests">
            <div class="test-item info">
                <h3>ğŸ“‹ æµ‹è¯•é¡¹ç›®</h3>
                <button onclick="testAll()">ğŸ”„ å¼€å§‹å…¨é¢æµ‹è¯•</button>
                <button onclick="testLocal()">ğŸ  æµ‹è¯•æœ¬åœ°æœåŠ¡å™¨</button>
                <button onclick="testRemote()">ğŸŒ æµ‹è¯•è¿œç¨‹æœåŠ¡å™¨</button>
                <button onclick="clearResults()">ğŸ—‘ï¸ æ¸…ç©ºç»“æœ</button>
            </div>

            <div id="local-test" class="test-item">
                <h3>ğŸ  æœ¬åœ°æœåŠ¡å™¨æµ‹è¯• (localhost:3000)</h3>
                <div id="local-status" class="status loading">ç­‰å¾…æµ‹è¯•...</div>
                <div id="local-details"></div>
            </div>

            <div id="remote-test" class="test-item">
                <h3>ğŸŒ è¿œç¨‹æœåŠ¡å™¨æµ‹è¯•</h3>
                <div id="remote-status" class="status loading">ç­‰å¾…æµ‹è¯•...</div>
                <div id="remote-details"></div>
            </div>

            <div id="solution" class="test-item" style="display:none;">
                <h3>ğŸ”§ è§£å†³æ–¹æ¡ˆ</h3>
                <div id="solution-content"></div>
            </div>
        </div>
    </div>

    <script>
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            element.innerHTML += `<div class="${type}">[${timestamp}] ${message}</div>`;
        }

        function setStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
        }

        async function testLocal() {
            setStatus('local-status', 'æ­£åœ¨æµ‹è¯•æœ¬åœ°æœåŠ¡å™¨...', 'loading');
            document.getElementById('local-details').innerHTML = '';

            try {
                // æµ‹è¯•å¥åº·æ£€æŸ¥
                const healthResponse = await fetch('http://localhost:3000/health', {
                    method: 'GET',
                    mode: 'cors'
                });

                if (healthResponse.ok) {
                    const healthData = await healthResponse.json();
                    setStatus('local-status', 'âœ… æœ¬åœ°æœåŠ¡å™¨æ­£å¸¸è¿è¡Œ', 'success');
                    log('local-details', `å¥åº·æ£€æŸ¥æˆåŠŸ: ${healthData.message}`, 'success');

                    // æµ‹è¯•APIæ¥å£
                    const apiResponse = await fetch('http://localhost:3000/api/content?type=recommend');
                    if (apiResponse.ok) {
                        const apiData = await apiResponse.json();
                        log('local-details', `APIæ¥å£æ­£å¸¸ï¼Œæ•°æ®æ¡æ•°: ${apiData.data ? apiData.data.length : 0}`, 'success');
                    }
                } else {
                    setStatus('local-status', 'âŒ æœ¬åœ°æœåŠ¡å™¨å“åº”å¼‚å¸¸', 'error');
                    log('local-details', `HTTPçŠ¶æ€ç : ${healthResponse.status}`, 'error');
                }
            } catch (error) {
                setStatus('local-status', 'âŒ æ— æ³•è¿æ¥æœ¬åœ°æœåŠ¡å™¨', 'error');
                log('local-details', `é”™è¯¯ä¿¡æ¯: ${error.message}`, 'error');
                log('local-details', 'å¯èƒ½çš„åŸå› :', 'warning');
                log('local-details', '1. Pythonæœªå®‰è£…æˆ–server.pyæœªå¯åŠ¨', 'warning');
                log('local-details', '2. ç«¯å£3000è¢«å ç”¨', 'warning');
                log('local-details', '3. é˜²ç«å¢™é˜»æ­¢è¿æ¥', 'warning');
                showSolution();
            }
        }

        async function testRemote() {
            setStatus('remote-status', 'æ­£åœ¨æµ‹è¯•è¿œç¨‹æœåŠ¡å™¨...', 'loading');
            document.getElementById('remote-details').innerHTML = '';

            // è¿™é‡Œå¯ä»¥æ·»åŠ è¿œç¨‹æœåŠ¡å™¨æµ‹è¯•
            try {
                const response = await fetch('https://httpbin.org/json');
                if (response.ok) {
                    setStatus('remote-status', 'âœ… ç½‘ç»œè¿æ¥æ­£å¸¸', 'success');
                    log('remote-details', 'ç½‘ç»œè¿æ¥æµ‹è¯•é€šè¿‡', 'success');
                }
            } catch (error) {
                setStatus('remote-status', 'âŒ ç½‘ç»œè¿æ¥å¼‚å¸¸', 'error');
                log('remote-details', `ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            }
        }

        function showSolution() {
            const solutionDiv = document.getElementById('solution');
            const solutionContent = document.getElementById('solution-content');
            
            solutionContent.innerHTML = `
                <h4>ğŸ¯ è§£å†³"å½“å‰ç¦»çº¿"é—®é¢˜çš„æ­¥éª¤ï¼š</h4>
                <ol>
                    <li><strong>å®‰è£…Pythonç¯å¢ƒï¼š</strong>
                        <ul>
                            <li>åŒå‡»è¿è¡Œ <code>å¿«é€Ÿå®‰è£…Python.bat</code></li>
                            <li>æˆ–è€…æ‰‹åŠ¨ä¸‹è½½å®‰è£…Python 3.11</li>
                        </ul>
                    </li>
                    <li><strong>å¯åŠ¨æœåŠ¡å™¨ï¼š</strong>
                        <ul>
                            <li>åŒå‡»è¿è¡Œ <code>å¯åŠ¨æœåŠ¡å™¨.bat</code></li>
                            <li>æˆ–è€…åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ <code>python server.py</code></li>
                        </ul>
                    </li>
                    <li><strong>ç¡®è®¤æœåŠ¡å™¨è¿è¡Œï¼š</strong>
                        <ul>
                            <li>çœ‹åˆ°"Running on http://0.0.0.0:3000"æ¶ˆæ¯</li>
                            <li>é‡æ–°æµ‹è¯•æœ¬åœ°è¿æ¥</li>
                        </ul>
                    </li>
                    <li><strong>é‡å¯å°ç¨‹åºï¼š</strong>
                        <ul>
                            <li>å…³é—­å¾®ä¿¡å¼€å‘è€…å·¥å…·</li>
                            <li>é‡æ–°æ‰“å¼€é¡¹ç›®</li>
                            <li>ç‚¹å‡»ç¼–è¯‘æˆ–åˆ·æ–°</li>
                        </ul>
                    </li>
                </ol>
                
                <h4>ğŸ“ å¿«é€Ÿå‘½ä»¤ï¼š</h4>
                <pre>
# æ£€æŸ¥Pythonç‰ˆæœ¬
python --version

# å®‰è£…ä¾èµ–
pip install Flask Flask-CORS requests

# å¯åŠ¨æœåŠ¡å™¨
python server.py
                </pre>
            `;
            
            solutionDiv.style.display = 'block';
        }

        function testAll() {
            clearResults();
            testLocal();
            setTimeout(testRemote, 1000);
        }

        function clearResults() {
            document.getElementById('local-details').innerHTML = '';
            document.getElementById('remote-details').innerHTML = '';
            document.getElementById('solution').style.display = 'none';
            setStatus('local-status', 'ç­‰å¾…æµ‹è¯•...', 'loading');
            setStatus('remote-status', 'ç­‰å¾…æµ‹è¯•...', 'loading');
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.onload = function() {
            log('local-details', 'é¡µé¢å·²åŠ è½½ï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•', 'info');
        };
    </script>
</body>
</html> 