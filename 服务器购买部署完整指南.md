# 茶叶一点通 - 服务器购买部署完整指南

## 🛒 第一步：腾讯云服务器购买

### 1.1 注册腾讯云账号
1. 访问：https://cloud.tencent.com/
2. 点击"注册"或"登录"
3. 完成实名认证（必须）

### 1.2 选择服务器配置
**推荐配置（入门级）：**
- **实例规格**：标准型S5
- **CPU**：2核
- **内存**：4GB
- **系统盘**：50GB SSD云硬盘
- **带宽**：5Mbps
- **地域**：广州（推荐）
- **操作系统**：CentOS 7.6 64位
- **计费方式**：包年包月（更便宜）

**预估费用**：约￥120-150/月

### 1.3 购买步骤
1. 登录腾讯云控制台
2. 进入"云服务器CVM"
3. 点击"新建"
4. 按以下配置选择：
   ```
   计费模式：包年包月
   地域：广州
   可用区：随机分配
   网络：默认VPC
   实例：标准型S5
   规格：2核4GB
   镜像：CentOS 7.6 64位
   系统盘：50GB SSD云硬盘
   数据盘：无
   带宽：5Mbps
   安全组：默认安全组
   ```
5. 设置root密码：`Tea@2024#Crawler`
6. 完成购买

### 1.4 获取服务器信息
购买完成后，记录以下信息：
- **服务器IP地址**
- **root密码**
- **实例ID**

## 🔗 第二步：连接服务器

### 2.1 使用Windows PowerShell连接
```powershell
# 方法1：直接连接
ssh root@您的服务器IP

# 方法2：使用连接脚本
.\connect-server.ps1 -ServerIP "您的服务器IP"
```

### 2.2 使用PuTTY连接
1. 下载PuTTY：https://www.putty.org/
2. 打开PuTTY
3. 输入服务器IP
4. 端口：22
5. 连接类型：SSH
6. 点击"Open"
7. 输入用户名：root
8. 输入密码：Tea@2024#Crawler

### 2.3 首次连接注意事项
- 会提示"Security Alert"，点击"Accept"
- 输入密码时不会显示字符，这是正常的
- 连接成功后看到命令提示符 `[root@xxx ~]#`

## 📁 第三步：上传项目文件

### 3.1 使用上传脚本（推荐）
```powershell
# 在本地项目目录执行
.\upload-files.ps1 -ServerIP "您的服务器IP"
```

### 3.2 手动上传
```powershell
# 在本地项目目录执行
scp smart-tea-crawler.js root@服务器IP:/home/
scp package.json root@服务器IP:/home/
scp deploy.sh root@服务器IP:/home/
scp quick-deploy.sh root@服务器IP:/home/
```

### 3.3 验证文件上传
连接服务器后执行：
```bash
ls -la /home/
# 应该看到：smart-tea-crawler.js, package.json, deploy.sh, quick-deploy.sh
```

## 🚀 第四步：一键部署

### 4.1 运行快速部署脚本
```bash
# 连接服务器后执行
cd /home
chmod +x quick-deploy.sh
./quick-deploy.sh
```

### 4.2 部署过程说明
脚本会自动执行以下步骤：
1. ✅ 更新系统包
2. ✅ 安装基础工具（wget, curl, git, vim, unzip）
3. ✅ 安装Node.js 18.x
4. ✅ 安装PM2进程管理器
5. ✅ 创建项目目录
6. ✅ 检查项目文件
7. ✅ 安装项目依赖
8. ✅ 创建输出目录
9. ✅ 安装Nginx
10. ✅ 配置防火墙
11. ✅ 启动采集服务
12. ✅ 创建监控脚本
13. ✅ 创建管理脚本

### 4.3 部署完成验证
```bash
# 检查服务状态
./manage.sh status

# 查看系统监控
./manage.sh monitor

# 测试内容API
curl http://localhost/content.json
```

## ✅ 第五步：验证部署结果

### 5.1 检查服务状态
```bash
# PM2状态
pm2 status

# 应该看到：smart-tea-crawler 状态为 online
```

### 5.2 检查内容采集
```bash
# 查看最新日志
pm2 logs smart-tea-crawler --lines 20

# 检查输出文件
cat /usr/share/nginx/html/content.json
```

### 5.3 测试网络访问
```bash
# 获取服务器公网IP
curl ifconfig.me

# 测试内容API访问
curl http://您的服务器IP/content.json
```

## 🔧 第六步：配置小程序

### 6.1 小程序后台配置
1. 登录微信小程序后台
2. 进入"开发管理" → "开发设置"
3. 在"服务器域名"中添加：
   ```
   request合法域名：http://您的服务器IP
   ```

### 6.2 测试小程序访问
在小程序中测试内容加载是否正常

## 📊 第七步：监控和维护

### 7.1 日常管理命令
```bash
# 查看服务状态
./manage.sh status

# 查看实时日志
./manage.sh logs

# 重启服务
./manage.sh restart

# 系统监控
./manage.sh monitor
```

### 7.2 自动采集设置
系统已配置为每天凌晨2点自动采集内容，无需手动操作

### 7.3 日志查看
```bash
# 查看采集日志
tail -f /home/tea-crawler/crawler.log

# 查看系统日志
journalctl -f
```

## 🆘 常见问题解决

### 问题1：连接服务器失败
**解决方案**：
1. 检查服务器IP是否正确
2. 确认安全组开放了22端口
3. 检查服务器是否正常运行

### 问题2：部署脚本执行失败
**解决方案**：
```bash
# 检查文件权限
chmod +x *.sh

# 手动安装Node.js
curl -fsSL https://rpm.nodesource.com/setup_18.x | bash -
yum install -y nodejs

# 重新运行部署
./quick-deploy.sh
```

### 问题3：服务启动失败
**解决方案**：
```bash
# 查看错误日志
pm2 logs smart-tea-crawler

# 重启服务
pm2 restart smart-tea-crawler

# 检查依赖
npm install
```

### 问题4：无法访问内容API
**解决方案**：
```bash
# 检查Nginx状态
systemctl status nginx

# 启动Nginx
systemctl start nginx

# 检查防火墙
firewall-cmd --list-all
```

## 💰 成本控制建议

### 服务器费用优化
1. **选择合适的计费方式**：包年包月比按量计费便宜
2. **监控资源使用**：避免资源浪费
3. **设置费用告警**：及时了解费用情况

### 升级建议
- **初期**：2核4GB足够测试使用
- **用户增长**：可升级到4核8GB
- **大规模运营**：考虑8核16GB或更高配置

## 📞 技术支持

### 腾讯云支持
- **工单系统**：控制台 → 工单 → 提交工单
- **技术支持热线**：4009-100-100
- **在线客服**：控制台右下角

### 社区支持
- **Node.js官方文档**：https://nodejs.org/
- **PM2官方文档**：https://pm2.keymetrics.io/
- **腾讯云开发者社区**：https://cloud.tencent.com/developer

## 🎯 部署成功标志

当您看到以下信息时，说明部署成功：
```
==========================================
🎉 部署完成！
==========================================

📁 项目目录: /home/tea-crawler
🌐 输出目录: /usr/share/nginx/html
📊 内容文件: http://您的服务器IP/content.json

🔧 管理命令:
  启动服务: ./manage.sh start
  停止服务: ./manage.sh stop
  重启服务: ./manage.sh restart
  查看状态: ./manage.sh status
  查看日志: ./manage.sh logs
  系统监控: ./manage.sh monitor

✅ 部署成功！系统将在每天凌晨2点自动采集内容
```

现在您可以开始购买服务器并按照这个指南进行部署了！如果在任何步骤遇到问题，请随时告诉我。 